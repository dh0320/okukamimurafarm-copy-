<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奥神伏ファーム | 土と生きる、循環する未来。</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Shippori+Mincho:wght@400;500;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* Base Styles */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #F9F7F2; /* Off White */
            color: #2F4F4F; /* Deep Forest */
            transition: background-color 2s ease, filter 2s ease;
        }
        
        h1, h2, h3, .serif {
            font-family: 'Shippori Mincho', serif;
        }
        
        .eng {
            font-family: 'Montserrat', sans-serif;
        }

        /* Horror / Glitch Effects */
        .glitch-text {
            position: relative;
        }
        
        .phase-2 body {
            filter: contrast(1.1) sepia(0.1);
        }
        
        .phase-3 body {
            filter: contrast(1.2) sepia(0.3) grayscale(0.2);
            background-color: #F0EEE9;
        }
        
        .phase-4 body {
            filter: contrast(1.3) grayscale(0.8) brightness(0.8);
            background-color: #1a1a1a;
            color: #d1d1d1;
        }

        /* Hidden Selection Gimmick (F01) */
        .hidden-sos::selection {
            background: #A8383B; /* Crimson */
            color: white;
        }
        .hidden-sos {
            color: #F9F7F2; /* Same as bg */
            user-select: text;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-up {
            animation: fadeIn 0.8s ease-out forwards;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F9F7F2;
        }
        ::-webkit-scrollbar-thumb {
            background: #2F4F4F;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Constants & Data ---
        const PHASE_THRESHOLDS = { 1: 0, 2: 3, 3: 3, 4: 3 }; // Need 3 flags to advance
        const MAX_FLAGS = 13;

        // Image Placeholders (Picsum)
        const IMAGES = {
            hero: "https://picsum.photos/id/10/1920/1080", // Forest/Nature
            hero_horror: "https://picsum.photos/id/116/1920/1080", // Desolate
            apple: "https://picsum.photos/id/429/800/600", // Fruit
            tree: "https://picsum.photos/id/157/1200/800", // Tree (Symbol Tree)
            staff1: "https://picsum.photos/id/64/400/400", // Girl
            staff2: "https://picsum.photos/id/91/400/400", // Man (Sato)
            farm: "https://picsum.photos/id/292/800/400", // Farm tools
            map: "https://picsum.photos/id/1036/800/600", // Winter/Snow/Map feel
        };

        // --- Components ---

        // 1. Navigation
        const Navigation = ({ currentPage, setPage, phase }) => {
            const [isOpen, setIsOpen] = useState(false);
            const menuItems = [
                { id: 'home', label: 'TOP', sub: 'ホーム' },
                { id: 'about', label: 'ABOUT', sub: '農園について' },
                { id: 'village', label: 'VILLAGE', sub: '奥神伏村' },
                { id: 'products', label: 'PRODUCTS', sub: '商品一覧' },
                { id: 'diary', label: 'DIARY', sub: '活動日誌' },
                { id: 'access', label: 'ACCESS', sub: 'アクセス' },
                { id: 'recruit', label: 'RECRUIT', sub: '採用情報' },
                { id: 'contact', label: 'CONTACT', sub: 'お問い合わせ' },
            ];

            return (
                <header className={`fixed top-0 w-full z-50 transition-all duration-500 ${phase >= 4 ? 'bg-black text-red-700' : 'bg-white/90 backdrop-blur-md text-[#2F4F4F]'}`}>
                    <div className="container mx-auto px-6 py-4 flex justify-between items-center">
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setPage('home')}>
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${phase >= 4 ? 'bg-red-900' : 'bg-[#2F4F4F]'}`}>
                                <span className="text-white font-serif font-bold text-lg">奥</span>
                            </div>
                            <h1 className="text-xl md:text-2xl font-serif font-bold tracking-widest">
                                奥神伏ファーム
                            </h1>
                        </div>

                        {/* Desktop Menu */}
                        <nav className="hidden md:flex gap-6 items-center">
                            {menuItems.map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => setPage(item.id)}
                                    className={`group flex flex-col items-center hover:opacity-70 transition-opacity ${currentPage === item.id ? 'opacity-100 font-bold' : 'opacity-80'}`}
                                >
                                    <span className="eng text-sm tracking-widest font-semibold">{item.label}</span>
                                    {/* <span className="text-[10px] opacity-60 font-serif">{item.sub}</span> */}
                                </button>
                            ))}
                        </nav>

                        {/* Mobile Menu Button */}
                        <button className="md:hidden" onClick={() => setIsOpen(!isOpen)}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </button>
                    </div>

                    {/* Mobile Menu Overlay */}
                    {isOpen && (
                        <div className="fixed inset-0 bg-[#2F4F4F] text-[#F9F7F2] z-50 flex flex-col items-center justify-center gap-6">
                            <button className="absolute top-6 right-6" onClick={() => setIsOpen(false)}>
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                            {menuItems.map(item => (
                                <button key={item.id} onClick={() => { setPage(item.id); setIsOpen(false); }} className="text-2xl font-serif">
                                    {item.label}
                                </button>
                            ))}
                        </div>
                    )}
                </header>
            );
        };

        // 2. Footer
        const Footer = ({ onGimmickSearch, phase }) => {
            return (
                <footer className={`py-12 px-6 transition-colors duration-1000 ${phase >= 4 ? 'bg-black text-red-900' : 'bg-[#1B332D] text-[#F9F7F2]'}`}>
                    <div className="container mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
                        <div>
                            <h2 className="text-2xl font-serif font-bold mb-4">奥神伏ファーム</h2>
                            <p className="text-sm opacity-80">長野県奥神伏村字蛇喰 1092</p>
                            <p className="text-sm opacity-80 mt-2">自然と共に、神と共に。</p>
                        </div>
                        <div className="text-center md:text-right">
                            <div className="flex gap-4 justify-center md:justify-end mb-4">
                                <span className="cursor-pointer hover:text-[#A8383B]">Instagram</span>
                                <span className="cursor-pointer hover:text-[#A8383B]">X (Twitter)</span>
                            </div>
                            {/* F07: Copyright Date Gimmick */}
                            <p className="text-xs opacity-60 eng">
                                © 
                                <span 
                                    className="mx-1 transition-all duration-300 hover:text-red-500 cursor-help"
                                    title={phase >= 3 ? "1826" : "2026"}
                                >
                                    {phase >= 3 ? "1826" : "2026"}
                                </span> 
                                Okukamifushi Farm. All Rights Reserved.
                            </p>
                        </div>
                    </div>
                </footer>
            );
        };

        // --- Pages ---

        // HOME
        const Home = ({ phase, unlockFlag, flags }) => {
            const [kvImage, setKvImage] = useState(IMAGES.hero);
            
            useEffect(() => {
                if (phase >= 3) {
                    // F08: 異様な光景 (本来は画像が変わる。ここではフィルタで表現)
                    setKvImage(IMAGES.hero_horror);
                }
            }, [phase]);

            return (
                <div className="pt-20">
                    {/* Hero Section */}
                    <div className="relative h-[80vh] w-full overflow-hidden">
                        <div 
                            className={`absolute inset-0 bg-cover bg-center transition-all duration-1000 ${phase >= 3 ? 'scale-110 grayscale' : 'scale-100'}`}
                            style={{ backgroundImage: `url(${kvImage})` }}
                            onClick={() => {
                                if (phase >= 3 && !flags.F08) {
                                    alert("【F08: 異様な光景】\n画像をクリック：出口が村人たちによって封鎖されていることに気づいた。\n「誰も出さない」という意思を感じる。");
                                    unlockFlag('F08');
                                }
                            }}
                        />
                        <div className="absolute inset-0 bg-black/20 flex items-center justify-center">
                            <h2 className="text-4xl md:text-6xl text-white font-serif font-bold tracking-[0.2em] writing-vertical-rl text-shadow-lg">
                                {phase >= 4 ? "逃 ゲ ラ レ ナ イ" : "土と生きる、奥神伏の恵み"}
                            </h2>
                        </div>
                    </div>

                    {/* News Section */}
                    <div className="container mx-auto px-6 py-20">
                        <div className="flex flex-col md:flex-row gap-12">
                            <div className="md:w-1/3">
                                <h3 className="text-3xl font-serif mb-2 text-[#2F4F4F]">News</h3>
                                <p className="text-sm eng text-[#8C8682]">お知らせ</p>
                            </div>
                            <div className="md:w-2/3 space-y-6">
                                {/* F03: 管理人からのお知らせ */}
                                {phase >= 2 && (
                                    <div 
                                        className="border-b border-[#8C8682] pb-4 cursor-pointer hover:bg-red-50 p-2 transition-colors"
                                        onClick={() => {
                                            if (!flags.F03) {
                                                alert("【F03: 管理人からのお知らせ】\nお知らせを開く：通常のニュースではなく、隠された「内部通報フォーム」への入り口を発見した。\nパスワードがかかっているようだ。");
                                                unlockFlag('F03');
                                            }
                                        }}
                                    >
                                        <p className="text-xs text-[#A8383B] mb-1">2026.01.20</p>
                                        <p className="font-medium text-[#A8383B]">【重要】管理人からのお知らせ（閲覧制限あり）</p>
                                    </div>
                                )}
                                <div className="border-b border-[#8C8682] pb-4">
                                    <p className="text-xs text-[#8C8682] mb-1">2026.01.15</p>
                                    <p className="font-medium">本年の「朱実（あけみ）」の予約受付を開始しました。</p>
                                </div>
                                <div className="border-b border-[#8C8682] pb-4">
                                    <p className="text-xs text-[#8C8682] mb-1">2026.01.08</p>
                                    <p className="font-medium">冬季実習生の受け入れを実施しました。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ABOUT
        const About = ({ phase, unlockFlag, flags }) => {
            const [introText, setIntroText] = useState("台木は余計な枝葉を剪定します。良い実をつけるためには、親となる木が健康でなければなりません。私たちは日々、自然と対話しています。");
            
            // F09: 園長の言葉ギミック
            useEffect(() => {
                if (phase >= 2 && !flags.F09) {
                    const timer = setTimeout(() => {
                        // ノイズ演出（簡易）
                        let noiseCount = 0;
                        const interval = setInterval(() => {
                            noiseCount++;
                            setIntroText(prev => prev.split('').map(c => Math.random() > 0.8 ? '■' : c).join(''));
                            
                            if (noiseCount > 5) {
                                clearInterval(interval);
                                setIntroText("柩木は余計な関節を剪定します。良い実をつけるためには、親となる木が健康でなければなりません。私たちは日々、生贄と対話しています。");
                                alert("【F09: 園長の言葉】\n文章が変化した。\n「台木→柩木」「枝葉→関節」\nこれは農業の話ではない。");
                                unlockFlag('F09');
                            }
                        }, 200);
                    }, 5000); // 5秒後に発動
                    return () => clearTimeout(timer);
                }
            }, [phase, flags.F09]);

            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-16">農園について</h2>
                    
                    {/* Introduction */}
                    <div className="flex flex-col md:flex-row gap-12 items-center mb-24">
                        <div className="md:w-1/2">
                            <img src={IMAGES.farm} alt="Farm" className="w-full h-auto rounded-sm shadow-lg" />
                        </div>
                        <div className="md:w-1/2">
                            <h3 className="text-2xl font-serif mb-6">神去 巌 <span className="text-sm">（園長）</span></h3>
                            <p className="leading-loose font-serif text-lg transition-all duration-500">
                                {introText}
                            </p>
                        </div>
                    </div>

                    {/* Staff */}
                    <h3 className="text-2xl font-serif text-center mb-12">スタッフ紹介</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {/* F06: 隠された実習生 (Phase 3で追加) */}
                        {phase >= 3 && (
                            <div className="bg-white p-6 shadow-sm hover:shadow-md transition-shadow cursor-pointer" onClick={() => {
                                if(!flags.F06) {
                                    alert("【F06: 隠された実習生】\n写真の背景に、あるはずのない地下室への扉が写り込んでいる。\nクリックすると、監禁された実習生の映像が表示された。");
                                    unlockFlag('F06');
                                }
                            }}>
                                <div className="aspect-square bg-gray-200 mb-4 overflow-hidden relative">
                                    <img src={IMAGES.staff1} className="w-full h-full object-cover filter brightness-50" />
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-white text-xs">NO DATA</span>
                                    </div>
                                </div>
                                <h4 className="font-bold mb-2">実習生（行方不明）</h4>
                                <p className="text-sm text-gray-600">......</p>
                            </div>
                        )}

                        {/* F01: 副園長の隠しメッセージ */}
                        <div className="bg-white p-6 shadow-sm">
                            <div className="aspect-square bg-gray-200 mb-4 overflow-hidden">
                                <img src={IMAGES.staff2} alt="Sato" className="w-full h-full object-cover" />
                            </div>
                            <h4 className="font-bold mb-2">佐藤 健太 <span className="text-xs font-normal">（副農園長）</span></h4>
                            <p className="text-sm text-gray-600 leading-relaxed">
                                都会から移住してきました。Web担当です。<br/>
                                自然豊かなこの村は最高です。<br/>
                                <span 
                                    className="hidden-sos bg-[#F9F7F2] text-[#F9F7F2] select-all cursor-text"
                                    onMouseUp={() => {
                                        const selection = window.getSelection().toString();
                                        if (selection.includes("狂ってる") && !flags.F01) {
                                            alert("【F01: 副園長の隠しメッセージ】\nテキストを反転して発見：\n「この村は狂ってる。出られない。助けてくれ」");
                                            unlockFlag('F01');
                                        }
                                    }}
                                >
                                    この村は狂ってる。出られない。助けてくれ。
                                </span>
                                <br/>ぜひ一度遊びに来てください。
                            </p>
                        </div>

                        <div className="bg-white p-6 shadow-sm">
                            <div className="aspect-square bg-gray-200 mb-4 overflow-hidden">
                                <img src={IMAGES.staff1} alt="Tome" className="w-full h-full object-cover" />
                            </div>
                            <h4 className="font-bold mb-2">神去 トメ <span className="text-xs font-normal">（加工担当）</span></h4>
                            <p className="text-sm text-gray-600">
                                私の作るアップルパイは絶品ですよ。<br/>
                                赤くて甘いリンゴを使っていますから。
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // VILLAGE
        const Village = ({ phase, unlockFlag, flags }) => {
            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-6">奥神伏村について</h2>
                    <p className="text-center mb-16 text-[#8C8682]">神に守られし、安らぎの里</p>

                    <div className="space-y-24">
                        <div className="grid md:grid-cols-2 gap-12 items-center">
                            <div>
                                <h3 className="text-2xl font-serif mb-4">村の全景</h3>
                                <p className="leading-relaxed">四方を山に囲まれた、静かな盆地です。独自の生態系が保たれており、ここでしか育たない作物が多くあります。</p>
                            </div>
                            <img src={IMAGES.map} alt="Village" className="w-full rounded shadow-lg" />
                        </div>

                        {/* F10: シンボルツリー */}
                        <div className="flex flex-col items-center">
                            <h3 className="text-2xl font-serif mb-6">御神木（シンボルツリー）</h3>
                            <div 
                                className="relative w-full max-w-2xl cursor-pointer group"
                                onClick={() => {
                                    if (phase >= 3 && !flags.F10) {
                                        alert("【F10: シンボルツリーの秘密】\n御神木を拡大して確認：\n樹皮の継ぎ目だと思っていたものは、人間の皮膚の縫合痕だった。\n木の中に、誰かが埋まっている。");
                                        unlockFlag('F10');
                                    }
                                }}
                            >
                                <img src={IMAGES.tree} alt="Tree" className="w-full rounded shadow-lg transition-transform duration-700 group-hover:scale-105" />
                                {phase >= 3 && (
                                    <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/40 text-white font-serif">
                                        詳しく見る
                                    </div>
                                )}
                            </div>
                            <p className="mt-4 text-sm text-[#8C8682]">村の中央に立つ樹齢300年の大木。村の守り神として大切にされています。</p>
                        </div>
                    </div>
                </div>
            );
        };

        // PRODUCTS
        const Products = ({ phase, unlockFlag, flags }) => {
            const products = [
                { id: 1, name: "奥神伏りんご「朱実」", price: "¥5,000", desc: "驚くほどの糖度と、深紅の色合い。", img: IMAGES.apple, tag: "#甘い" },
                { id: 2, name: "手作りアップルパイ", price: "¥3,500", desc: "トメさん秘伝のレシピ。", img: IMAGES.apple, tag: "#母の味" },
                { id: 3, name: "有機栽培ブドウ", price: "¥8,000", desc: "接ぎ木技術の結晶。", img: IMAGES.farm, tag: "#キヅイテ" }, // F02 target
            ];

            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-16">商品一覧</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        {products.map(p => (
                            <div key={p.id} className="group cursor-pointer">
                                <div className="overflow-hidden mb-4">
                                    <img src={p.img} alt={p.name} className="w-full aspect-[4/3] object-cover transition-transform duration-500 group-hover:scale-105" />
                                </div>
                                <h3 className="text-xl font-serif font-bold">{p.name}</h3>
                                <p className="text-[#A8383B] eng mb-2">{p.price}</p>
                                <p className="text-sm text-[#8C8682] mb-3">{p.desc}</p>
                                <span 
                                    className={`text-xs px-2 py-1 bg-gray-200 rounded-full text-gray-600 ${p.tag === "#キヅイテ" ? "hover:bg-red-600 hover:text-white transition-colors" : ""}`}
                                    onClick={(e) => {
                                        if (p.tag === "#キヅイテ") {
                                            e.stopPropagation(); // Prevent parent click
                                            if (phase >= 2 && !flags.F02) {
                                                alert("【F02: 訴えの動画】\nタグ「#キヅイテ」をクリック：\n商品紹介ではなく、実習生が暗闇で「助けて」と訴える動画が再生された。");
                                                unlockFlag('F02');
                                            }
                                        }
                                    }}
                                >
                                    {p.tag}
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // DIARY
        const Diary = ({ phase, unlockFlag, flags }) => {
            const [searchTerm, setSearchTerm] = useState("");
            const [articles, setArticles] = useState([
                { id: 1, date: "2026.01.18", title: "今年も豊作です", content: "神様に感謝します。今年の朱実は特に色が濃いです。" },
                { id: 2, date: "2026.01.10", title: "アップルパイのレシピを公開！", content: "トメです。リクエストにお答えしてレシピを載せますね。", isRecipe: true },
                { id: 3, date: "2026.01.05", title: "雪かき", content: "村のみんなで雪かきをしました。結束力が強まりました。" },
            ]);

            const handleSearch = () => {
                if (phase >= 3 && searchTerm === "1826" && !flags.F07) {
                    alert("【F07: 古いブログ】\n検索「1826」：\nブログのデザインが古文書風に変化。\n1826年の村の開村日誌が表示された。「人木接ぎ（じんぼくつぎ）」の儀式の詳細が書かれている。");
                    unlockFlag('F07');
                    setArticles([
                        { id: 99, date: "1826.04.04", title: "開村の儀", content: "柩木（ひつぎ）となる者を土に伏せ、背に枝を接ぐ。血を吸い、木は赤く育つ。" }
                    ]);
                }
            };

            return (
                <div className={`pt-24 pb-20 container mx-auto px-6 ${flags.F07 ? 'font-serif bg-[#f0e6d2]' : ''}`}>
                    <div className="flex justify-between items-end mb-16">
                        <h2 className="text-4xl font-serif">活動日誌</h2>
                        <div className="flex gap-2">
                            <input 
                                type="text" 
                                placeholder="検索..." 
                                className="border-b border-[#2F4F4F] bg-transparent px-2 py-1 outline-none font-serif"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <button onClick={handleSearch} className="text-[#2F4F4F]">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </button>
                        </div>
                    </div>

                    <div className="space-y-12">
                        {articles.map(article => (
                            <div key={article.id} className="border-b border-dashed border-[#8C8682] pb-8">
                                <p className="text-sm text-[#8C8682] mb-2">{article.date}</p>
                                <h3 className="text-2xl font-serif mb-4 font-bold">{article.title}</h3>
                                <p className="leading-relaxed mb-4">{article.content}</p>
                                {article.isRecipe && (
                                    <span 
                                        className="text-[#A8383B] underline cursor-pointer"
                                        onClick={() => {
                                            if (phase >= 2 && !flags.F04) {
                                                alert("【F04: アップルパイの秘密】\nレシピページを表示：\n材料の中に「睡眠導入剤」「朱実（適合者）」の記述を発見。ただのお菓子作りではない。");
                                                unlockFlag('F04');
                                            }
                                        }}
                                    >
                                        詳しく見る
                                    </span>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ACCESS
        const Access = ({ phase, unlockFlag, flags }) => {
            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-16">アクセス</h2>
                    
                    <div className="bg-white p-8 shadow-lg max-w-3xl mx-auto">
                        <div className="aspect-video bg-gray-200 mb-8 relative">
                            {/* Dummy Map */}
                            <img src={IMAGES.map} className="w-full h-full object-cover" />
                            <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <span className="text-2xl font-serif text-white drop-shadow-md">Okukamifushi MAP</span>
                            </div>
                        </div>

                        <div className="text-center">
                            <p className="mb-6 font-serif">詳しい場所は、ご予約確定後にお伝えしております。<br/>山道が続きますので、お気をつけてお越しください。</p>
                            
                            {/* F11: 謎の地図 */}
                            <button 
                                className="border border-[#2F4F4F] text-[#2F4F4F] px-8 py-3 hover:bg-[#2F4F4F] hover:text-white transition-colors"
                                onClick={() => {
                                    if (!flags.F11) {
                                        alert("【F11: 謎の地図】\nPDFを表示：\nかわいいイラスト地図だが、スクロールすると裏面に「人接ぎの工程表」がびっしりと書かれている。\n「剪定→選定」「接ぎ木→伏せ」");
                                        unlockFlag('F11');
                                    }
                                }}
                            >
                                詳細地図を印刷する (PDF)
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // RECRUIT
        const Recruit = ({ phase, unlockFlag, flags }) => {
            const [checks, setChecks] = useState({ q1: false, q2: false, q3: false });

            const handleCheck = (key) => {
                const newChecks = { ...checks, [key]: !checks[key] };
                setChecks(newChecks);
                
                // F05: 外国人実習生の秘密
                if (newChecks.q3 && !flags.F05) {
                    alert("【F05: 外国人実習生の秘密】\nチェック項目に異変：\n「パスポートの保管に同意する」「逃亡時は違約金を支払う」「外部との連絡を絶つ」\n異常な雇用条件が表示された。");
                    unlockFlag('F05');
                }
            };

            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-16">採用情報</h2>
                    <div className="max-w-2xl mx-auto bg-white p-8">
                        <h3 className="text-xl font-bold mb-6">海外技能実習生 募集中</h3>
                        <p className="mb-8">日本の農業技術を学びませんか？寮完備、食事付き。アットホームな職場です。</p>
                        
                        <div className="space-y-4">
                            <label className="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" checked={checks.q1} onChange={() => handleCheck('q1')} className="w-5 h-5 accent-[#2F4F4F]" />
                                <span>健康診断の受診に同意します</span>
                            </label>
                            <label className="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" checked={checks.q2} onChange={() => handleCheck('q2')} className="w-5 h-5 accent-[#2F4F4F]" />
                                <span>寮の規則を守ります</span>
                            </label>
                            {/* F05 Trigger */}
                            <label className="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" checked={checks.q3} onChange={() => handleCheck('q3')} className="w-5 h-5 accent-red-900" />
                                <span className="group-hover:text-red-700 transition-colors">
                                    {checks.q3 ? "パスポートの没収に同意します" : "その他の規則に同意します"}
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
            );
        };

        // CONTACT
        const Contact = ({ phase, unlockFlag, flags }) => {
            const [placeholder, setPlaceholder] = useState("お名前");
            
            // F12: 乗っ取りギミック
            const handleFocus = () => {
                if (phase >= 1 && !flags.F12) {
                    setPlaceholder("助けて助けて助けて");
                    setTimeout(() => {
                        setPlaceholder("お名前");
                        alert("【F12: 問い合わせの乗っ取り】\n入力欄が一瞬変化した：\n「助けて」「もういない」「俺も逃げられない」\n誰かがシステムを乗っ取ってSOSを送っている。");
                        unlockFlag('F12');
                    }, 500);
                }
            };

            // F13: 通報
            const handleSubmit = (e) => {
                e.preventDefault();
                if (phase >= 4) {
                    // 簡易的なエンディング判定
                    const evidenceCount = Object.values(flags).filter(Boolean).length;
                    if (evidenceCount >= 10) {
                         alert("【TRUE END】\n住所：正解\n証拠：十分\n\n警察が動き、村の全貌が暴かれた。佐藤副園長は保護され、あなたはこの事件の英雄となった。");
                    } else {
                         alert("【NORMAL END】\n住所：正解\n証拠：不十分\n\n警察が動いたが、主要な村人は逃亡した後だった。真相は闇の中へ。");
                    }
                    unlockFlag('F13');
                } else {
                    alert("現在、問い合わせが混雑しております。");
                }
            };

            return (
                <div className="pt-24 pb-20 container mx-auto px-6">
                    <h2 className="text-4xl font-serif text-center mb-16">
                        {phase >= 4 ? "匿名通報フォーム" : "お問い合わせ"}
                    </h2>
                    
                    <form className="max-w-lg mx-auto space-y-8" onSubmit={handleSubmit}>
                        <div>
                            <label className="block text-sm mb-2 text-[#8C8682]">お名前</label>
                            <input 
                                type="text" 
                                className="w-full border-b border-[#8C8682] py-2 outline-none bg-transparent focus:border-[#2F4F4F] transition-colors"
                                placeholder={placeholder}
                                onFocus={handleFocus}
                            />
                        </div>
                        <div>
                            <label className="block text-sm mb-2 text-[#8C8682]">メールアドレス</label>
                            <input 
                                type="email" 
                                className="w-full border-b border-[#8C8682] py-2 outline-none bg-transparent focus:border-[#2F4F4F]"
                                placeholder="example@email.com"
                            />
                        </div>
                        <div>
                            <label className="block text-sm mb-2 text-[#8C8682]">
                                {phase >= 4 ? "通報内容 / 特定した住所" : "お問い合わせ内容"}
                            </label>
                            <textarea 
                                rows="4" 
                                className="w-full border-b border-[#8C8682] py-2 outline-none bg-transparent focus:border-[#2F4F4F]"
                            ></textarea>
                        </div>
                        <button 
                            type="submit" 
                            className={`w-full py-4 text-white transition-colors tracking-widest ${phase >= 4 ? 'bg-red-900 hover:bg-red-700' : 'bg-[#2F4F4F] hover:bg-[#1B332D]'}`}
                        >
                            {phase >= 4 ? "警察に通報する" : "送信する"}
                        </button>
                    </form>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [currentPage, setPage] = useState('home');
            const [phase, setPhase] = useState(1);
            const [flags, setFlags] = useState({}); // { F01: true, ... }
            const [inventory, setInventory] = useState([]);

            // Phase Transition Logic
            useEffect(() => {
                const acquiredFlags = Object.keys(flags).length;
                let nextPhase = phase;

                // Simple check: count flags. Real logic follows doc (specific flags per phase)
                // Phase 1 -> 2: Need 3 flags from F01,F05,F11,F12
                const p1Flags = ['F01', 'F05', 'F11', 'F12'].filter(f => flags[f]).length;
                if (phase === 1 && p1Flags >= 3) nextPhase = 2;

                // Phase 2 -> 3: Need 3 flags from F03,F09,F02,F04
                const p2Flags = ['F03', 'F09', 'F02', 'F04'].filter(f => flags[f]).length;
                if (phase === 2 && p2Flags >= 3) nextPhase = 3;

                // Phase 3 -> 4: Need 3 flags from F06,F07,F08,F10
                const p3Flags = ['F06', 'F07', 'F08', 'F10'].filter(f => flags[f]).length;
                if (phase === 3 && p3Flags >= 3) nextPhase = 4;

                if (nextPhase > phase) {
                    setPhase(nextPhase);
                    // Phase change effect could go here (sound, etc.)
                }
            }, [flags, phase]);

            const unlockFlag = (flagId) => {
                if (!flags[flagId]) {
                    setFlags(prev => ({ ...prev, [flagId]: true }));
                    setInventory(prev => [...prev, flagId]);
                }
            };

            // Page Router
            const renderPage = () => {
                const props = { phase, unlockFlag, flags };
                switch(currentPage) {
                    case 'home': return <Home {...props} />;
                    case 'about': return <About {...props} />;
                    case 'village': return <Village {...props} />;
                    case 'products': return <Products {...props} />;
                    case 'diary': return <Diary {...props} />;
                    case 'access': return <Access {...props} />;
                    case 'recruit': return <Recruit {...props} />;
                    case 'contact': return <Contact {...props} />;
                    default: return <Home {...props} />;
                }
            };

            return (
                <div className={`min-h-screen flex flex-col relative phase-${phase}`}>
                    <Navigation currentPage={currentPage} setPage={setPage} phase={phase} />
                    
                    <main className="flex-grow">
                        {renderPage()}
                    </main>
                    
                    <Footer onGimmickSearch={() => {}} phase={phase} />

                    {/* Debug Panel (To help user playtest) */}
                    <div className="fixed bottom-4 right-4 bg-black/80 text-white p-4 text-xs rounded z-50 opacity-50 hover:opacity-100 transition-opacity">
                        <p className="font-bold text-lg mb-2">Debug Mode</p>
                        <p>Phase: <span className="text-yellow-400 text-xl">{phase}</span></p>
                        <p>Flags: {Object.keys(flags).length} / {MAX_FLAGS}</p>
                        <div className="mt-2 grid grid-cols-4 gap-1">
                            {Object.keys(flags).map(f => <span key={f} className="bg-green-700 px-1">{f}</span>)}
                        </div>
                        <p className="mt-2 text-gray-400">Current Page: {currentPage}</p>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
