<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奥神伏ファーム | 土と生きる、循環する未来。</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: 'var(--bg)',
                        surface: 'var(--surface)',
                        'surface-2': 'var(--surface-2)',
                        text: 'var(--text)',
                        muted: 'var(--muted)',
                        border: 'var(--border)',
                        primary: 'var(--primary)',
                        'primary-2': 'var(--primary-2)',
                        accent: 'var(--accent)',
                    },
                    fontFamily: {
                        serif: ['Shippori Mincho', 'serif'],
                        sans: ['Noto Sans JP', 'sans-serif'],
                        eng: ['Montserrat', 'sans-serif'],
                    },
                    maxWidth: {
                        'container': '1200px',
                    },
                    animation: {
                        'ken-burns': 'kenBurns 20s ease-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        kenBurns: {
                            '0%': { transform: 'scale(1)' },
                            '100%': { transform: 'scale(1.1)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Shippori+Mincho:wght@400;500;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* Design Tokens & Theme Variables */
        :root {
            /* Base Colors (Natural Modern) */
            --bg: #FAFAF7;
            --surface: #FFFFFF;
            --surface-2: #F3F4F0;
            --text: #1C1F1D;
            --muted: #5C625E;
            --border: #E6E8E2;
            --primary: #2F6B3E;
            --primary-2: #214E2C;
            --accent: #8A2E2E; /* Horror Accent */
            
            /* Spacing */
            --header-height: 88px;
        }

        /* Phase 2: Slight Unease (Lower contrast, slightly cooler) */
        [data-phase="2"] {
            --bg: #F5F5F0;
            --text: #2C2F2D;
            --muted: #6C726E;
            filter: contrast(0.95) sepia(0.1);
        }

        /* Phase 3: Horror (Darker, Desaturated, Noise-like) */
        [data-phase="3"] {
            --bg: #EAE8E0;
            --text: #111;
            --surface: #F9F7F2;
            --primary: #1A3E24;
            filter: contrast(1.1) grayscale(0.3) brightness(0.9);
        }

        /* Phase 4: Nightmare (Inverted or Dark Mode like) */
        [data-phase="4"] {
            --bg: #0F1210;
            --surface: #1C1F1D;
            --surface-2: #2A2F2B;
            --text: #D1D5DB;
            --muted: #9CA3AF;
            --border: #374151;
            --primary: #8A2E2E; /* Green becomes Blood Red */
            --primary-2: #601818;
            filter: contrast(1.2) grayscale(0.8);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 2s ease, color 2s ease, filter 2s ease;
            -webkit-font-smoothing: antialiased;
            line-height: 1.8;
        }

        h1, h2, h3, .font-serif {
            font-family: 'Shippori Mincho', serif;
            letter-spacing: 0.05em;
        }

        /* Utility Animations */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-up {
            animation: fadeUp 0.8s ease-out forwards;
        }

        .hover-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .hover-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.1);
        }

        /* Gimmick Specific Styles */
        .hidden-sos::selection {
            background: var(--accent);
            color: white;
        }
        .hidden-sos {
            color: transparent; /* Text matches bg normally via props, but css backup */
        }
        
        /* Lightbox Overlay */
        .lightbox-overlay {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(4px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--muted);
            border-radius: 99px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Data & Assets ---
        // GitHub Raw URL Base
        const BASE_URL = "https://raw.githubusercontent.com/dh0320/okukamimurafarm/f273d82bcc2d0c08371bb0e42d3169c3d36e4b9b";

        const IMAGES = {
            // Top Slideshow
            top_morning: `${BASE_URL}/images/topmorning.png`,
            top_staff: `${BASE_URL}/images/topstaff.png`,
            top_apple: `${BASE_URL}/images/topapple.png`,
            top_children: `${BASE_URL}/images/topchildren.png`,
            top_farm: `${BASE_URL}/images/topfarm.png`,
            
            // Top Horror Changes (Phase 3)
            top_change_village: `${BASE_URL}/images/topchangevillage.png`,
            top_change_stop: `${BASE_URL}/images/topchangestop.png`,

            // Icon (Header)
            icon_default: `${BASE_URL}/images/icondefault.png`,
            icon_change_1: `${BASE_URL}/images/iconchange1.png`,
            icon_change_2: `${BASE_URL}/images/iconchange2.png`,
            icon_change_3: `${BASE_URL}/images/iconchange3.png`,

            // Products
            ec_apple: `${BASE_URL}/images/ecapple.png`,
            ec_applepie: `${BASE_URL}/images/ecapplepie.png`,
            ec_grape: `${BASE_URL}/images/ecgrape.png`,
            ec_jam: `${BASE_URL}/images/ecjam.png`,
            ec_set: `${BASE_URL}/images/ecset.png`,

            // Blog
            blog_sunny: `${BASE_URL}/images/blogsunny.png`,
            blog_applepie: `${BASE_URL}/images/blogapplepie.png`,
            blog_harvest: `${BASE_URL}/images/blogharvest.png`,
            blog_food: `${BASE_URL}/images/blogfood.png`,
            blog_oldbook: `${BASE_URL}/images/blogoldbook.png`,

            // Staff
            staff_manager: `${BASE_URL}/images/staffmanager.png`,
            staff_submanager: `${BASE_URL}/images/staffsubmanager.png`,
            staff_wife: `${BASE_URL}/images/staffwife.png`,
            staff_trainee: `${BASE_URL}/images/stafftrainee.png`,
            staff_victim: `${BASE_URL}/images/staffvictim.png`,
            staff_victim2: `${BASE_URL}/images/staffvictim2.png`,

            // Symbol Tree
            tree_default: `${BASE_URL}/images/treedefault.png`,
            tree_change: `${BASE_URL}/images/treechange.png`,

            // Village
            village_normal: `${BASE_URL}/images/villagenormal.png`,
            village_snow: `${BASE_URL}/images/villagesnow.png`,
            village_night: `${BASE_URL}/images/villagenight.png`,

            // Access (Specified fixed URL)
            access_map: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/access.png",

            // Video
            victim_movie: `${BASE_URL}/images/victimmovie.mp4`
        };

        const MAX_FLAGS = 13;

        // --- Common Components ---

        const SectionTitle = ({ title, sub, align = "center" }) => (
            <div className={`mb-12 md:mb-20 text-${align} animate-fade-up`}>
                <p className="text-primary font-eng text-sm tracking-widest font-semibold mb-3 uppercase">{sub}</p>
                <h2 className="text-3xl md:text-4xl font-serif text-text leading-tight">{title}</h2>
            </div>
        );

        const Button = ({ children, onClick, variant = "primary", className = "", type = "button" }) => {
            const baseClass = "inline-flex items-center justify-center px-8 py-3 rounded-full transition-all duration-300 font-medium tracking-wide text-sm";
            const variants = {
                primary: "bg-primary text-white hover:bg-primary-2 shadow-lg hover:shadow-xl",
                secondary: "border border-text text-text hover:bg-text hover:text-white",
                ghost: "text-text hover:text-primary underline-offset-4 hover:underline",
            };
            return (
                <button type={type} onClick={onClick} className={`${baseClass} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // Advertisement Placeholder
        const AdSpace = ({ className = "" }) => (
            <div className={`w-full max-w-container mx-auto px-6 my-16 animate-fade-up ${className}`}>
                <div className="bg-gray-100 border border-gray-200 w-full min-h-[200px] md:min-h-[250px] flex flex-col items-center justify-center text-muted relative overflow-hidden">
                    <div className="absolute top-2 right-2 text-[10px] border border-muted px-1">広告</div>
                    <div className="text-center">
                        <p className="font-bold text-gray-400 text-lg">広告掲載予定エリア</p>
                        <p className="text-xs mt-2 text-gray-400">Google Adsense / Display Ads</p>
                    </div>
                    <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                </div>
            </div>
        );

        // --- Layout Components ---

        const Header = ({ setPage, currentPage, phase }) => {
            const [isScrolled, setIsScrolled] = useState(false);
            const [isMenuOpen, setIsMenuOpen] = useState(false);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const getIcon = () => {
                if (phase >= 4) return IMAGES.icon_change_3;
                if (phase >= 3) return IMAGES.icon_change_2;
                if (phase >= 2) return IMAGES.icon_change_1;
                return IMAGES.icon_default;
            };

            const menuItems = [
                { id: 'home', label: 'HOME' },
                { id: 'about', label: 'ABOUT' },
                { id: 'village', label: 'VILLAGE' },
                { id: 'products', label: 'PRODUCTS' },
                { id: 'diary', label: 'DIARY' },
                { id: 'access', label: 'ACCESS' },
                { id: 'recruit', label: 'RECRUIT' },
            ];

            return (
                <>
                    <header 
                        className={`fixed top-0 w-full z-50 transition-all duration-500 ${
                            isScrolled || isMenuOpen ? 'bg-white/95 backdrop-blur-md shadow-sm text-text' : 'bg-gradient-to-b from-black/60 to-transparent text-white'
                        }`}
                        style={{ height: 'var(--header-height)' }}
                    >
                        <div className="max-w-container mx-auto px-4 md:px-8 h-full flex items-center justify-between">
                            {/* Logo */}
                            <div className="flex items-center gap-4 cursor-pointer z-50" onClick={() => { setPage('home'); setIsMenuOpen(false); }}>
                                {/* Icon: 背景を透過に変更 (bg-white削除) */}
                                <div className="w-16 h-16 rounded-full overflow-hidden shadow-md transition-transform duration-500 hover:scale-105 flex items-center justify-center bg-transparent">
                                    <img src={getIcon()} alt="Logo" className="w-full h-full object-cover scale-150 transform" />
                                </div>
                                <span className={`text-xl font-serif font-bold tracking-widest ${phase >= 4 ? 'text-accent' : (isScrolled ? 'text-text' : 'text-white drop-shadow-md')}`}>
                                    奥神伏ファーム
                                </span>
                            </div>

                            {/* Desktop Nav */}
                            <nav className="hidden lg:flex items-center gap-8">
                                {menuItems.map(item => (
                                    <button 
                                        key={item.id}
                                        onClick={() => setPage(item.id)}
                                        className={`text-sm font-eng tracking-wider hover:text-primary transition-colors ${currentPage === item.id ? 'font-bold' : ''} ${isScrolled ? 'text-text' : 'text-white drop-shadow-sm'}`}
                                    >
                                        {item.label}
                                    </button>
                                ))}
                                <Button onClick={() => setPage('contact')} className={`ml-4 ${isScrolled ? '' : 'bg-white/20 hover:bg-white/40 border-white text-white backdrop-blur-sm'}`}>お問い合わせ</Button>
                            </nav>

                            {/* Mobile Hamburger */}
                            <button className={`lg:hidden z-50 p-2 ${isScrolled ? 'text-text' : 'text-white'}`} onClick={() => setIsMenuOpen(!isMenuOpen)}>
                                {isMenuOpen ? <i data-lucide="x" className="w-6 h-6"></i> : <i data-lucide="menu" className="w-6 h-6"></i>}
                            </button>
                        </div>
                    </header>

                    <div className={`fixed inset-0 bg-white/95 backdrop-blur-xl z-40 transition-transform duration-500 flex flex-col justify-center items-center gap-8 ${isMenuOpen ? 'translate-y-0' : '-translate-y-full'}`}>
                        {menuItems.map(item => (
                            <button 
                                key={item.id}
                                onClick={() => { setPage(item.id); setIsMenuOpen(false); }}
                                className="text-2xl font-serif font-medium text-text hover:text-primary transition-colors"
                            >
                                {item.label}
                            </button>
                        ))}
                        <Button onClick={() => { setPage('contact'); setIsMenuOpen(false); }} className="mt-4">お問い合わせ</Button>
                    </div>
                </>
            );
        };

        const Footer = ({ phase, setPage }) => {
            return (
                <footer className={`pt-20 pb-8 px-6 transition-colors duration-1000 ${phase >= 4 ? 'bg-black text-accent' : 'bg-primary text-white'}`}>
                    <div className="max-w-container mx-auto grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                        <div className="md:col-span-1">
                            <h2 className="text-2xl font-serif font-bold mb-6 tracking-widest">奥神伏ファーム</h2>
                            <p className="text-sm opacity-80 leading-relaxed font-sans">
                                〒399-0000<br/>
                                長野県奥神伏村字蛇喰 1092<br/>
                                TEL: 026-000-0000
                            </p>
                        </div>
                        <div className="md:col-span-2 grid grid-cols-2 gap-8 text-sm">
                            <div className="flex flex-col gap-3">
                                <span onClick={() => setPage('about')} className="cursor-pointer hover:opacity-70">農園について</span>
                                <span onClick={() => setPage('village')} className="cursor-pointer hover:opacity-70">奥神伏村</span>
                                <span onClick={() => setPage('products')} className="cursor-pointer hover:opacity-70">商品一覧</span>
                            </div>
                            <div className="flex flex-col gap-3">
                                <span onClick={() => setPage('diary')} className="cursor-pointer hover:opacity-70">活動日誌</span>
                                <span onClick={() => setPage('access')} className="cursor-pointer hover:opacity-70">アクセス</span>
                                <span onClick={() => setPage('recruit')} className="cursor-pointer hover:opacity-70">採用情報</span>
                            </div>
                        </div>
                        <div className="md:col-span-1">
                            <Button variant="secondary" className="w-full border-white text-white hover:bg-white hover:text-primary mb-6" onClick={() => setPage('contact')}>
                                お問い合わせ
                            </Button>
                            <div className="flex gap-4 justify-center md:justify-start opacity-80">
                                <span>Instagram</span>
                                <span>Facebook</span>
                            </div>
                        </div>
                    </div>
                    <div className="border-t border-white/20 pt-8 text-center text-xs opacity-60 font-eng tracking-wider">
                        <p>© 
                            <span title={phase >= 3 ? "1826" : "2026"} className="mx-1 hover:text-red-500 cursor-default transition-colors">
                                {phase >= 3 ? "1826" : "2026"}
                            </span> 
                            Okukamifushi Farm. All Rights Reserved.
                        </p>
                    </div>
                </footer>
            );
        };

        // --- Pages ---

        // 1. HOME
        const Home = ({ phase, unlockFlag, flags, setPage }) => {
            const [currentSlide, setCurrentSlide] = useState(0);

            const slides = useMemo(() => {
                let baseSlides = [
                    IMAGES.top_morning,
                    IMAGES.top_staff,
                    IMAGES.top_apple,
                    IMAGES.top_children,
                    IMAGES.top_farm
                ];
                if (phase >= 3) {
                    baseSlides[3] = IMAGES.top_change_village;
                    baseSlides[4] = IMAGES.top_change_stop;
                }
                return baseSlides;
            }, [phase]);

            useEffect(() => {
                const slideInterval = setInterval(() => {
                    setCurrentSlide((prev) => (prev + 1) % slides.length);
                }, 6000); 
                return () => clearInterval(slideInterval);
            }, [slides.length]);

            return (
                <>
                    <div className="relative h-[75vh] min-h-[550px] w-full overflow-hidden bg-black">
                        {slides.map((img, index) => (
                            <div 
                                key={index}
                                className={`absolute inset-0 bg-cover bg-center transition-opacity duration-[2000ms] ease-in-out ${currentSlide === index ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                                style={{ backgroundImage: `url(${img})` }}
                            >
                                <div className={`absolute inset-0 bg-cover bg-center ${currentSlide === index ? 'scale-110 transition-transform duration-[10000ms] ease-out' : 'scale-100'}`} style={{ backgroundImage: `url(${img})` }}></div>
                            </div>
                        ))}

                        {phase >= 3 && (currentSlide === 3 || currentSlide === 4) && (
                            <div 
                                className="absolute inset-0 z-20 cursor-pointer"
                                onClick={() => {
                                    if (!flags.F08) {
                                        alert("【F08: 異様な光景】\n村の出口が封鎖され、村人たちがこちらを監視している幻覚が見えた。");
                                        unlockFlag('F08');
                                    }
                                }}
                            />
                        )}

                        <div className="absolute inset-0 bg-black/30 flex items-center justify-center p-6 z-30">
                            <div className="text-center text-white animate-fade-up">
                                <p className="text-sm md:text-base font-eng tracking-[0.2em] mb-4 uppercase drop-shadow-md">Organic Farm in Okukamifushi</p>
                                <h1 className="text-4xl md:text-6xl lg:text-7xl font-serif font-bold tracking-[0.15em] mb-8 leading-tight drop-shadow-lg">
                                    {phase >= 4 ? "逃 ゲ ラ レ ナ イ" : <>土と生きる、<br className="md:hidden" />循環する未来。</>}
                                </h1>
                                <Button variant="secondary" className="border-white text-white hover:bg-white hover:text-primary backdrop-blur-sm bg-white/10" onClick={() => setPage('products')}>
                                    商品を見る
                                </Button>
                            </div>
                        </div>

                        <div className="absolute bottom-8 left-0 right-0 flex justify-center gap-3 z-30">
                            {slides.map((_, index) => (
                                <button 
                                    key={index}
                                    onClick={() => setCurrentSlide(index)}
                                    className={`w-12 h-1 rounded-full transition-all duration-300 ${currentSlide === index ? 'bg-white opacity-100' : 'bg-white opacity-40 hover:opacity-70'}`}
                                />
                            ))}
                        </div>
                    </div>

                    <div className="py-20 px-6 bg-surface">
                        <div className="max-w-container mx-auto grid md:grid-cols-2 gap-16 md:gap-24">
                            <div>
                                <div className="flex justify-between items-end mb-8 border-b border-border pb-4">
                                    <h3 className="text-2xl font-serif">News</h3>
                                    <span className="text-sm font-eng text-muted cursor-pointer hover:text-primary">View All</span>
                                </div>
                                <ul className="space-y-6">
                                    {phase >= 2 && (
                                        <li 
                                            className="group cursor-pointer"
                                            onClick={() => {
                                                if (!flags.F03) {
                                                    alert("【F03: 管理人からのお知らせ】\nパスワード保護された「内部告発」ページへのリンクを発見した。");
                                                    unlockFlag('F03');
                                                }
                                            }}
                                        >
                                            <p className="text-xs text-accent font-eng mb-1">2026.01.20</p>
                                            <p className="group-hover:text-accent transition-colors font-medium">【重要】管理人からのお知らせ（関係者各位）</p>
                                        </li>
                                    )}
                                    <li className="group cursor-pointer">
                                        <p className="text-xs text-muted font-eng mb-1">2026.01.15</p>
                                        <p className="group-hover:text-primary transition-colors">本年の「朱実（あけみ）」の予約受付を開始しました。</p>
                                    </li>
                                    <li className="group cursor-pointer">
                                        <p className="text-xs text-muted font-eng mb-1">2026.01.08</p>
                                        <p className="group-hover:text-primary transition-colors">冬季実習生の受け入れを実施しました。</p>
                                    </li>
                                </ul>
                            </div>
                            
                            <div className="relative pl-8 border-l border-border hidden md:block">
                                <p className="text-lg font-serif leading-loose writing-vertical-rl text-text h-[300px]">
                                    奥神伏の深い森に抱かれたこの地で、<br/>
                                    私たちは土の声に耳を傾けます。<br/>
                                    自然の摂理に従い、命を育む。<br/>
                                    それが私たちの誇りです。
                                </p>
                            </div>
                        </div>
                    </div>

                    <AdSpace />
                </>
            );
        };

        // 2. VILLAGE (Gallery & Tree)
        const Village = ({ phase, unlockFlag, flags }) => {
            const [lightboxOpen, setLightboxOpen] = useState(false);

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="奥神伏村について" sub="OUR VILLAGE" />
                        
                        <div className="mb-20">
                            <img src={phase >= 3 ? IMAGES.village_night : IMAGES.village_normal} alt="Village View" className="w-full h-[60vh] object-cover rounded-2xl shadow-sm mb-8" />
                            <p className="max-w-2xl mx-auto text-center leading-loose text-muted font-serif">
                                四方を険しい山々に囲まれた奥神伏村。<br/>
                                独自の気候風土が、他にはない濃厚な味わいの作物を育てます。<br/>
                                古くからこの地には「神」が宿ると言われ、村人は自然を敬い、共に生きてきました。
                            </p>
                        </div>

                        <div className="mb-24 grid md:grid-cols-2 gap-12 items-center bg-white p-8 rounded-2xl shadow-sm">
                            <div className="order-2 md:order-1">
                                 <h3 className="text-2xl font-serif mb-6 text-text">冬の静寂</h3>
                                 <p className="text-muted leading-loose font-serif">
                                     冬は雪が多い地域ですが、一面の美しく白い姿へ村が変わります。<br/>
                                     しんしんと降り積もる雪の音しか聞こえない、静寂に包まれた冬の奥神伏もまた格別です。<br/>
                                     厳しさの中で育まれる命の力強さを感じてください。
                                 </p>
                            </div>
                            <div className="order-1 md:order-2">
                                <img src={IMAGES.village_snow} alt="Winter Village" className="w-full h-80 object-cover rounded-xl shadow-md hover:scale-[1.02] transition-transform duration-500" />
                            </div>
                        </div>

                        <AdSpace className="mb-24" />

                        <div className="bg-surface-2 rounded-2xl p-8 md:p-16 flex flex-col md:flex-row gap-12 items-center">
                            <div className="md:w-1/2">
                                <h3 className="text-2xl font-serif mb-4">御神木</h3>
                                <p className="text-muted leading-relaxed mb-6">
                                    村の中心にそびえ立つ、樹齢300年を超える大樹。<br/>
                                    村の守り神として、注連縄を張り、大切に祀られています。<br/>
                                    その樹皮の模様は、見る者によって様々な姿に見えると言われています。
                                </p>
                                <Button 
                                    variant="secondary" 
                                    onClick={() => {
                                        setLightboxOpen(true);
                                        if (phase >= 3 && !flags.F10) {
                                            unlockFlag('F10');
                                        }
                                    }}
                                >
                                    写真を拡大して見る
                                </Button>
                            </div>
                            <div className="md:w-1/2 w-full">
                                <img src={IMAGES.tree_default} alt="Sacred Tree" className="w-full h-80 object-cover rounded-lg shadow-md hover:grayscale transition-all duration-1000 cursor-zoom-in" onClick={() => setLightboxOpen(true)}/>
                            </div>
                        </div>
                    </div>

                    {lightboxOpen && (
                        <div className="fixed inset-0 z-[100] lightbox-overlay flex items-center justify-center p-4" onClick={() => setLightboxOpen(false)}>
                            <div className="relative max-w-4xl w-full max-h-screen">
                                <img 
                                    src={phase >= 3 ? IMAGES.tree_change : IMAGES.tree_default} 
                                    className="w-full h-auto max-h-[90vh] object-contain rounded shadow-2xl" 
                                />
                                {phase >= 3 && (
                                    <div className="absolute bottom-4 left-0 right-0 text-center bg-black/50 text-white p-2">
                                        <p className="font-serif text-sm">【F10 証拠】樹皮の継ぎ目に、外科手術のような縫合痕が見える...</p>
                                    </div>
                                )}
                                <button className="absolute -top-10 right-0 text-white" onClick={() => setLightboxOpen(false)}>閉じる</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 3. ABOUT (Greeting & Staff)
        const About = ({ phase, unlockFlag, flags }) => {
            const [greeting, setGreeting] = useState("台木は余計な枝葉を剪定します。良い実をつけるためには、親となる木が健康でなければなりません。");
            
            useEffect(() => {
                if (phase >= 2 && !flags.F09) {
                    const timer = setTimeout(() => {
                        setGreeting("柩木（ひつぎ）は余計な関節を剪定します。良い実をつけるためには、親となる生贄が健康でなければなりません。");
                        unlockFlag('F09');
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [phase, flags.F09]);

            const StaffCard = ({ img, name, role, comment, hiddenText }) => (
                <div className="bg-surface p-6 rounded-2xl hover-card text-center group h-full">
                    <div className="w-full aspect-[4/5] overflow-hidden rounded-xl mb-6 relative">
                        <img src={img} alt={name} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                        {role === "???" && (
                            <div 
                                className="absolute inset-0 bg-black/80 flex items-center justify-center cursor-pointer opacity-0 hover:opacity-100 transition-opacity"
                                onClick={() => {
                                    if (!flags.F06) {
                                        alert("【F06: 隠された実習生】\n行方不明の実習生の監禁映像を確認しました。");
                                        unlockFlag('F06');
                                    }
                                }}
                            >
                                <span className="text-white font-serif">データ破損</span>
                            </div>
                        )}
                    </div>
                    <p className="text-primary font-eng text-xs tracking-wider mb-2">{role}</p>
                    <h4 className="text-xl font-serif font-bold mb-3">{name}</h4>
                    <p className="text-sm text-muted leading-relaxed relative">
                        {comment}
                        {hiddenText && (
                            <span 
                                className="hidden-sos absolute top-0 left-0 w-full h-full bg-surface text-surface select-all cursor-text z-10"
                                onMouseUp={() => {
                                    if (window.getSelection().toString().includes("狂って") && !flags.F01) {
                                        alert("【F01: 副園長の隠しメッセージ】\n「この村は狂ってる。助けてくれ」");
                                        unlockFlag('F01');
                                    }
                                }}
                            >
                                {hiddenText}
                            </span>
                        )}
                    </p>
                </div>
            );

            return (
                <div className="min-h-screen pt-24 pb-20 bg-surface-2">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="農園について" sub="ABOUT US" />

                        <section className="grid md:grid-cols-2 gap-12 md:gap-24 items-center mb-32">
                            <div className="relative order-2 md:order-1">
                                <img src={IMAGES.staff_manager} className="w-full aspect-[4/5] object-cover rounded-2xl shadow-lg" alt="園長" />
                                <div className="absolute -bottom-6 -right-6 bg-white p-6 rounded-lg shadow-xl hidden md:block">
                                    <p className="font-serif font-bold text-lg">神去 巌</p>
                                    <p className="text-xs text-muted font-eng">園長 / Iwao Kamisari</p>
                                </div>
                            </div>
                            <div className="order-1 md:order-2 pt-8">
                                <h3 className="text-2xl md:text-3xl font-serif mb-8 leading-snug">
                                    自然の声を聞き、<br/>命を繋ぐ農業を。
                                </h3>
                                <div className="prose prose-lg text-text font-serif leading-loose mb-8">
                                    <p className="mb-4">
                                        奥神伏ファームへようこそ。<br/>
                                        私たちは、この土地の伝統を守りながら、持続可能な農業に取り組んでいます。
                                    </p>
                                    <p className="transition-all duration-1000 mb-4">
                                        {greeting}
                                    </p>
                                    <p>
                                        土壌の微生物、森の木々、そして私たち人間。すべてが循環の中にあります。
                                    </p>
                                </div>
                                <div className="hidden md:block">
                                    <img src={IMAGES.top_farm} className="h-32 w-full object-cover rounded-lg opacity-60 grayscale-[30%]" />
                                </div>
                            </div>
                        </section>

                        <section>
                            <div className="text-center mb-16">
                                <h3 className="text-2xl font-serif mb-4">スタッフ紹介</h3>
                                <p className="text-muted font-eng text-sm tracking-widest">OUR STAFF</p>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <StaffCard 
                                    img={IMAGES.staff_wife} 
                                    name="神去 トメ" 
                                    role="PROCESSOR" 
                                    comment="私の作るアップルパイは村一番の評判です。隠し味は愛情ですよ。" 
                                />
                                <StaffCard 
                                    img={IMAGES.staff_submanager} 
                                    name="佐藤 健太" 
                                    role="WEB MANAGER" 
                                    comment="都会の喧騒を離れ、この美しい村に移住しました。毎日が発見の連続です。"
                                    hiddenText="この村は狂ってる。出られない。助けてくれ。"
                                />
                                <StaffCard 
                                    img={IMAGES.staff_trainee} 
                                    name="グエン・マイ・リン" 
                                    role="TRAINEE" 
                                    comment="日本で農業を学べることに感謝しています。毎日が勉強です。" 
                                />
                                {phase >= 3 && (
                                <StaffCard 
                                    img={IMAGES.staff_victim} 
                                    name="No.1092" 
                                    role="???" 
                                    comment="..."
                                />
                                )}
                            </div>
                        </section>
                    </div>
                </div>
            );
        };

        // 4. PRODUCTS
        const Products = ({ phase, unlockFlag, flags }) => {
            const categories = ["ALL", "APPLE", "GRAPES", "PROCESSED"];
            const [videoModalOpen, setVideoModalOpen] = useState(false);

            const products = [
                { 
                    id: 1, 
                    name: "奥神伏りんご「朱実」", 
                    price: "¥5,000", 
                    cat: "APPLE", 
                    img: IMAGES.ec_apple,
                    desc: "驚くほどの糖度と、深紅の色合い。贈り物にも最適です。",
                    tags: ["#甘い", "#季節限定", "#ギフト"]
                },
                { 
                    id: 2, 
                    name: "手作りアップルパイ", 
                    price: "¥3,500", 
                    cat: "PROCESSED", 
                    img: IMAGES.ec_applepie, 
                    desc: "トメさん秘伝のレシピ。サクサクのパイ生地と甘酸っぱいフィリング。",
                    tags: ["#母の味", "#無添加", "#手作り"]
                },
                { 
                    id: 3, 
                    name: "有機栽培ブドウ", 
                    price: "¥8,000", 
                    cat: "GRAPES", 
                    img: IMAGES.ec_grape, 
                    desc: "接ぎ木技術の結晶。深いコクと香りをお楽しみください。",
                    tags: ["#キヅイテ", "#希少品種", "#ワイン用"]
                },
                { 
                    id: 4, 
                    name: "特製ジャム", 
                    price: "¥1,200", 
                    cat: "PROCESSED", 
                    img: IMAGES.ec_jam, 
                    desc: "完熟果実をそのまま煮詰めました。ヨーグルトに最適。",
                    tags: ["#朝食", "#オーガニック"]
                },
                { 
                    id: 5, 
                    name: "季節の詰め合わせ", 
                    price: "¥10,000", 
                    cat: "ALL", 
                    img: IMAGES.ec_set, 
                    desc: "旬の味覚を贅沢に詰め合わせました。ご贈答用に。",
                    tags: ["#数量限定", "#お中元"]
                },
                { 
                    id: 6, 
                    name: "Coming Soon...", 
                    price: "-", 
                    cat: "ALL", 
                    img: IMAGES.icon_default, 
                    desc: "新しい商品の準備中です。ご期待ください。",
                    tags: [],
                    isComingSoon: true
                },
            ];

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="商品一覧" sub="PRODUCTS" />

                        <div className="flex flex-wrap justify-center gap-4 md:gap-8 mb-16">
                            {categories.map((cat, idx) => (
                                <button key={cat} className={`text-sm font-eng tracking-widest px-4 py-2 rounded-full transition-colors ${idx === 0 ? 'bg-text text-white' : 'text-muted hover:bg-surface-2'}`}>
                                    {cat}
                                </button>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12 mb-20">
                            {products.map(p => (
                                <div key={p.id} className={`group cursor-pointer ${p.isComingSoon ? 'opacity-60' : ''}`}>
                                    <div className="aspect-square overflow-hidden rounded-2xl mb-4 bg-surface-2 relative flex items-center justify-center">
                                        {p.isComingSoon ? (
                                            <div className="text-center">
                                                <img src={p.img} alt={p.name} className="w-20 h-20 opacity-30 mx-auto mb-2" />
                                                <span className="font-eng tracking-widest text-muted">Coming Soon</span>
                                            </div>
                                        ) : (
                                            <img src={p.img} alt={p.name} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
                                        )}
                                    </div>
                                    <div className="text-left">
                                        <div className="flex justify-between items-baseline mb-2">
                                            <h3 className="text-lg font-serif font-bold">{p.name}</h3>
                                            <p className="text-sm font-eng text-muted">{p.price}</p>
                                        </div>
                                        <p className="text-sm text-muted mb-4 leading-relaxed border-b border-border pb-4">{p.desc}</p>
                                        
                                        <div className="flex flex-wrap gap-2">
                                            {p.tags.map((tag, i) => (
                                                <span 
                                                    key={i}
                                                    className={`text-[11px] px-2 py-1 rounded border border-border text-muted transition-colors ${tag === "#キヅイテ" ? "hover:border-accent hover:text-accent cursor-help font-bold" : ""}`}
                                                    onClick={(e) => {
                                                        if (tag === "#キヅイテ") {
                                                            e.stopPropagation();
                                                            if (phase >= 2) {
                                                                setVideoModalOpen(true);
                                                                if(!flags.F02) unlockFlag('F02');
                                                            }
                                                        }
                                                    }}
                                                >
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <AdSpace />
                    </div>

                    {videoModalOpen && (
                        <div className="fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4" onClick={() => setVideoModalOpen(false)}>
                            <div className="relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden shadow-2xl" onClick={e => e.stopPropagation()}>
                                <video 
                                    src={IMAGES.victim_movie} 
                                    controls 
                                    autoPlay 
                                    playsInline
                                    className="w-full h-full"
                                >
                                    Your browser does not support the video tag.
                                </video>
                                <button 
                                    className="absolute -top-10 right-0 text-white font-bold hover:text-accent transition-colors" 
                                    onClick={() => setVideoModalOpen(false)}
                                >
                                    [閉じる]
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 5. DIARY (Search Gimmick)
        const Diary = ({ phase, unlockFlag, flags }) => {
            const [search, setSearch] = useState("");
            const [isAncient, setIsAncient] = useState(false);

            const handleSearch = (e) => {
                e.preventDefault();
                if (phase >= 3 && search === "1826" && !flags.F07) {
                    setIsAncient(true);
                    unlockFlag('F07');
                    alert("【F07: 古いブログ】\n1826年の古文書データにアクセスしました。");
                }
            };

            const articles = isAncient ? [
                { id: 99, date: "1826.04.04", title: "開村の儀式に関する覚書", desc: "柩木（ひつぎ）を選定し、土に伏せ...", img: IMAGES.blog_oldbook }
            ] : [
                { id: 1, date: "2026.01.18", title: "今年も豊作です", desc: "神様に感謝します。今年の朱実は特に色が濃いです。", img: IMAGES.blog_harvest },
                { id: 2, date: "2026.01.10", title: "アップルパイのレシピを公開！", desc: "リクエストにお答えしてレシピを載せますね。", gimmick: true, img: IMAGES.blog_applepie },
                { id: 3, date: "2026.01.05", title: "みんなでご飯作り", desc: "寮のみんなで協力して夕食を作りました。", img: IMAGES.blog_food },
                { id: 4, date: "2026.01.01", title: "新年のご挨拶", desc: "本年も奥神伏ファームをよろしくお願いいたします。", img: IMAGES.blog_sunny },
            ];

            return (
                <div className={`min-h-screen pt-24 pb-20 ${isAncient ? 'bg-[#EAE0D5] text-[#4A3B32]' : ''}`}>
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="活動日誌" sub="FARM DIARY" />

                        <div className="flex flex-col md:flex-row gap-12">
                            <div className="md:w-1/4">
                                <form onSubmit={handleSearch} className="relative mb-8">
                                    <input 
                                        type="text" 
                                        placeholder="検索..." 
                                        className="w-full border-b border-border bg-transparent py-2 pr-8 outline-none focus:border-primary font-sans text-sm"
                                        value={search}
                                        onChange={(e) => setSearch(e.target.value)}
                                    />
                                    <i data-lucide="search" className="absolute right-0 top-2 w-4 h-4 text-muted"></i>
                                </form>
                                <div className="space-y-2 text-sm text-muted font-serif">
                                    <p>カテゴリー</p>
                                    <ul className="pl-4 space-y-1 border-l border-border">
                                        <li className="hover:text-primary cursor-pointer">農園の日常</li>
                                        <li className="hover:text-primary cursor-pointer">レシピ</li>
                                        <li className="hover:text-primary cursor-pointer">イベント</li>
                                    </ul>
                                </div>
                                
                                <AdSpace className="mt-12 hidden md:block" />
                            </div>

                            <div className="md:w-3/4 space-y-12">
                                {articles.map(article => (
                                    <article key={article.id} className="group cursor-pointer">
                                        <div className="flex flex-col md:flex-row gap-6 items-start">
                                            <div className="md:w-1/3 aspect-video bg-surface-2 rounded-lg overflow-hidden">
                                                <img src={article.img} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
                                            </div>
                                            <div className="md:w-2/3">
                                                <p className="text-xs font-eng text-muted mb-2">{article.date}</p>
                                                <h3 className={`text-xl font-serif font-bold mb-3 ${isAncient ? 'font-serif' : ''}`}>{article.title}</h3>
                                                <p className="text-sm text-muted leading-relaxed mb-4">{article.desc}</p>
                                                {article.gimmick ? (
                                                    <span className="text-primary text-sm font-medium hover:underline" onClick={() => {
                                                        if (phase >= 2 && !flags.F04) {
                                                            alert("【F04: アップルパイの秘密】\nレシピの材料に「睡眠導入剤」の記述を発見。");
                                                            unlockFlag('F04');
                                                        }
                                                    }}>続きを読む →</span>
                                                ) : (
                                                    <span className="text-primary text-sm font-medium hover:underline">続きを読む →</span>
                                                )}
                                            </div>
                                        </div>
                                    </article>
                                ))}
                                
                                <AdSpace />
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 6. ACCESS (Table & PDF)
        const Access = ({ phase, unlockFlag, flags }) => {
            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="アクセス" sub="ACCESS" />
                        
                        <div className="bg-surface rounded-2xl p-8 md:p-12 shadow-sm mb-12">
                            <div className="aspect-video w-full bg-surface-2 rounded-xl mb-8 overflow-hidden relative">
                                <img src={IMAGES.access_map} className="w-full h-full object-cover" />
                                <div className="absolute inset-0 flex items-center justify-center bg-black/10">
                                    <span className="bg-white px-4 py-2 font-eng text-sm tracking-widest shadow">OKUKAMIFUSHI MAP</span>
                                </div>
                            </div>

                            <div className="grid md:grid-cols-2 gap-12">
                                <div>
                                    <h3 className="text-xl font-serif font-bold mb-6">お車でお越しの場合</h3>
                                    <table className="w-full text-sm text-left">
                                        <tbody>
                                            <tr className="border-b border-border">
                                                <th className="py-4 font-normal text-muted">長野ICより</th>
                                                <td className="py-4">県道00号線を南へ 約90分</td>
                                            </tr>
                                            <tr className="border-b border-border">
                                                <th className="py-4 font-normal text-muted">駐車場</th>
                                                <td className="py-4">あり（要予約）</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div className="flex flex-col justify-center items-start">
                                    <p className="text-sm text-muted mb-6 leading-relaxed">
                                        詳細な住所は、ご予約確定後にメールにてご案内いたします。<br/>
                                        山道が続きますので、お気をつけてお越しください。
                                    </p>
                                    <Button variant="secondary" onClick={() => {
                                        if (!flags.F11) {
                                            alert("【F11: 謎の地図】\n地図の裏面に、栽培工程ではなく「人接ぎ」の工程表が書かれているのを発見した。");
                                            unlockFlag('F11');
                                        }
                                    }}>
                                        <i data-lucide="printer" className="w-4 h-4 mr-2"></i>
                                        詳細地図を印刷 (PDF)
                                    </Button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 7. RECRUIT (Timeline & Checkbox)
        const Recruit = ({ phase, unlockFlag, flags }) => {
            const [checks, setChecks] = useState({ q1: false, q2: false, q3: false });
            
            const handleCheck = (key) => {
                const newChecks = { ...checks, [key]: !checks[key] };
                setChecks(newChecks);
                if (newChecks.q3 && !flags.F05) {
                    alert("【F05: 外国人実習生の秘密】\n「パスポートの没収」「逃亡時の違約金」など、違法な雇用条件が表示された。");
                    unlockFlag('F05');
                }
            };

            return (
                <div className="min-h-screen pt-24 pb-20 bg-surface-2">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="採用情報" sub="RECRUIT" />

                        <div className="grid md:grid-cols-2 gap-12 mb-20">
                            <div>
                                <img src={IMAGES.top_farm} className="w-full h-full object-cover rounded-2xl shadow-lg" />
                            </div>
                            <div className="flex flex-col justify-center">
                                <h3 className="text-2xl font-serif mb-6">海外技能実習生 募集中</h3>
                                <p className="leading-loose text-muted mb-8">
                                    日本の伝統的な農業技術を学びませんか？<br/>
                                    私たちは、世界中から意欲ある若者を受け入れています。<br/>
                                    自然豊かな環境で、共に汗を流し、絆を深めましょう。
                                </p>
                                <ul className="space-y-4 text-sm">
                                    <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> 寮完備・食事付き</li>
                                    <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> 日本語学習サポートあり</li>
                                    <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> アットホームな職場</li>
                                </ul>
                            </div>
                        </div>

                        <div className="bg-surface p-8 rounded-2xl max-w-2xl mx-auto shadow-sm">
                            <h4 className="font-bold font-serif mb-6 text-center">応募前の確認事項</h4>
                            <div className="space-y-4">
                                <label className="flex items-center gap-4 p-4 border border-border rounded-lg cursor-pointer hover:bg-surface-2 transition-colors">
                                    <input type="checkbox" checked={checks.q1} onChange={() => handleCheck('q1')} className="accent-primary w-5 h-5" />
                                    <span className="text-sm">健康診断の受診に同意します</span>
                                </label>
                                <label className="flex items-center gap-4 p-4 border border-border rounded-lg cursor-pointer hover:bg-surface-2 transition-colors">
                                    <input type="checkbox" checked={checks.q2} onChange={() => handleCheck('q2')} className="accent-primary w-5 h-5" />
                                    <span className="text-sm">寮の規則を遵守します</span>
                                </label>
                                <label className="flex items-center gap-4 p-4 border border-border rounded-lg cursor-pointer hover:bg-surface-2 transition-colors group">
                                    <input type="checkbox" checked={checks.q3} onChange={() => handleCheck('q3')} className="accent-accent w-5 h-5" />
                                    <span className={`text-sm transition-colors ${checks.q3 ? 'text-accent font-bold' : ''}`}>
                                        {checks.q3 ? "パスポートの没収・外部連絡の遮断に同意します" : "その他の就業規則に同意します"}
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 8. CONTACT (Form Hijack)
        const Contact = ({ phase, unlockFlag, flags }) => {
            const [placeholder, setPlaceholder] = useState("山田 太郎");
            
            const handleFocus = () => {
                if (phase >= 1 && !flags.F12) {
                    setPlaceholder("助けて助けて助けて助けて");
                    setTimeout(() => {
                        setPlaceholder("山田 太郎");
                        alert("【F12: 問い合わせの乗っ取り】\n入力欄が一瞬「助けて」に変化した。何者かがSOSを送っている。");
                        unlockFlag('F12');
                    }, 300);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (phase >= 4) {
                    const evidenceCount = Object.values(flags).filter(Boolean).length;
                    if (evidenceCount >= 10) {
                         alert("【TRUE END】\n全員逮捕。佐藤副園長は救出された。");
                    } else {
                         alert("【NORMAL END】\n警察が到着したが、主要メンバーは逃亡していた。");
                    }
                    unlockFlag('F13');
                } else {
                    alert("現在、お問い合わせが混雑しております。");
                }
            };

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title={phase >= 4 ? "匿名通報" : "お問い合わせ"} sub={phase >= 4 ? "REPORT" : "CONTACT"} />

                        <div className="max-w-3xl mx-auto grid md:grid-cols-3 gap-12">
                            <div className="md:col-span-2">
                                <form className="space-y-8" onSubmit={handleSubmit}>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">お名前 <span className="text-accent">*</span></label>
                                        <input 
                                            type="text" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-lg"
                                            placeholder={placeholder}
                                            onFocus={handleFocus}
                                            required
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">メールアドレス <span className="text-accent">*</span></label>
                                        <input 
                                            type="email" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-lg"
                                            placeholder="example@email.com"
                                            required
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">
                                            {phase >= 4 ? "通報内容・特定した住所" : "お問い合わせ内容"} <span className="text-accent">*</span>
                                        </label>
                                        <textarea 
                                            rows="5" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-base resize-none"
                                            placeholder={phase >= 4 ? "住所と証拠を入力してください" : "ご質問をご記入ください"}
                                            required
                                        ></textarea>
                                    </div>
                                    <Button type="submit" className={`w-full py-4 ${phase >= 4 ? 'bg-accent hover:bg-red-900' : ''}`}>
                                        {phase >= 4 ? "警察に通報する" : "送信する"}
                                    </Button>
                                </form>
                            </div>

                            <div className="md:col-span-1 border-l border-border pl-8 hidden md:block">
                                <h4 className="font-bold font-serif mb-6">お電話でのお問い合わせ</h4>
                                <p className="text-2xl font-eng mb-2">026-000-0000</p>
                                <p className="text-xs text-muted mb-8">受付時間: 9:00 - 17:00 (土日祝除く)</p>
                                
                                <h4 className="font-bold font-serif mb-4">よくあるご質問</h4>
                                <ul className="text-sm text-muted space-y-3">
                                    <li className="hover:text-primary cursor-pointer">・ 予約のキャンセルについて</li>
                                    <li className="hover:text-primary cursor-pointer">・ ギフトラッピングについて</li>
                                    <li className="hover:text-primary cursor-pointer">・ アレルギー対応について</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [currentPage, setPage] = useState('home');
            const [phase, setPhase] = useState(1);
            const [flags, setFlags] = useState({});

            // ページ切り替え時にトップへスクロールする処理を追加
            useEffect(() => {
                window.scrollTo(0, 0);
            }, [currentPage]);

            // Phase Logic (Simplified)
            useEffect(() => {
                const count = Object.keys(flags).length;
                let nextPhase = 1;
                if (count >= 3) nextPhase = 2;
                if (count >= 6) nextPhase = 3;
                if (count >= 9) nextPhase = 4;
                
                if (nextPhase > phase) setPhase(nextPhase);
            }, [flags, phase]);

            useEffect(() => {
                // Apply phase to body for CSS variables
                document.body.setAttribute('data-phase', phase);
            }, [phase]);

            useEffect(() => {
                // Lucide icons
                lucide.createIcons();
            }, [currentPage]);

            const unlockFlag = (flagId) => {
                if (!flags[flagId]) {
                    setFlags(prev => ({ ...prev, [flagId]: true }));
                }
            };

            const renderPage = () => {
                const props = { phase, unlockFlag, flags, setPage };
                switch(currentPage) {
                    case 'home': return <Home {...props} />;
                    case 'about': return <About {...props} />;
                    case 'village': return <Village {...props} />;
                    case 'products': return <Products {...props} />;
                    case 'diary': return <Diary {...props} />;
                    case 'access': return <Access {...props} />;
                    case 'recruit': return <Recruit {...props} />;
                    case 'contact': return <Contact {...props} />;
                    default: return <Home {...props} />;
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans text-text">
                    <Header setPage={setPage} currentPage={currentPage} phase={phase} />
                    <main className="flex-grow">
                        {renderPage()}
                    </main>
                    <Footer phase={phase} setPage={setPage} />

                    {/* Debug UI (Hidden in production concept, kept for testing) */}
                    <div className="fixed bottom-2 right-2 opacity-30 hover:opacity-100 z-[100] text-[10px] bg-black text-white p-2 rounded">
                        Phase: {phase} | Flags: {Object.keys(flags).length}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
