<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ  | åœŸã¨ç”Ÿãã‚‹ã€å¾ªç’°ã™ã‚‹æœªæ¥ã€‚</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: 'var(--bg)',
                        surface: 'var(--surface)',
                        'surface-2': 'var(--surface-2)',
                        text: 'var(--text)',
                        muted: 'var(--muted)',
                        border: 'var(--border)',
                        primary: 'var(--primary)',
                        'primary-2': 'var(--primary-2)',
                        accent: 'var(--accent)',
                    },
                    fontFamily: {
                        serif: ['Shippori Mincho', 'serif'],
                        sans: ['Noto Sans JP', 'sans-serif'],
                        eng: ['Montserrat', 'sans-serif'],
                        handwriting: ['Yuji Syuku', 'serif'],
                    },
                    maxWidth: {
                        'container': '1200px',
                    },
                    animation: {
                        'ken-burns': 'kenBurns 20s ease-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        kenBurns: {
                            '0%': { transform: 'scale(1)' },
                            '100%': { transform: 'scale(1.1)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Shippori+Mincho:wght@400;500;600;700&family=Montserrat:wght@400;600&family=Yuji+Syuku&display=swap" rel="stylesheet">

    <style>
        /* Design Tokens & Theme Variables */
        :root {
            /* Base Colors (Natural Modern) */
            --bg: #FAFAF7;
            --surface: #FFFFFF;
            --surface-2: #F3F4F0;
            --text: #1C1F1D;
            --muted: #5C625E;
            --border: #E6E8E2;
            --primary: #2F6B3E;
            --primary-2: #214E2C;
            --accent: #8A2E2E; /* Horror Accent */
            
            /* Spacing */
            --header-height: 88px;
        }

        /* Phase 2: Slight Unease */
        [data-phase="2"] {
            --bg: #F5F5F0;
            --text: #2C2F2D;
            --muted: #6C726E;
            filter: contrast(0.95) sepia(0.1);
        }

        /* Phase 3: Horror */
        [data-phase="3"] {
            --bg: #EAE8E0;
            --text: #111;
            --surface: #F9F7F2;
            --primary: #1A3E24;
            filter: contrast(1.1) grayscale(0.3) brightness(0.9);
        }

        /* Phase 4: Nightmare */
        [data-phase="4"] {
            --bg: #0F1210;
            --surface: #1C1F1D;
            --surface-2: #2A2F2B;
            --text: #D1D5DB;
            --muted: #9CA3AF;
            --border: #374151;
            --primary: #8A2E2E; /* Green becomes Blood Red */
            --primary-2: #601818;
            filter: contrast(1.2) grayscale(0.8);
        }

        /* --- æœ¬æ ¼ãƒ›ãƒ©ãƒ¼æ¼”å‡ºç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« --- */
        
        /* ç”»é¢å…¨ä½“ã®ãƒã‚¤ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes noise-anim {
            0% { clip-path: inset(40% 0 61% 0); transform: skew(0.7deg); }
            20% { clip-path: inset(92% 0 1% 0); transform: skew(0.5deg); }
            40% { clip-path: inset(43% 0 1% 0); transform: skew(0.2deg); }
            60% { clip-path: inset(25% 0 58% 0); transform: skew(0.7deg); }
            80% { clip-path: inset(54% 0 7% 0); transform: skew(0.1deg); }
            100% { clip-path: inset(58% 0 43% 0); transform: skew(0.6deg); }
        }

        /* èµ¤é»’ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ãƒã‚¤ã‚º */
        .horror-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(20, 0, 0, 0.85);
            z-index: 9999;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            mix-blend-mode: multiply;
            overflow: hidden;
        }

        .horror-overlay::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://raw.githubusercontent.com/dh0320/okukamimurafarm/f273d82bcc2d0c08371bb0e42d3169c3d36e4b9b/images/villagenight.png') no-repeat center center;
            background-size: cover;
            opacity: 0.3;
            filter: grayscale(100%) contrast(200%);
            mix-blend-mode: overlay;
            animation: noise-anim 0.15s infinite;
        }

        /* å‘¨è¾ºæ¸›å…‰ï¼ˆãƒˆãƒ³ãƒãƒ«åŠ¹æœï¼‰ */
        .horror-vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 40%, #000 90%);
            z-index: 10000;
            pointer-events: none;
        }

        /* æ¿€ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒªãƒƒãƒã¨æŒ¯å‹• */
        .intense-glitch {
            font-family: 'Yuji Syuku', serif !important;
            color: #ffffff !important;
            position: relative;
            display: inline-block;
            font-size: 1.8rem !important;
            font-weight: 900;
            text-shadow: 2px 2px 0px #8A2E2E, -2px -2px 0 #000;
            animation: text-shake 0.1s infinite;
            letter-spacing: 0.1em;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8));
        }
        
        @keyframes text-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2px, 2px) rotate(1deg); }
            50% { transform: translate(-2px, -2px) rotate(-1deg); }
            75% { transform: translate(-2px, 2px) rotate(0.5deg); }
            100% { transform: translate(2px, -2px) rotate(-0.5deg); }
        }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è‡ªä½“ã®æ­ªã¿ */
        .distorted-checkbox {
            filter: invert(1) drop-shadow(0 0 5px red);
            transform: scale(1.2);
        }

        /* ç”»åƒç”¨ã‚°ãƒªãƒƒãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆ (åœ’é•·å¤‰åŒ–ç”¨) */
        @keyframes image-glitch {
            0% { transform: translate(0); filter: hue-rotate(0deg); }
            20% { transform: translate(-2px, 2px); filter: hue-rotate(90deg) contrast(1.2); }
            40% { transform: translate(-2px, -2px); filter: hue-rotate(0deg) invert(0.1); }
            60% { transform: translate(2px, 2px); filter: hue-rotate(-90deg) contrast(1.5); }
            80% { transform: translate(2px, -2px); filter: hue-rotate(0deg); }
            100% { transform: translate(0); filter: hue-rotate(0deg); }
        }

        @media (prefers-reduced-motion: reduce) {
            .horror-overlay::before,
            .intense-glitch,
            .image-glitching {
                animation: none !important;
            }
        }

        [data-reduce-motion="true"] .horror-overlay::before,
        [data-reduce-motion="true"] .intense-glitch,
        [data-reduce-motion="true"] .image-glitching {
            animation: none !important;
        }
        
        .image-glitching {
            animation: image-glitch 0.2s infinite;
            filter: contrast(1.2) brightness(0.8) sepia(0.5) hue-rotate(-50deg) !important;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--muted);
            border-radius: 99px;
        }

        /* F01: é¸æŠã™ã‚‹ã¨è¦‹ãˆã‚‹éš ã—æ–‡ */
        .hidden-sos {
            color: transparent;
            user-select: text;
        }
        .hidden-sos::selection {
            color: #8A2E2E;
            background: rgba(138, 46, 46, 0.25);
        }
        .hidden-sos::-moz-selection {
            color: #8A2E2E;
            background: rgba(138, 46, 46, 0.25);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- Data & Assets ---
        const BASE_URL = "https://raw.githubusercontent.com/dh0320/okukamimurafarm/f273d82bcc2d0c08371bb0e42d3169c3d36e4b9b";
        const IMAGES = {
            // Top Slideshow
            top_farm: `${BASE_URL}/images/topfarm.png`,
            top_staff: `${BASE_URL}/images/topstaff.png`,
            top_apple: `${BASE_URL}/images/topapple.png`,
            top_children: `${BASE_URL}/images/topchildren.png`,
            top_morning: `${BASE_URL}/images/topmorning.png`,
            // Top Horror Changes (Phase 3)
            top_change_village: `${BASE_URL}/images/topchangevillage.png`,
            top_change_stop: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/topchangestop.png",

            // Icon (Header)
            icon_default: `${BASE_URL}/images/icondefault.png`,
            icon_change_1: `${BASE_URL}/images/iconchange1.png`,
            icon_change_2: `${BASE_URL}/images/iconchange2.png`,
            icon_change_3: `${BASE_URL}/images/iconchange3.png`,

            // Products
            ec_apple: `${BASE_URL}/images/ecapple.png`,
            ec_applepie: `${BASE_URL}/images/ecapplepie.png`,
            ec_grape: `${BASE_URL}/images/ecgrape.png`,
            ec_jam: `${BASE_URL}/images/ecjam.png`,
            ec_set: `${BASE_URL}/images/ecset.png`,

            // Blog
            blog_sunny: `${BASE_URL}/images/blogsunny.png`,
            blog_applepie: `${BASE_URL}/images/blogapplepie.png`,
            blog_harvest: `${BASE_URL}/images/blogharvest.png`,
            blog_food: `${BASE_URL}/images/blogfood.png`,
            blog_oldbook: `${BASE_URL}/images/blogoldbook.png`,

            // Staff
            staff_manager: `${BASE_URL}/images/staffmanager.png`,
            staff_manager_change: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/cce9c3db56a9593996fa1381a826289236d747a2/images/staffmanagerchange.png",
            staff_submanager: `${BASE_URL}/images/staffsubmanager.png`,
            staff_wife: `${BASE_URL}/images/staffwife.png`,
            staff_trainee: `${BASE_URL}/images/stafftrainee.png`,
            staff_victim: `${BASE_URL}/images/staffvictim.png`,
            staff_victim2: `${BASE_URL}/images/staffvictim2.png`,

            // Symbol Tree
            tree_default: `${BASE_URL}/images/treedefault.png`,
            tree_change: `${BASE_URL}/images/treechange.png`,

            // Village
            village_normal: `${BASE_URL}/images/villagenormal.png`,
            village_snow: `${BASE_URL}/images/villagesnow.png`,
            village_night: `${BASE_URL}/images/villagenight.png`,

            // Access
            access_map: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/access.png",

            // Video
            victim_movie: `${BASE_URL}/images/victimmovie.mp4`,
            stop_movie: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/stopmovie.mp4",

            // Recruit
            recruiting: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/recruiting.png",
            recruiting_change: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/recruitingchange.png",

            // Recipe
            recipe_applepie: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/main/images/applepierecipe.png",

            // Grafting
            grafting: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/52ef76040ef84ddb52fdf5827a52315f4c4d9ec7/images/tsugiki.png",

            // Ending (temporary reuse)
            ending_silenced: `${BASE_URL}/images/staffvictim2.png`,
            ending_normal: `${BASE_URL}/images/villagenight.png`,
            ending_true: `${BASE_URL}/images/treechange.png`,
            ending_perfect: "https://raw.githubusercontent.com/dh0320/okukamimurafarm/cce9c3db56a9593996fa1381a826289236d747a2/images/staffmanagerchange.png"
        };

        // è¨˜äº‹ãƒ‡ãƒ¼ã‚¿
        const BLOG_DATA = [
            {
                id: 4,
                date: "2026.01.18",
                title: "é‡èœã®åç©«",
                desc: "ãƒªãƒ³ã‚´ã ã‘ã§ãªãç¾å‘³ã—ã„é‡èœã‚‚ãŸãã•ã‚“ã¨ã‚Œã¾ã™ï¼ç¥æ§˜ã«æ„Ÿè¬ã§ã™ï¼",
                img: IMAGES.blog_harvest,
                content: `ã€Œå¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ï¼ã‚Šã‚“ã”ã€ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã£ã¦ãã ã•ã‚‹æ–¹ãŒå¤šã„ã®ã§ã™ãŒã€å®Ÿã¯é‡èœã‚‚ãŸãã•ã‚“è‚²ã¦ã¦ã„ã¾ã™ã€‚\nä»Šæ—¥ã¯ã€ç•‘ã®é‡èœã‚’ã¾ã¨ã‚ã¦åç©«ã—ã¾ã—ãŸï¼\n\nåœŸã‹ã‚‰å¼•ãä¸Šã’ãŸç¬é–“ã«åˆ†ã‹ã‚‹ã€æ ¹ã®å¼µã‚Šå…·åˆã€‚\nè‘‰ã®å¼µã‚Šã€è‰²ã€é¦™ã‚Šã€‚\næ‰‹ã«å–ã‚‹ã ã‘ã§ã€Œã‚ˆãè‚²ã£ã¦ãã‚ŒãŸãªã‚ã€ã¨æ€ãˆã‚‹ç¬é–“ãŒã‚ã£ã¦ã€ã“ã‚ŒãŒç•‘ã®ä»•äº‹ã®é†é†å‘³ã§ã™ã€‚\n\nåç©«ã§ããŸã®ã¯ã€\nãƒ»ã¿ãšã¿ãšã—ã„è‘‰ç‰©\nãƒ»ç”˜ã¿ã®ã®ã£ãŸæ ¹èœ\nãƒ»æ–™ç†ãŒæ¥½ã—ããªã‚‹ãƒãƒ¼ãƒ–\nãªã©ã€é£Ÿå“ãŒãã£ã¨è±Šã‹ã«ãªã‚‹ã‚‚ã®ã°ã‹ã‚Šã€‚\n\nè‡ªç„¶ç›¸æ‰‹ã®ä»•äº‹ãªã®ã§ã€ã†ã¾ãã„ã‹ãªã„æ—¥ã‚‚ã‚ã‚Šã¾ã™ã€‚\nãã‚Œã§ã‚‚ã€å¤ªé™½ã¨é›¨ã¨åœŸã€ãã—ã¦äººã®æ‰‹ãŒãã‚ã£ã¦ã€Œå®Ÿã‚Šã€ã«ãªã£ãŸã¨ãã¯ã€ã‚„ã£ã±ã‚Šèƒ¸ãŒã„ã£ã±ã„ã«ãªã‚Šã¾ã™ã€‚ç¥æ§˜ã«æ„Ÿè¬ã§ã™ã€‚\n\nã“ã‚Œã‹ã‚‰ã‚‚ã€æœå®Ÿã‚‚é‡èœã‚‚ã€å¥¥ç¥ä¼ã®å­£ç¯€ã‚’ãã®ã¾ã¾æ„Ÿã˜ã‚‰ã‚Œã‚‹å‘³ã‚’ãŠå±Šã‘ã§ãã‚‹ã‚ˆã†ã€ä¸å¯§ã«è‚²ã¦ã¦ã„ãã¾ã™ã€‚\nåç©«ã®æ§˜å­ã¯å†™çœŸã§ã‚‚ãŸã£ã·ã‚Šæ²è¼‰ã—ã¾ã™ã®ã§ã€ãœã²ã®ãã„ã¦ãã ã•ã„ã­ã€‚`
            },
            {
                id: 3,
                date: "2026.01.10",
                title: "æ‘ã®å­ä¾›é”ã¨ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤ä½œã‚Šä½“é¨“ï¼",
                desc: "å­ä¾›é”ã¨ã®ãƒ‘ã‚¤ä½œã‚Šï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãŠç­”ãˆã—ã¦ãƒ¬ã‚·ãƒ”ã‚‚æ²è¼‰ã—ã¾ã™ã­ï¼",
                img: IMAGES.blog_applepie,
                isRecipe: true,
                content: `å…ˆæ—¥ã€æ‘ã®å­ã©ã‚‚ãŸã¡ã¨ä¸€ç·’ã«ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤ä½œã‚Šä½“é¨“ã‚’ã—ã¾ã—ãŸã€‚\nã‚¨ãƒ—ãƒ­ãƒ³å§¿ã§é›†ã¾ã£ã¦ãã‚‹ã ã‘ã§ã€ã‚­ãƒƒãƒãƒ³ãŒä¸€æ°—ã«ã«ãã‚„ã‹ã«ã€‚ã‚Šã‚“ã”ã‚’åˆ‡ã‚‹éŸ³ã€ç¬‘ã„å£°ã€ç”˜ã„é¦™ã‚Šâ€¦ã“ã®æ™‚é–“ã ã‘ã§ã€Œã‚„ã£ã¦ã‚ˆã‹ã£ãŸãªã‚ã€ã¨æ€ãˆã¾ã™ã€‚\n\nä»Šå›ä½¿ã£ãŸã‚Šã‚“ã”ã¯ã€ã—ã£ã‹ã‚Šç”˜ã¿ãŒã®ã£ãŸã‚‚ã®ã‚’é¸ã‚“ã§ã€ã‚·ãƒŠãƒ¢ãƒ³ã¯æ§ãˆã‚ã«ã€‚\nå°ã•ãªæ‰‹ã§ã‚‚æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«ã€ã‚Šã‚“ã”ã¯å°‘ã—è–„ã‚ã«ã‚«ãƒƒãƒˆã—ã¦ã€ç«å…¥ã‚Œã‚‚çŸ­æ™‚é–“ã§ä»•ä¸Šã’ã¾ã—ãŸã€‚\n\nç„¼ãã‚ãŒã£ãŸãƒ‘ã‚¤ã‚’ã‚ªãƒ¼ãƒ–ãƒ³ã‹ã‚‰å‡ºã—ãŸç¬é–“ã€\nã€Œã‚ã‚ã€œï¼ã€ã£ã¦å£°ãŒæƒã†ã®ãŒæœ€é«˜ã§ã™ã€‚\nè¡¨é¢ãŒã“ã‚“ãŒã‚Šè‰²ã¥ã„ã¦ã€ãµã‚ã£ã¨ç«‹ã¤é¦™ã‚ŠãŒãŸã¾ã‚Šã¾ã›ã‚“ã€‚\n\nã€ŒãŠã†ã¡ã§ã‚‚ä½œã‚ŠãŸã„ï¼ã€ã¨ã„ã†å£°ãŒå¤šã‹ã£ãŸã®ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãŠå¿œãˆã—ã¦ãƒ¬ã‚·ãƒ”ã‚‚ã¾ã¨ã‚ã¾ã—ãŸã€‚\nä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã”è¦§ã„ãŸã ã‘ã¾ã™ğŸ‘‡\n\næœ€å¾Œã«ã€å‚åŠ ã—ã¦ãã‚ŒãŸã¿ã‚“ãªã¸ã€‚\nåŒ…ä¸ã‚’æŒã¤æ‰‹ã‚‚ã€ãƒ‘ã‚¤ç”Ÿåœ°ã‚’ä¼¸ã°ã™æ‰‹ã‚‚ã€ã¨ã£ã¦ã‚‚çœŸå‰£ã§ç´ æ•µã§ã—ãŸã€‚\nã¾ãŸå­£ç¯€ãŒå¤‰ã‚ã£ãŸã‚‰ã€åˆ¥ã®ãŠè“å­ã§ã‚‚ä¸€ç·’ã«ä½œã‚ã†ã­ã€‚`
            },
            {
                id: 2,
                date: "2026.01.05",
                title: "ã¿ã‚“ãªã§ã”é£¯ä½œã‚Š",
                desc: "è¾²åœ’ã®ã¿ã‚“ãªã§ãƒ©ãƒ³ãƒã«é‡èœãŸãã•ã‚“ã®ãƒ”ã‚¶ã‚’ä½œã‚Šã¾ã—ãŸï¼",
                img: IMAGES.blog_food,
                content: `ä»Šæ—¥ã¯å°‘ã—æ‰‹ãŒç©ºã„ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€è¾²åœ’ã®ã¿ã‚“ãªã§ãƒ©ãƒ³ãƒä½œã‚Šã€‚\nã€Œã›ã£ã‹ãã ã—ã€ç•‘ã®é‡èœã‚’æ€ã„ã£ãã‚Šä½¿ãŠã†ï¼ã€ã¨ã„ã†ã“ã¨ã§ã€é‡èœãŸã£ã·ã‚Šã®ãƒ”ã‚¶ã‚’ç„¼ãã¾ã—ãŸğŸ•ğŸ¥¬\n\nç•‘ã‹ã‚‰æ¡ã£ã¦ããŸã®ã¯ã€\nã‚ºãƒƒã‚­ãƒ¼ãƒ‹ã€ç‰ã­ãã€ã»ã†ã‚Œã‚“è‰ã€ãƒŸãƒ‹ãƒˆãƒãƒˆã€ãã—ã¦é¦™ã‚Šã®è‰¯ã„ãƒãƒ¼ãƒ–ã€‚\nåˆ‡ã£ã¦ä¸¦ã¹ã‚‹ã ã‘ã§ã‚‚è‰²ãŒãã‚Œã„ã§ã€ã‚­ãƒƒãƒãƒ³ãŒä¸€æ°—ã«å…ƒæ°—ã«ãªã‚Šã¾ã™ã€‚\n\nãƒ”ã‚¶ä½œã‚Šã£ã¦ã€å®Ÿã¯è¾²åœ’ã®ä»•äº‹ã«ã¡ã‚‡ã£ã¨ä¼¼ã¦ã„ã¦ã€‚\nã€Œã©ã‚Œã‚’ã€ã©ã®é †ç•ªã§ã€ã©ã†ä¸¦ã¹ãŸã‚‰ä¸€ç•ªãŠã„ã—ããªã‚‹ã‹ã€\nã¿ã‚“ãªã§ç›¸è«‡ã—ãªãŒã‚‰æ‰‹ã‚’å‹•ã‹ã—ã¦ã„ã‚‹æ™‚é–“ãŒã€ã™ã”ãæ¥½ã—ã„ã‚“ã§ã™ã€‚\n\nç„¼ãä¸ŠãŒã‚Šã¯ã€å¤–ã¯ã‚«ãƒªãƒƒã¨ä¸­ã¯ã‚‚ã¡ã£ã¨ã€‚\né‡èœãŒã˜ã‚…ã‚ã£ã¨ç”˜ãã¦ã€æ€ã‚ãšç„¡è¨€ã«ãªã‚‹ãŠã„ã—ã•ã§ã—ãŸã€‚\nï¼ˆæ°—ã¥ã„ãŸã‚‰ä¸€æšç›®ãŒä¸€ç¬ã§æ¶ˆãˆã¦ã¾ã—ãŸâ€¦ç¬‘ï¼‰\n\nè¾²åœ’ã®æ—¥å¸¸ã¯æ´¾æ‰‹ã˜ã‚ƒãªã„ã‘ã‚Œã©ã€ã“ã†ã„ã†å°ã•ãªâ€œã”è¤’ç¾â€ãŒã‚ã‚‹ã¨ã€åˆå¾Œã®ä½œæ¥­ã‚‚é ‘å¼µã‚Œã¾ã™ã€‚\nã¾ãŸå­£ç¯€ã®é‡èœã§ã€åˆ¥ã®ãƒ”ã‚¶ã‚‚è©¦ã—ã¦ã¿ãŸã„ã§ã™ã­ã€‚`
            },
            {
                id: 1,
                date: "2026.01.01",
                title: "æ–°å¹´ã®ã”æŒ¨æ‹¶",
                desc: "æœ¬å¹´ã‚‚å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚",
                img: IMAGES.blog_sunny,
                content: `ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ã§ã™ã€‚\næ—§å¹´ä¸­ã¯ã€ç§ãŸã¡ã®è¾²åœ’ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã‚Šã€æ¸©ã‹ã„è¨€è‘‰ã‚„å¿œæ´ã‚’ãŸãã•ã‚“ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\nå†¬ã®å¥¥ç¥ä¼ã¯ã€ç©ºæ°—ãŒãã‚Šã£ã¨æ¾„ã‚“ã§ã„ã¦ã€æœã¯ç•‘ãŒç™½ããµã‚ã£ã¨éœœã§è¦†ã‚ã‚Œã¾ã™ã€‚åç©«ã®ã«ãã‚„ã‹ã•ãŒè½ã¡ç€ã„ãŸã“ã®å­£ç¯€ã¯ã€æ¥ã‚‹æ˜¥ã®ãŸã‚ã®â€œä»•è¾¼ã¿â€ã®æ™‚æœŸã€‚æœæ¨¹ã®æ‰‹å…¥ã‚Œã‚„åœŸã¥ãã‚Šã€ä»Šå¹´ã®ç•‘ã®è¨ˆç”»ã‚’ç«‹ã¦ãªãŒã‚‰ã€å°‘ã—ãšã¤æ¬¡ã®å­£ç¯€ã¸å‘ã‘ã¦æ•´ãˆã¦ã„ãã¾ã™ã€‚\n\nä»Šå¹´ã‚‚ã€\nãƒ»æ—¬ã®æœå®Ÿã‚„é‡èœã®ã“ã¨\nãƒ»åç©«ã‚„åŠ å·¥ã®è£å´\nãƒ»ä½“é¨“ã‚¤ãƒ™ãƒ³ãƒˆã®æ§˜å­\nãƒ»æ‘ã®å››å­£ã®é¢¨æ™¯\nã‚’ã€å†™çœŸã¨ä¸€ç·’ã«æ—¥èªŒã§ã“ã¾ã‚ã«ãŠå±Šã‘ã—ã¦ã„ãäºˆå®šã§ã™ã€‚\n\nã€Œã“ã“ã«æ¥ã‚‹ã¨ã€ãªã‚“ã ã‹å‘¼å¸ãŒæ·±ããªã‚‹ã€\nãã‚“ãªå ´æ‰€ã§ã‚ã‚Šç¶šã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€å®¶æ—ã¨ã‚¹ã‚¿ãƒƒãƒ•ã¿ã‚“ãªã§ä¸å¯§ã«è‚²ã¦ã¦ã„ãã¾ã™ã€‚\n\næœ¬å¹´ã‚‚å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ã‚’ã€ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚\nå¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ä¸€åŒ`
            }
        ];

        // ã‚¹ã‚¿ãƒƒãƒ•è©³ç´°ãƒ‡ãƒ¼ã‚¿
        const STAFF_DATA = [
            {
                id: 'yuri',
                name: 'ç¥å» ç”±åˆ©',
                role: 'PROCESSOR',
                role_jp: 'åŠ å·¥å“ãƒ»è¾²åœ’ã‚­ãƒƒãƒãƒ³æ‹…å½“',
                image: IMAGES.staff_wife,
                short_intro: 'å­£ç¯€ã®æ‰‹ã—ã”ã¨ã§ã€ã‚„ã•ã—ã„å‘³ã‚’å±Šã‘ã¾ã™', 
                intro: `å¥¥ç¥ä¼è¾²åœ’ã§åŠ å·¥å“ã¥ãã‚Šã¨è¾²åœ’ã‚­ãƒƒãƒãƒ³ã‚’æ‹…å½“ã—ã¦ã„ã‚‹ã€ç¥å»ç”±åˆ©ã§ã™ã€‚åç©«ã—ãŸæœå®Ÿã®é¦™ã‚Šã‚„ç”˜ã¿ã‚’å¤§åˆ‡ã«ã—ãªãŒã‚‰ã€ã‚¸ãƒ£ãƒ ã‚„ç„¼ãè“å­ã€å­£ç¯€ã®ä¿å­˜é£Ÿã‚’æ‰‹ä»•äº‹ã§ä»•è¾¼ã‚“ã§ã„ã¾ã™ã€‚ãŠè¶Šã—ã„ãŸã ã„ãŸæ–¹ãŒã»ã£ã¨ã§ãã‚‹ã‚ˆã†ãªã€ç´ æœ´ã§ã‚„ã•ã—ã„å‘³ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚`,
                reason: `å®¶æ—ã®å–¶ã‚€è¾²åœ’ã®æ‰‹ä¼ã„ã‚’ã—ã¦ã„ãä¸­ã§ã€ã€Œæ¡ã‚ŒãŸã¦ã‚’ãã®ã¾ã¾å±Šã‘ã‚‹ã ã‘ã§ãªãã€å­£ç¯€ã®æµã¿ã‚’ä¸€å¹´ä¸­æ¥½ã—ã‚ã‚‹å½¢ã«ã—ãŸã„ã€ã¨æ€ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚æ˜”ã‹ã‚‰å®¶ã§ä½œã£ã¦ã„ãŸä¿å­˜é£Ÿã‚„ãŠè“å­ã‚’ã€å°‘ã—ãšã¤è¾²åœ’ã®â€œé¡”â€ã¨ã—ã¦ãŠå±Šã‘ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ãŒå§‹ã¾ã‚Šã§ã™ã€‚`,
                joy: `å®Œç†Ÿã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚ã¦ä»•è¾¼ã‚“ã åŠ å·¥å“ãŒã€ã€Œã¾ãŸé£Ÿã¹ãŸã„ã€ã¨è¨€ã£ã¦ã‚‚ã‚‰ãˆãŸæ™‚ãŒä¸€ç•ªã†ã‚Œã—ã„ã§ã™ã€‚è¦æ ¼å¤–ã®æœå®Ÿã‚‚ç„¡é§„ã«ã›ãšã€ãŠã„ã—ã•ã«å¤‰ãˆã¦ã„ã‘ã‚‹ã®ã‚‚ã‚„ã‚ŠãŒã„ã§ã™ã­ã€‚å­£ç¯€ã”ã¨ã«é¦™ã‚Šã‚„æ°´åˆ†é‡ãŒå¤‰ã‚ã‚‹ã®ã§ã€æ¯å¹´åŒã˜ã‚ˆã†ã§åŒã˜ã«ãªã‚‰ãªã„ã¨ã“ã‚ã‚‚é¢ç™½ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚`
            },
            {
                id: 'sato',
                name: 'ä½è—¤ å¥å¤ª',
                role: 'WEB MANAGER',
                role_jp: 'å‰¯åœ’é•·ãƒ»Web/åºƒå ±ãƒ»ä½“é¨“é‹å–¶',
                image: IMAGES.staff_submanager,
                short_intro: 'è¾²æ¥­ã‚’æ¥½ã—ã¿ãªãŒã‚‰ã€ç•‘ã‚„å¥¥ç¥ä¼æ‘ã®é­…åŠ›ã‚’ä¼ãˆã¾ã™', 
                intro: `å‰¯åœ’é•·ã®ä½è—¤å¥å¤ªã§ã™ã€‚è¾²åœ’ã®é‹å–¶ã‚µãƒãƒ¼ãƒˆã«åŠ ãˆã¦ã€Webã‚µã‚¤ãƒˆã‚„ãŠå•ã„åˆã‚ã›å¯¾å¿œã€ä½“é¨“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã”æ¡ˆå†…ãªã©ã€Œå¤–ã¨è¾²åœ’ã‚’ã¤ãªãå½¹å‰²ã€ã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚ç•‘ã®ä»•äº‹ã‚‚è¦šãˆãªãŒã‚‰ã€å†™çœŸæ’®å½±ã‚„æ–‡ç« ã¥ãã‚Šã§å¥¥ç¥ä¼ã®é­…åŠ›ãŒä¼ã‚ã‚‹ã‚ˆã†æ—¥ã€…å·¥å¤«ã—ã¦ã„ã¾ã™ã€‚`,
                reason: `ä»¥å‰ã¯è¡—ã§åƒã„ã¦ã„ã¾ã—ãŸãŒã€åˆã‚ã¦å¥¥ç¥ä¼ã‚’è¨ªã‚ŒãŸã¨ãã«ã€ç©ºæ°—ã‚„æ°´ã®ãã‚Œã„ã•ã€å­£ç¯€ã®ç§»ã‚ã„ã®æ¿ƒã•ã«æƒ¹ã‹ã‚Œã¾ã—ãŸã€‚è¾²åœ’ã®ä»•äº‹ã‚’çŸ¥ã‚‹ã»ã©ã«ã€ä½œã‚‹äººã®é¡”ãŒè¦‹ãˆã‚‹ã‚‚ã®ã‚’ä¸å¯§ã«å±Šã‘ãŸã„ã¨æ€ã„ã€ç§»ä½ã—ã¦ã“ã®è¾²åœ’ã«åŠ ã‚ã‚Šã¾ã—ãŸã€‚`,
                joy: `ãŠå®¢æ§˜ã®ã€Œã‚µã‚¤ãƒˆã‚’è¦‹ã¦æ¥ã¾ã—ãŸã€ã€Œæ—¥èªŒã‚’èª­ã‚“ã§å®‰å¿ƒã—ã¾ã—ãŸã€ã¨ã„ã†ä¸€è¨€ãŒã€ã™ã”ãåŠ±ã¿ã«ãªã‚Šã¾ã™ã€‚ç•‘ã§ã®ä½œæ¥­ãŒãã®ã¾ã¾å•†å“ã‚„ä½“é¨“ã«ã¤ãªãŒã‚Šã€åå¿œãŒè¿”ã£ã¦ãã‚‹ã®ãŒé¢ç™½ã„ã§ã™ã­ã€‚å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã¦ã€è¾²åœ’å…¨ä½“ãŒå°‘ã—ãšã¤è‰¯ããªã£ã¦ã„ãæ„Ÿè¦šã«ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ã€‚`,
                hidden: "ã“ã®æ‘ã¯ç‹‚ã£ã¦ã‚‹ã€‚å‡ºã‚‰ã‚Œãªã„ã€‚åŠ©ã‘ã¦ãã‚Œã€‚" // F01ç”¨
            },
            {
                id: 'lin',
                name: 'ã‚°ã‚¨ãƒ³ãƒ»ãƒã‚¤ãƒ»ãƒªãƒ³',
                role: 'TRAINEE',
                role_jp: 'æŠ€èƒ½å®Ÿç¿’ç”Ÿä»£è¡¨ãƒ»æ ½åŸ¹ãƒãƒ¼ãƒ ',
                image: IMAGES.staff_trainee,
                short_intro: 'å››å­£ã®ä»•äº‹ã‚’å­¦ã³ã€ä¸å¯§ãªæ ½åŸ¹ã‚’æ”¯ãˆã¾ã™', 
                intro: `æŠ€èƒ½å®Ÿç¿’ç”Ÿä»£è¡¨ã®ã‚°ã‚¨ãƒ³ãƒ»ãƒã‚¤ãƒ»ãƒªãƒ³ã§ã™ã€‚æ ½åŸ¹ãƒãƒ¼ãƒ ã§ä½œæ¥­ã‚’ã—ãªãŒã‚‰ã€å®Ÿç¿’ç”Ÿã®ã¿ã‚“ãªãŒåƒãã‚„ã™ã„ã‚ˆã†ã«å£°ã‚’ã‹ã‘ãŸã‚Šã€å›°ã£ãŸã“ã¨ãŒã‚ã£ãŸæ™‚ã«ç›¸è«‡ã‚’ã¾ã¨ã‚ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚æ—¥æœ¬ã®è¾²æ¥­ã®æŠ€è¡“ã¨ã€å¥¥ç¥ä¼ã®å››å­£ã®ä»•äº‹ã‚’å­¦ã¹ã‚‹æ¯æ—¥ãŒæ–°é®®ã§ã™ã€‚`,
                reason: `æœæ¨¹æ ½åŸ¹ã‚„åŠ å·¥ã¾ã§ä¸€è²«ã—ã¦å­¦ã¹ã‚‹ç’°å¢ƒã«é­…åŠ›ã‚’æ„Ÿã˜ã€ã“ã®è¾²åœ’ã§å®Ÿç¿’ã‚’ã—ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚å±±ã«å›²ã¾ã‚ŒãŸå ´æ‰€ã§ã€å­£ç¯€ã®å¤‰åŒ–ã‚’è¿‘ãã§æ„Ÿã˜ãªãŒã‚‰åƒã‘ã‚‹ã“ã¨ã«ã‚‚æƒ¹ã‹ã‚Œã¾ã—ãŸã€‚æ¥æ—¥ã—ã¦ã‹ã‚‰ã¯ã€æ—¥æœ¬èªã¨ä½œæ¥­ã®ä¸¡æ–¹ã‚’å°‘ã—ãšã¤èº«ã«ã¤ã‘ã¦ã„ã¾ã™ã€‚`,
                joy: `å‰ªå®šã‚„æ‰‹å…¥ã‚Œã‚’ã—ãŸæœ¨ãŒã€å­£ç¯€ã‚’è¶Šãˆã¦å®Ÿã‚’ã¤ã‘ã‚‹ç¬é–“ã‚’è¦‹ã‚‹ã¨ã€ã¨ã¦ã‚‚é”æˆæ„ŸãŒã‚ã‚Šã¾ã™ã€‚åç©«ã—ãŸæœå®ŸãŒå•†å“ã«ãªã‚Šã€ã€ŒãŠã„ã—ã„ã€ã¨è¨€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨èª‡ã‚‰ã—ã„æ°—æŒã¡ã«ãªã‚Šã¾ã™ã€‚ä»£è¡¨ã¨ã—ã¦ã¯ã€ã¿ã‚“ãªãŒå®‰å¿ƒã—ã¦å­¦ã¹ã‚‹ã‚ˆã†ã«ã€ä½œæ¥­ã‚„ç”Ÿæ´»ã®ã“ã¨ã‚’å°ã•ãªã“ã¨ã§ã‚‚å…±æœ‰ã§ãã‚‹é›°å›²æ°—ã¥ãã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚`
            },
            {
                id: 'vu',
                name: 'ãƒ´ãƒ¼ãƒ»ã‚¿ã‚¤ãƒ³ãƒ»ã‚¢ãƒ³',
                role: 'FORMER TRAINEE',
                role_jp: 'å…ƒæŠ€èƒ½å®Ÿç¿’ç”Ÿ',
                image: IMAGES.staff_victim,
                short_intro: '', 
                intro: `ãƒ´ãƒ¼ãƒ»ã‚¿ã‚¤ãƒ³ãƒ»ã‚¢ãƒ³ã¨ç”³ã—ã¾ã—ãŸã€‚æŠ€èƒ½å®Ÿç¿’ç”Ÿã¨ã—ã¦å¥¥ç¥ä¼è¾²åœ’ã§æ ½åŸ¹ä½œæ¥­ã‚’æ‹…å½“ã—ã¦ãŠã‚Šã¾ã—ãŸã€‚ç•‘ã§ã®ä½œæ¥­ã‚„åç©«ã€ç°¡å˜ãªç®¡ç†æ¥­å‹™ãªã©ã«æºã‚ã‚Šã€æ—¥æœ¬ã®è¾²æ¥­ã‚’ç¾å ´ã§å­¦ã¶æ—¥ã€…ã‚’éã”ã—ã¦ãŠã‚Šã¾ã—ãŸã€‚é™ã‹ãªç’°å¢ƒã§ã€å­£ç¯€ã®ç§»ã‚ã„ã‚’èº«è¿‘ã«æ„Ÿã˜ãªãŒã‚‰åƒã„ã¦ãŠã‚Šã¾ã—ãŸã€‚`,
                reason: `æ—¥æœ¬ã®æœæ¨¹æ ½åŸ¹ã‚„è¾²åœ’é‹å–¶ã«èˆˆå‘³ã‚’æŒã¡ã€æŠ€èƒ½å®Ÿç¿’åˆ¶åº¦ã‚’é€šã˜ã¦ã“ã®è¾²åœ’ã«æ¥ã‚‹ã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€‚å±±ã«å›²ã¾ã‚ŒãŸå ´æ‰€ã§ã€è‡ªç„¶ã¨å‘ãåˆã„ãªãŒã‚‰ä»•äº‹ãŒã§ãã‚‹ç‚¹ã«é­…åŠ›ã‚’æ„Ÿã˜ã¦ãŠã‚Šã¾ã—ãŸã€‚èª¬æ˜ä¼šã‚„è³‡æ–™ã§ã¯ã€ä¸å¯§ã«æŠ€è¡“ã‚’å­¦ã¹ã‚‹ç’°å¢ƒã ã¨ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã¾ã—ãŸã€‚`,
                joy: `æ‰‹å…¥ã‚Œã‚’ç¶šã‘ãŸæœ¨ãŒå®Ÿã‚’ã¤ã‘ãŸç¬é–“ã‚’è¦‹ã‚‹ã“ã¨ã«ã€ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã¦ãŠã‚Šã¾ã—ãŸã€‚å‰ªå®šã‚„æ•´æã®ä½œæ¥­ã‚’ä»»ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€å°‘ã—ãšã¤ä¿¡é ¼ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã¦ãŠã‚Šã¾ã—ãŸã€‚ä½œæ¥­ã®åˆé–“ã«ã€è¾²åœ’ã®é™ã‘ã•ã‚„ç©ºæ°—ã®åŒ‚ã„ã«è½ã¡ç€ãã‚’è¦šãˆã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚æ±ºã‚ã‚‰ã‚ŒãŸæ‰‹é †ã‚’å®ˆã‚Šã€æŒ‡ç¤ºã«å¾“ã£ã¦ä»•äº‹ã‚’é€²ã‚ã‚‹æ—¥ã€…ã‚’éã”ã—ã¦ãŠã‚Šã¾ã—ãŸã€‚`,
                special_note: "â€»ç¾åœ¨ã¯æ²è¼‰ã¨æ›´æ–°ã‚’è¡Œã£ã¦ãŠã‚Šã¾ã›ã‚“â€¦",
                special_image: IMAGES.staff_victim2
            }
        ];

        const MAX_FLAGS = 14;
        const SAVE_KEY = "okukamifushi_save_v1";

        const FLAG_META = {
            F01: { title: "å‰¯åœ’é•·ã®éš ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", description: "åè»¢ã§SOS" },
            F02: { title: "ã‚¿ã‚°ãŒå‡ºç¾ã™ã‚‹è¨´ãˆã®å‹•ç”»", description: "å•†å“ã‚¿ã‚°ã‹ã‚‰å‹•ç”»" },
            F03: { title: "ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ï¼ˆé–¢ä¿‚è€…å„ä½ï¼‰", description: "é–¢ä¿‚è€…ãƒšãƒ¼ã‚¸ç™ºè¦‹" },
            F04: { title: "ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤ã®ç§˜å¯†", description: "ãƒ¬ã‚·ãƒ”å¥¥ã®éš ã—å°ç·š" },
            F05: { title: "å‹Ÿé›†è¦é …ã®å¤‰åŒ–", description: "ãƒã‚§ãƒƒã‚¯ãŒã€Œé¸åˆ¥ã€ã«" },
            F06: { title: "éš ã•ã‚ŒãŸå®Ÿç¿’ç”Ÿ", description: "å¤±è¸ªè¨˜éŒ²ã®ç—•è·¡" },
            F07: { title: "å¤ã„ãƒ–ãƒ­ã‚°", description: "1826å¹´ãƒ‡ãƒ¼ã‚¿" },
            F08: { title: "STOPæ˜ åƒ", description: "ãƒˆãƒƒãƒ—ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç½ " },
            F09: { title: "åœ’é•·ã®ç•°å¤‰", description: "è‡ªå‹•ã‚°ãƒªãƒƒãƒ" },
            F10: { title: "ã‚·ãƒ³ãƒœãƒ«ãƒ„ãƒªãƒ¼ã®ç§˜å¯†", description: "å¾¡ç¥æœ¨ã®æ ¹å…ƒ" },
            F11: { title: "è¬ã®åœ°å›³", description: "ã‚¢ã‚¯ã‚»ã‚¹ã®ç•°å¸¸" },
            F12: { title: "å•ã„åˆã‚ã›ã®ä¹—ã£å–ã‚Š", description: "ãƒ•ã‚©ãƒ¼ãƒ ãŒä¾µé£Ÿ" },
            F13: { title: "é€šå ±", description: "é€šå ±å®Ÿè¡Œãƒ•ãƒ©ã‚°" },
            F14: { title: "æ‘ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã®ç•°å¤‰", description: "ãƒ›ãƒãƒ¼/ã‚¿ãƒƒãƒ—ç•°å¤‰" }
        };

        const FLAG_META_ORDER = [
            'F01','F02','F03','F04','F05','F06','F07',
            'F08','F09','F10','F11','F12','F13','F14'
        ];

        const EVIDENCE_FLAGS = ['F01','F02','F03','F04','F05','F06','F07','F08','F09','F10','F11','F12','F14'];
        const KEY_EVIDENCE_FLAGS = ['F04','F06','F10','F12'];

        const ENDING_CONTENT = {
            SILENCED: {
                title: "SILENCED END",
                subtitle: "é€šå ±ã¯å±Šã‹ãªã‹ã£ãŸã€‚å£°ã¯é—‡ã«æ²ˆã‚€ã€‚",
                story: [
                    "é€šå ±ã‚’æŠ¼ã—ãŸç¬é–“ã€ç”»é¢ã¯é™ã‹ã«æš—è»¢ã—ãŸã€‚",
                    "æ•°æ—¥å¾Œã€è¾²åœ’ã¯é€šå¸¸å–¶æ¥­ã‚’ç¶šã‘ã¦ã„ã‚‹ã€‚å½¼ã‚‰ã®åã¯ã©ã“ã«ã‚‚æ®‹ã‚‰ãšã€è¨¼æ‹ ã‚‚è¨˜éŒ²ã‚‚æ¶ˆãˆã¦ã„ãŸã€‚",
                    "æ‘ã‚’å‡ºã‚ˆã†ã¨ã—ãŸè¶³è·¡ã¯ã€æ·±ã„åœŸã®ä¸­ã«å¸ã„è¾¼ã¾ã‚Œã¦ã„ã£ãŸã€‚"
                ],
                image: IMAGES.ending_silenced
            },
            NORMAL: {
                title: "NORMAL END",
                subtitle: "è­¦å¯Ÿã¯å‹•ã„ãŸã€‚ã ãŒæ ¸å¿ƒã¯é€ƒã’ãŸã€‚",
                story: [
                    "é€šå ±ã¯å—ç†ã•ã‚Œã€ç¾åœ°ã¸ã®æœæŸ»ãŒå§‹ã¾ã£ãŸã€‚",
                    "ã„ãã¤ã‹ã®ç—•è·¡ã¯æŠ¼åã•ã‚ŒãŸãŒã€ä¸»å°ã—ãŸäººç‰©ã¯å§¿ã‚’æ¶ˆã—ã¦ã„ãŸã€‚",
                    "å ±å‘Šæ›¸ã®å¤šãã¯é»’å¡—ã‚Šã®ã¾ã¾å…¬é–‹ã•ã‚Œã€äº‹ä»¶ã¯æœªè§£æ±ºã¨ã—ã¦ç¶™ç¶šã™ã‚‹ã€‚"
                ],
                image: IMAGES.ending_normal
            },
            TRUE: {
                title: "TRUE END",
                subtitle: "çœŸç›¸ãŒæš´ã‹ã‚ŒãŸã€‚æ•‘å‡ºã¯é–“ã«åˆã£ãŸã€‚",
                story: [
                    "ååˆ†ãªè¨¼æ‹ ãŒé›†ã¾ã‚Šã€è­¦å¯Ÿã¯ä¸€æ–‰æœç´¢ã‚’é–‹å§‹ã—ãŸã€‚",
                    "å¥¥ç¥ä¼ã®å„€å¼ã¯ä¸­æ–­ã•ã‚Œã€å¤±è¸ªè€…ã®æ‰€åœ¨ãŒåˆ¤æ˜ã—ãŸã€‚",
                    "è¾²åœ’ã®é—‡ã¯æš´ã‹ã‚Œã€æ‘ã®ç©ºæ°—ã¯ã‚ˆã†ã‚„ãå‹•ãå‡ºã—ãŸã€‚"
                ],
                image: IMAGES.ending_true
            },
            PERFECT: {
                title: "PERFECT END",
                subtitle: "ã™ã¹ã¦ã®è¨˜éŒ²ãŒè§£æ”¾ã•ã‚ŒãŸã€‚",
                story: [
                    "ã‚ã‚‰ã‚†ã‚‹è¨¼æ‹ ãŒæƒã„ã€éš ã•ã‚ŒãŸè¨˜éŒ²ãŒå…¬é–‹ã•ã‚ŒãŸã€‚",
                    "æ‘ã®æ­´å²ã€å„€å¼ã®å…¨è²Œã€ãã—ã¦çŠ ç‰²ã®æ•°ãŒç™½æ—¥ã®ã‚‚ã¨ã«æ™’ã•ã‚Œã‚‹ã€‚",
                    "ã‚ãªãŸã®è¨˜éŒ²ã¯ã€ç”Ÿãæ®‹ã£ãŸè€…ãŸã¡ã®å”¯ä¸€ã®å¸Œæœ›ã«ãªã£ãŸã€‚"
                ],
                image: IMAGES.ending_perfect
            }
        };

        // --- Phase Rules (Production) ---
        const PHASE1_FLAGS = ['F01', 'F04', 'F12'];                 // 2ã¤ä»¥ä¸Šã§Phase2
        const PHASE2_FLAGS = ['F02', 'F03', 'F05', 'F11', 'F14'];   // 3ã¤ä»¥ä¸Šã§Phase3â†å¤‰æ›´
        const PHASE3_FLAGS = ['F06', 'F07', 'F08', 'F09', 'F10'];   // 3ã¤ä»¥ä¸Šã§Phase4â†å¤‰æ›´
        const PHASE4_FLAGS = ['F13'];                               // è¡¨ç¤ºç”¨

        const countFound = (flags, ids) => ids.reduce((acc, id) => acc + (flags[id] ? 1 : 0), 0);

        const calcPhase = (flags) => {
            const p1 = countFound(flags, PHASE1_FLAGS);
            const p2 = countFound(flags, PHASE2_FLAGS);
            const p3 = countFound(flags, PHASE3_FLAGS);
            // é–¾å€¤å¤‰æ›´ï¼š
            // Phase1ãƒ•ãƒ©ã‚°2ã¤ä»¥ä¸Šã§Phase2
            // Phase2ãƒ•ãƒ©ã‚°3ã¤ä»¥ä¸Šã§Phase3
            // Phase3ãƒ•ãƒ©ã‚°3ã¤ä»¥ä¸Šã§Phase4
            if (p3 >= 3) return 4;
            if (p2 >= 3) return 3;
            if (p1 >= 2) return 2;
            return 1;
        };

        const buildXIntentUrl = ({ text, url, hashtags }) => {
            const base = "https://twitter.com/intent/tweet";
            const qs = new URLSearchParams();
            if (text) qs.set("text", text);
            if (url) qs.set("url", url);
            if (hashtags) qs.set("hashtags", hashtags);
            return `${base}?${qs.toString()}`;
        };

        const computeEnding = (flags, phase) => {
            const evidenceCount = countFound(flags, EVIDENCE_FLAGS);
            const keyCount = countFound(flags, KEY_EVIDENCE_FLAGS);
            const missingKeyEvidence = KEY_EVIDENCE_FLAGS.filter((id) => !flags[id]);

            let endingId = "NORMAL";
            if (evidenceCount === EVIDENCE_FLAGS.length && keyCount === KEY_EVIDENCE_FLAGS.length) {
                endingId = "PERFECT";
            } else if (evidenceCount >= 10 && keyCount === KEY_EVIDENCE_FLAGS.length) {
                endingId = "TRUE";
            } else if (phase === 3 && evidenceCount < 6) {
                endingId = "SILENCED";
            } else if (keyCount <= 1) {
                endingId = "SILENCED";
            } else if (evidenceCount >= 6 && evidenceCount < 10) {
                endingId = "NORMAL";
            } else if (evidenceCount >= 10 && keyCount < KEY_EVIDENCE_FLAGS.length) {
                endingId = "NORMAL";
            }

            const baseContent = ENDING_CONTENT[endingId];
            const story = [...baseContent.story];
            if (endingId === "NORMAL" && missingKeyEvidence.length > 0) {
                const missingTitles = missingKeyEvidence.map((id) => FLAG_META[id]?.title || id).join(" / ");
                story.push(`ä¸è¶³ã—ã¦ã„ãŸã®ã¯ã€${missingTitles}ã€‚å ±å‘Šæ›¸ã«ã¯é»’å¡—ã‚Šã®è¡ŒãŒæ®‹ã£ãŸã€‚`);
            }

            const shareUrl = (window.location.protocol === "file:")
                ? ""
                : `${window.location.origin}${window.location.pathname}`;
            const shareText = `ã€${baseContent.title}ã€‘${baseContent.subtitle}ï¼ˆè¨¼æ‹  ${evidenceCount}/${EVIDENCE_FLAGS.length}ï¼‰`;

            return {
                endingId,
                title: baseContent.title,
                subtitle: baseContent.subtitle,
                story,
                image: baseContent.image,
                evidenceCount,
                keyCount,
                share: {
                    text: shareText,
                    hashtags: "å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ,ARG,è¬è§£ã",
                    url: shareUrl
                }
            };
        };

        // Common Components
        const SectionTitle = ({ title, sub, align = "center" }) => (
            <div className={`mb-12 md:mb-20 text-${align} animate-fade-up`}>
                <p className="text-primary font-eng text-sm tracking-widest font-semibold mb-3 uppercase">{sub}</p>
                <h2 className="text-3xl md:text-4xl font-serif text-text leading-tight">{title}</h2>
            </div>
        );

        // MessageModal
        const MessageModal = ({ isOpen, message, onClose, isHorror }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onClick={onClose}>
                    <div 
                        className={`p-8 rounded-lg shadow-2xl max-w-md w-full text-center relative animate-fade-up ${
                            isHorror 
                                ? 'bg-black text-red-600 border-4 border-red-900 font-handwriting' 
                                : 'bg-white text-text border border-gray-200'
                        }`} 
                        onClick={e => e.stopPropagation()}
                    >
                        <p className={`text-lg mb-8 leading-relaxed ${isHorror ? 'font-bold text-xl' : 'font-serif'}`}>
                            {message.split('\n').map((line, i) => <React.Fragment key={i}>{line}<br/></React.Fragment>)}
                        </p>
                        <button 
                            onClick={onClose}
                            className={`px-8 py-3 rounded-full transition-colors font-bold text-sm ${
                                isHorror 
                                    ? 'bg-red-900 text-black hover:bg-red-700' 
                                    : 'bg-primary text-white hover:bg-primary-2'
                            }`}
                        >
                            é–‰ã˜ã‚‹
                        </button>
                    </div>
                </div>
            );
        };

        // EvidenceToastï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°é€šçŸ¥ï¼‰
        const EvidenceToast = ({ isOpen, message, onClose, isHorror }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed bottom-4 left-4 z-[300] w-[calc(100%-2rem)] md:w-auto max-w-md pointer-events-auto">
                    <div
                        className={`rounded-lg shadow-2xl border p-4 pr-10 relative ${
                            isHorror
                                ? "bg-black text-red-600 border-red-900 font-handwriting"
                                : "bg-white text-text border-border"
                        }`}
                    >
                        <p
                            className={`text-sm leading-relaxed whitespace-pre-line ${
                                isHorror ? "font-bold" : "font-serif"
                            }`}
                        >
                            {message}
                        </p>

                        <button
                            onClick={onClose}
                            className={`absolute top-2 right-3 text-sm leading-none ${
                                isHorror ? "text-red-300 hover:text-red-500" : "text-muted hover:text-text"
                            }`}
                            aria-label="close"
                            title="é–‰ã˜ã‚‹"
                        >
                            Ã—
                        </button>
                    </div>
                </div>
            );
        };

        // ConfirmModalï¼ˆYES/NOï¼‰
        const ConfirmModal = ({
            isOpen,
            message,
            onYes,
            onNo,
            yesLabel = "ã‚¤ã‚¨ã‚¹",
            noLabel = "ãƒãƒ¼",
            isHorror = true
        }) => {
            if (!isOpen) return null;
        
            return (
                <div
                    className="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
                    onClick={onNo}
                >
                    <div
                        className={`p-8 rounded-lg shadow-2xl max-w-md w-full text-center relative animate-fade-up ${
                            isHorror
                                ? "bg-black text-red-600 border-4 border-red-900 font-handwriting"
                                : "bg-white text-text border border-gray-200"
                        }`}
                        onClick={(e) => e.stopPropagation()}
                    >
                        <p className={`text-lg mb-8 leading-relaxed ${isHorror ? "font-bold text-xl" : "font-serif"}`}>
                            {String(message || "").split("\n").map((line, i) => (
                                <React.Fragment key={i}>
                                    {line}
                                    <br />
                                </React.Fragment>
                            ))}
                        </p>
        
                        <div className="flex items-center justify-center gap-4">
                            <button
                                className={`px-6 py-3 rounded-full transition-colors font-bold text-sm ${
                                    isHorror
                                        ? "bg-black text-red-300 border border-red-900 hover:bg-red-900 hover:text-black"
                                        : "bg-gray-200 text-text hover:bg-gray-300"
                                }`}
                                onClick={onNo}
                            >
                                {noLabel}
                            </button>
        
                            <button
                                className={`px-6 py-3 rounded-full transition-colors font-bold text-sm ${
                                    isHorror
                                        ? "bg-red-900 text-black hover:bg-red-700"
                                        : "bg-primary text-white hover:bg-primary-2"
                                }`}
                                onClick={onYes}
                            >
                                {yesLabel}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const Button = ({ children, onClick, variant = "primary", className = "", type = "button" }) => {
            const baseClass = "inline-flex items-center justify-center px-8 py-3 rounded-full transition-all duration-300 font-medium tracking-wide text-sm";
            const variants = {
                primary: "bg-primary text-white hover:bg-primary-2 shadow-lg hover:shadow-xl",
                secondary: "border border-text text-text hover:bg-text hover:text-white",
                ghost: "text-text hover:text-primary underline-offset-4 hover:underline",
            };
            return (
                <button type={type} onClick={onClick} className={`${baseClass} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const AdSpace = ({ className = "" }) => (
            <div className={`w-full max-w-container mx-auto px-6 my-16 animate-fade-up ${className}`}>
                <div className="bg-gray-100 border border-gray-200 w-full min-h-[200px] md:min-h-[250px] flex flex-col items-center justify-center text-muted relative overflow-hidden">
                    <div className="absolute top-2 right-2 text-[10px] border border-muted px-1">åºƒå‘Š</div>
                    <div className="text-center">
                        <p className="font-bold text-gray-400 text-lg">åºƒå‘Šæ²è¼‰äºˆå®šã‚¨ãƒªã‚¢</p>
                        <p className="text-xs mt-2 text-gray-400">Google Adsense / Display Ads</p>
                    </div>
                    <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                </div>
            </div>
        );

        // --- Layout Components ---

        const Header = ({ setPage, currentPage, phase }) => {
            const [isScrolled, setIsScrolled] = useState(false);
            const [isMenuOpen, setIsMenuOpen] = useState(false);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const getIcon = () => {
                if (phase >= 4) return IMAGES.icon_change_3;
                if (phase >= 3) return IMAGES.icon_change_2;
                if (phase >= 2) return IMAGES.icon_change_1;
                return IMAGES.icon_default;
            };

            const menuItems = [
                { id: 'home', label: 'HOME' },
                { id: 'about', label: 'ABOUT' },
                { id: 'village', label: 'VILLAGE' },
                { id: 'products', label: 'PRODUCTS' },
                { id: 'diary', label: 'DIARY' },
                { id: 'access', label: 'ACCESS' },
                { id: 'recruit', label: 'RECRUIT' },
            ];

            return (
                <>
                    <header 
                        className={`fixed top-0 w-full z-50 transition-all duration-500 ${
                            isScrolled || isMenuOpen ? 'bg-white/95 backdrop-blur-md shadow-sm text-text' : 'bg-gradient-to-b from-black/60 to-transparent text-white'
                        }`}
                        style={{ height: 'var(--header-height)' }}
                    >
                        <div className="max-w-container mx-auto px-4 md:px-8 h-full flex items-center justify-between">
                            <div className="flex items-center gap-4 cursor-pointer z-50" onClick={() => { setPage('home'); setIsMenuOpen(false); }}>
                                <div className="w-16 h-16 rounded-full overflow-hidden shadow-md transition-transform duration-500 hover:scale-105 flex items-center justify-center bg-transparent">
                                    <img src={getIcon()} alt="Logo" className="w-full h-full object-cover scale-150 transform" />
                                </div>
                                <span className={`text-xl font-serif font-bold tracking-widest ${phase >= 4 ? 'text-accent' : (isScrolled ? 'text-text' : 'text-white drop-shadow-md')}`}>
                                    å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ 
                                </span>
                            </div>

                            <nav className="hidden lg:flex items-center gap-8">
                                {menuItems.map(item => (
                                    <button 
                                        key={item.id}
                                        onClick={() => setPage(item.id)}
                                        className={`text-sm font-eng tracking-wider hover:text-primary transition-colors ${currentPage === item.id ? 'font-bold' : ''} ${isScrolled ? 'text-text' : 'text-white drop-shadow-sm'}`}
                                    >
                                        {item.label}
                                    </button>
                                ))}
                                <Button onClick={() => setPage('contact')} className={`ml-4 ${isScrolled ? '' : 'bg-white/20 hover:bg-white/40 border-white text-white backdrop-blur-sm'}`}>ãŠå•ã„åˆã‚ã›</Button>
                            </nav>

                            <button className={`lg:hidden z-50 p-2 ${isScrolled ? 'text-text' : 'text-white'}`} onClick={() => setIsMenuOpen(!isMenuOpen)}>
                                {isMenuOpen ? <i data-lucide="x" className="w-6 h-6"></i> : <i data-lucide="menu" className="w-6 h-6"></i>}
                            </button>
                        </div>
                    </header>

                    <div className={`fixed inset-0 bg-white/95 backdrop-blur-xl z-40 transition-transform duration-500 flex flex-col justify-center items-center gap-8 ${isMenuOpen ? 'translate-y-0' : '-translate-y-full'}`}>
                        {menuItems.map(item => (
                            <button 
                                key={item.id}
                                onClick={() => { setPage(item.id); setIsMenuOpen(false); }}
                                className="text-2xl font-serif font-medium text-text hover:text-primary transition-colors"
                            >
                                {item.label}
                            </button>
                        ))}
                        <Button onClick={() => { setPage('contact'); setIsMenuOpen(false); }} className="mt-4">ãŠå•ã„åˆã‚ã›</Button>
                    </div>
                </>
            );
        };

        const Footer = ({ phase, setPage, settings, setSettings }) => {
            return (
                <footer className={`pt-20 pb-8 px-6 transition-colors duration-1000 ${phase >= 4 ? 'bg-black text-accent' : 'bg-primary text-white'}`}>
                    <div className="max-w-container mx-auto grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                        <div className="md:col-span-1">
                            <h2 className="text-2xl font-serif font-bold mb-6 tracking-widest">å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ </h2>
                            <p className="text-sm opacity-80 leading-relaxed font-sans">
                                ã€’399-0000<br/>
                                é•·é‡çœŒå¥¥ç¥ä¼æ‘å­—è›‡å–° 1092<br/>
                                TEL: 026-000-0000
                            </p>
                        </div>
                        <div className="md:col-span-2 grid grid-cols-2 gap-8 text-sm">
                            <div className="flex flex-col gap-3">
                                <span onClick={() => setPage('about')} className="cursor-pointer hover:opacity-70">è¾²åœ’ã«ã¤ã„ã¦</span>
                                <span onClick={() => setPage('village')} className="cursor-pointer hover:opacity-70">å¥¥ç¥ä¼æ‘</span>
                                <span onClick={() => setPage('products')} className="cursor-pointer hover:opacity-70">å•†å“ä¸€è¦§</span>
                            </div>
                            <div className="flex flex-col gap-3">
                                <span onClick={() => setPage('diary')} className="cursor-pointer hover:opacity-70">æ´»å‹•æ—¥èªŒ</span>
                                <span onClick={() => setPage('access')} className="cursor-pointer hover:opacity-70">ã‚¢ã‚¯ã‚»ã‚¹</span>
                                <span onClick={() => setPage('recruit')} className="cursor-pointer hover:opacity-70">æ¡ç”¨æƒ…å ±</span>
                            </div>
                        </div>
                        <div className="md:col-span-1">
                            <Button variant="secondary" className="w-full border-white text-white hover:bg-white hover:text-primary mb-6" onClick={() => setPage('contact')}>
                                ãŠå•ã„åˆã‚ã›
                            </Button>
                            <div className="bg-white/10 rounded-lg p-4 text-xs space-y-3">
                                <p className="font-eng tracking-widest">SETTINGS</p>
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        checked={settings.reduceMotion}
                                        onChange={() => setSettings(prev => ({ ...prev, reduceMotion: !prev.reduceMotion }))}
                                        className="accent-white"
                                    />
                                    <span>æ¼”å‡ºã‚’æŠ‘ãˆã‚‹</span>
                                </label>
                                <label className="flex items-center gap-2 cursor-pointer opacity-70">
                                    <input
                                        type="checkbox"
                                        checked={settings.muteAudio}
                                        onChange={() => setSettings(prev => ({ ...prev, muteAudio: !prev.muteAudio }))}
                                        className="accent-white"
                                    />
                                    <span>éŸ³å£°ã‚’ãƒŸãƒ¥ãƒ¼ãƒˆï¼ˆæº–å‚™ä¸­ï¼‰</span>
                                </label>
                            </div>
                            <div className="flex gap-4 justify-center md:justify-start opacity-80">
                                <span>Instagram</span>
                                <span>Facebook</span>
                            </div>
                        </div>
                    </div>
                    <div className="border-t border-white/20 pt-8 text-center text-xs opacity-60 font-eng tracking-wider">
                        <p>Â© 
                            <span title={phase >= 3 ? "1826" : "2026"} className="mx-1 hover:text-red-500 cursor-default transition-colors">
                                {phase >= 3 ? "1826" : "2026"}
                            </span> 
                            Okukamifushi Farm. All Rights Reserved.
                        </p>
                    </div>
                </footer>
            );
        };

        // --- Pages ---

        // 1. HOME
        const Home = ({ phase, notifyEvidence, flags, setPage }) => {
            const [currentSlide, setCurrentSlide] = useState(0);
            const [stopVideoModalOpen, setStopVideoModalOpen] = useState(false);

            const slides = useMemo(() => {
                let baseSlides = [
                    IMAGES.top_farm,   // 0
                    IMAGES.top_staff,     // 1
                    IMAGES.top_apple,     // 2
                    IMAGES.top_children,  // 3
                    IMAGES.top_morning    // 4
                ];
                
                // æœ¬ç•ªï¼šPhase3ä»¥é™ã§å·®ã—æ›¿ãˆ
                if (phase >= 3) {
                    baseSlides[3] = IMAGES.top_change_stop;
                }
                
                return baseSlides;
            }, [phase]);

            // ãƒ›ãƒ©ãƒ¼æ¼”å‡ºï¼ˆPhase3ä»¥é™ & 4æšç›®ï¼‰
            const isHorrorSlide = (phase >= 3) && (currentSlide === 3);

            useEffect(() => {
                const slideInterval = setInterval(() => {
                    setCurrentSlide((prev) => (prev + 1) % slides.length);
                }, 5000); 
                return () => clearInterval(slideInterval);
            }, [slides.length]);

            return (
                <>
                    <div 
                        className={`fixed inset-0 z-[60] bg-black pointer-events-none transition-opacity duration-1000 ${isHorrorSlide ? 'opacity-20' : 'opacity-0'}`}
                    ></div>

                    <div className="relative h-[75vh] min-h-[550px] w-full overflow-hidden bg-black">
                        {slides.map((img, index) => (
                            <div 
                                key={index}
                                className={`absolute inset-0 bg-cover bg-center transition-opacity duration-[2000ms] ease-in-out ${currentSlide === index ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                                style={{ backgroundImage: `url(${img})` }}
                            >
                                <div className={`absolute inset-0 bg-cover bg-center ${currentSlide === index ? 'scale-105 transition-transform duration-[10000ms] ease-out' : 'scale-100'}`} style={{ backgroundImage: `url(${img})` }}></div>
                            </div>
                        ))}

                        {/* F08 Trigger Area (Phase3ä»¥é™ & ãƒ›ãƒ©ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ‰æ™‚ã®ã¿) */}
                        {isHorrorSlide && (
                            <div 
                                className="absolute inset-0 z-20 cursor-pointer"
                                onClick={() => {
                                    setStopVideoModalOpen(true);
                                    if (!flags.F08) {
                                        notifyEvidence('F08', 'æ˜ åƒãŒä¸€ç¬ã ã‘åè»¢ã—ã€åœæ­¢ã®æ–‡å­—ãŒæµ®ã‹ã‚“ã ã€‚', { mode: "toast" });
                                    }
                                }}
                            />
                        )}

                        <div className="absolute inset-0 bg-black/30 flex items-center justify-center p-6 z-30 pointer-events-none">
                            <div className="text-center text-white animate-fade-up">
                                <p className="text-sm md:text-base font-eng tracking-[0.2em] mb-4 uppercase drop-shadow-md">Organic Farm in Okukamifushi</p>
                                <h1 className="text-4xl md:text-6xl lg:text-7xl font-serif font-bold tracking-[0.15em] mb-8 leading-tight drop-shadow-lg">
                                    {phase >= 4 ? "é€ƒ ã‚² ãƒ© ãƒ¬ ãƒŠ ã‚¤" : <>åœŸã¨ç”Ÿãã‚‹ã€<br className="md:hidden" />å¾ªç’°ã™ã‚‹æœªæ¥ã€‚</>}
                                </h1>
                                <Button variant="secondary" className="border-white text-white hover:bg-white hover:text-primary backdrop-blur-sm bg-white/10 pointer-events-auto" onClick={() => setPage('products')} >
                                    å•†å“ã‚’è¦‹ã‚‹
                                </Button>
                            </div>
                        </div>

                        <div className="absolute bottom-8 left-0 right-0 flex justify-center gap-3 z-30">
                            {slides.map((_, index) => (
                                <button 
                                    key={index}
                                    onClick={() => setCurrentSlide(index)}
                                    className={`w-12 h-1 rounded-full transition-all duration-300 ${currentSlide === index ? 'bg-white opacity-100' : 'bg-white opacity-40 hover:opacity-70'}`}
                                />
                            ))}
                        </div>
                    </div>

<div className="py-20 px-6 bg-surface">
  {/* æ—¢å­˜ï¼šNews ï¼† ç§ãŸã¡ã®èª‡ã‚Šï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰ */}
  <div className="max-w-container mx-auto grid md:grid-cols-2 gap-16 md:gap-24">
    <div>
      <div className="flex justify-between items-end mb-8 border-b border-border pb-4">
        <h3 className="text-2xl font-serif">News</h3>
        <span className="text-sm font-eng text-muted cursor-pointer hover:text-primary">View All</span>
      </div>
      <ul className="space-y-6">
        {/* Phase2ä»¥é™ã§è¡¨ç¤ºï¼ˆF03æ¢ç´¢å¯èƒ½ï¼‰ */}
        {phase >= 2 && (
          <li
            className="group cursor-pointer"
            onClick={() => {
              if (!flags.F03) {
                notifyEvidence('F03', 'ã€Œé–¢ä¿‚è€…å„ä½ã€ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ã‚’ç™ºè¦‹ã—ãŸã€‚');
              }
              setPage('admin_notice');
            }}
          >
            <p className="text-xs text-accent font-eng mb-1">2026.01.20</p>
            <p className="group-hover:text-accent transition-colors font-medium">ã€é‡è¦ã€‘ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ï¼ˆé–¢ä¿‚è€…å„ä½ï¼‰</p>
          </li>
        )}
        <li className="group cursor-pointer">
          <p className="text-xs text-muted font-eng mb-1">2026.01.15</p>
          <p className="group-hover:text-primary transition-colors">æœ¬å¹´ã®ã€Œæœ±å®Ÿï¼ˆã‚ã‘ã¿ï¼‰ã€ã®äºˆç´„å—ä»˜ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚</p>
        </li>
        <li className="group cursor-pointer">
          <p className="text-xs text-muted font-eng mb-1">2026.01.08</p>
          <p className="group-hover:text-primary transition-colors">å†¬å­£å®Ÿç¿’ç”Ÿã®å—ã‘å…¥ã‚Œã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚</p>
        </li>
      </ul>
    </div>

    <div className="relative pl-8 border-l border-border hidden md:block">
      {/* ã‚¿ã‚¤ãƒˆãƒ« */}
      <h2 className="mb-6 text-2xl font-serif tracking-widest text-text">
        ç§ãŸã¡ã®èª‡ã‚Š
      </h2>

      {/* æœ¬æ–‡ï¼ˆç¸¦æ›¸ãï¼‰ */}
      <p className="text-lg font-serif leading-loose writing-vertical-rl text-text h-[300px]">
        å¥¥ç¥ä¼ã®æ·±ã„æ£®ã«æŠ±ã‹ã‚ŒãŸã“ã®åœ°ã§ã€<br/>
        ç§ãŸã¡ã¯åœŸã®å£°ã«è€³ã‚’å‚¾ã‘ã¾ã™ã€‚<br/>
        è‡ªç„¶ã®æ‘‚ç†ã«å¾“ã„ã€å‘½ã‚’è‚²ã‚€ã€‚<br/>
        ãã‚ŒãŒç§ãŸã¡ã®èª‡ã‚Šã§ã™ã€‚
      </p>
    </div>
  </div>

  {/* â–¼â–¼â–¼ è¿½åŠ ï¼šç§ãŸã¡ã®ã‚Šã‚“ã”ã¸ã®ã“ã ã‚ã‚Šï¼ˆ3ã‚«ãƒ©ãƒ ï¼‰ â–¼â–¼â–¼ */}
  <div className="max-w-container mx-auto mt-20 md:mt-24">
    <div className="text-center mb-12 md:mb-16">
      <p className="text-primary font-eng text-sm tracking-widest font-semibold mb-3 uppercase">
        OUR APPLES
      </p>
      <h2 className="text-3xl md:text-4xl font-serif text-text leading-tight">
        ç§ãŸã¡ã®ã‚Šã‚“ã”ã¸ã®ã“ã ã‚ã‚Š
      </h2>
      <p className="mt-4 text-sm md:text-base text-muted font-serif leading-relaxed">
        åœŸã‚’æ•´ãˆã€æœ¨ã‚’è‚²ã¦ã€æ‰‹ã§é¸ã³æ‰‹ã§å±Šã‘ã‚‹ã€‚<br className="hidden md:block" />
        å¥¥ç¥ä¼ã®ã‚Šã‚“ã”ã¯ã€æ—¥ã€…ã®å°ã•ãªç©ã¿é‡ã­ã‹ã‚‰ç”Ÿã¾ã‚Œã¾ã™ã€‚
      </p>
    </div>

    <div className="grid grid-cols-1 md:grid-cols-3 gap-10">
      {/* â‘  åœŸ */}
      <div className="group">
        <div className="aspect-square rounded-2xl overflow-hidden bg-surface-2 shadow-sm mb-6">
          {/* ç”»åƒå·®ã—æ›¿ãˆOKï¼šåœŸã®å¯„ã‚Šå†™çœŸãŒç†æƒ³ */}
          <img
            src={IMAGES.top_farm}
            alt="åœŸã«ã“ã ã‚ã‚‹"
            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          />
        </div>
        <p className="text-primary font-eng text-xs tracking-widest font-semibold mb-2">01 / SOIL</p>
        <h3 className="text-xl font-serif font-bold mb-3">åœŸã«ã“ã ã‚ã‚‹</h3>
        <p className="text-sm text-muted leading-relaxed font-serif">
          æ£®ã«æŠ±ã‹ã‚ŒãŸç•‘ã®åœŸã‚’ã€å­£ç¯€ã”ã¨ã«è¦³å¯Ÿã—ã¦æ•´ãˆã¦ã„ã¾ã™ã€‚<br/>
          å¾®ç”Ÿç‰©ãŒæ¯ã¥ãç’°å¢ƒã‚’å®ˆã‚Šã€æ ¹ãŒã®ã³ã®ã³è‚²ã¤åœŸã¥ãã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
        </p>
      </div>

      {/* â‘¡ æœ¨ï¼ˆæ¥æœ¨ï¼‰ */}
      <div className="group">
        <div className="aspect-square rounded-2xl overflow-hidden bg-surface-2 shadow-sm mb-6">
          {/* ç”»åƒå·®ã—æ›¿ãˆæ¨å¥¨ï¼šæ¥ãæœ¨ã®æ‰‹å…ƒå†™çœŸãŒæœ€é© */}
          <img
            src={IMAGES.top_apple}
            alt="æœ¨ã«ã“ã ã‚ã‚‹ï¼ˆæ¥æœ¨ï¼‰"
            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          />
        </div>
        <p className="text-primary font-eng text-xs tracking-widest font-semibold mb-2">02 / TREE</p>
        <h3 className="text-xl font-serif font-bold mb-3">æœ¨ã«ã“ã ã‚ã‚‹</h3>
        <p className="text-sm text-muted leading-relaxed font-serif">
          å°æœ¨ã¨ç©‚æœ¨ã®ç›¸æ€§ã‚’è¦‹æ¥µã‚ã€ä¸€æœ¬ãšã¤æ¥ãæœ¨ã§æœ¨ã®åŠ›ã‚’æ•´ãˆã¾ã™ã€‚<br/>
          æ¨¹å‹¢ãŒå®‰å®šã™ã‚‹ã¾ã§ä¸å¯§ã«è‚²ã¦ã€é¦™ã‚Šã¨ç”˜ã¿ãŒã®ã‚‹å®Ÿã‚Šã¸ã¤ãªã’ã¾ã™ã€‚
        </p>
      </div>

      {/* â‘¢ æ‰±ã„ */}
      <div className="group">
        <div className="aspect-square rounded-2xl overflow-hidden bg-surface-2 shadow-sm mb-6">
          {/* ç”»åƒå·®ã—æ›¿ãˆOKï¼šé¸æœãƒ»ç®±è©°ã‚ã®æ‰‹å…ƒå†™çœŸãŒç†æƒ³ */}
          <img
            src={IMAGES.ec_apple}
            alt="æ‰±ã„ã«ã“ã ã‚ã‚‹"
            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          />
        </div>
        <p className="text-primary font-eng text-xs tracking-widest font-semibold mb-2">03 / CARE</p>
        <h3 className="text-xl font-serif font-bold mb-3">æ‰±ã„ã«ã“ã ã‚ã‚‹</h3>
        <p className="text-sm text-muted leading-relaxed font-serif">
          åç©«å¾Œã¯ä¸€ç‰ãšã¤æ‰‹ã§ç¢ºèªã—ã€å‚·ã‚„æŠ¼ã—ã‚’é˜²ã„ã§ä¸å¯§ã«ç®±è©°ã‚ã—ã¾ã™ã€‚<br/>
          ã€Œå±Šãã¾ã§ãŒç•‘ä»•äº‹ã€ã¨ã„ã†æ°—æŒã¡ã§ã€ã‚Šã‚“ã”å„ªå…ˆã®æ‰±ã„ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ã€‚
        </p>
      </div>
    </div>
  </div>
  {/* â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² */}
</div>


                    {/* F08: Stop Movie Modal */}
                    {stopVideoModalOpen && (
                      <div
                        className="fixed inset-0 z-[100] bg-black/90 flex items-start justify-center p-4 overflow-y-auto"
                        style={{ paddingTop: 'calc(var(--header-height) + 16px)' }}
                        onClick={() => setStopVideoModalOpen(false)}
                      >
                        <div
                          className="relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden shadow-2xl"
                          onClick={e => e.stopPropagation()}
                        >
                          <video
                            src={IMAGES.stop_movie}
                            controls
                            autoPlay
                            playsInline
                            className="w-full h-full"
                          >
                            Your browser does not support the video tag.
                          </video>
                    
                          {/* ä¸Šå¯„ã›ã«ã™ã‚‹ã¨ -top ãŒè¦‹åˆ‡ã‚Œã‚„ã™ã„ã®ã§ã€å³ä¸Šã«é…ç½® */}
                          <button
                            className="absolute top-3 right-3 text-white font-bold bg-black/40 hover:bg-black/70 px-3 py-1 rounded transition-colors"
                            onClick={() => setStopVideoModalOpen(false)}
                          >
                            é–‰ã˜ã‚‹
                          </button>
                        </div>
                      </div>
                    )}
                    <AdSpace />
                </>
            );
        };

        // ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ï¼ˆé–¢ä¿‚è€…å„ä½ï¼‰ãƒšãƒ¼ã‚¸ï¼šé€šå ±ï¼ˆF13ï¼‰ã¯ã“ã“ã§è¡Œã†
        const AdminNotice = ({ phase, unlockFlag, flags, setPage, onReport }) => {
            const [confirmOpen, setConfirmOpen] = useState(false);
        
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);
        
            const evidenceCount = countFound(flags, EVIDENCE_FLAGS);
        
            const doReport = () => {
                setConfirmOpen(false);
        
                if (!flags.F13) {
                    unlockFlag('F13');
                }

                onReport();
            };

            const confirmMessage = phase >= 4
                ? "ååˆ†ãªè¨¼æ‹ ã¯æƒã£ãŸã‹ï¼Ÿä»ŠãŒæœ€å¾Œã®æ©Ÿä¼šã ã€‚"
                : "æœ¬å½“ã«é€šå ±ã™ã‚‹ã‹ï¼Ÿè¨¼æ‹ ãŒè¶³ã‚Šãªã„ã¨æ¶ˆã•ã‚Œã‚‹ã€‚";
        
            return (
                <div className="min-h-screen pt-24 pb-20 bg-surface">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›" sub="NOTICE" />
        
                        <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-sm border border-border p-8 md:p-12">
                            <button
                                onClick={() => setPage('home')}
                                className="flex items-center text-sm text-muted hover:text-primary mb-8 transition-colors"
                            >
                                <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                                HOMEã«æˆ»ã‚‹
                            </button>
        
                            <div className="font-serif leading-loose text-text space-y-6">
                                <div>
                                    <p className="text-xs text-accent font-eng mb-2">2026.01.20</p>
                                    <h2 className="text-2xl font-serif font-bold mb-2">
                                        ã€é‡è¦ã€‘ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ï¼ˆé–¢ä¿‚è€…å„ä½ï¼‰
                                    </h2>
                                    <p className="text-sm text-muted">
                                        â€»ã“ã®ãƒšãƒ¼ã‚¸ã¯å¤–éƒ¨å…±æœ‰ã‚’æƒ³å®šã—ã¦ã„ã¾ã›ã‚“ã€‚
                                    </p>
                                </div>
        
                                <div className="p-6 bg-surface-2 rounded-xl border border-border">
                                    <p>
                                        é–¢ä¿‚è€…å„ä½ã€‚<br />
                                        ç¾åœ¨ã€è¾²åœ’å‘¨è¾ºã§ã®æƒ…å ±æ‹¡æ•£ãƒ»ä¸å¯©ãªé–²è¦§ãŒç¢ºèªã•ã‚Œã¦ã„ã¾ã™ã€‚<br />
                                        è¨˜éŒ²ã®å–ã‚Šæ‰±ã„ã«ã¯ååˆ†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
                                    </p>
                                    <p className="mt-4 text-muted text-sm">
                                        ï¼ˆè¿½è¨˜ï¼‰ã‚‚ã—ã€å¤–éƒ¨ã«é€šå ±ã™ã‚‹å ´åˆã¯ã€Œååˆ†ãªè¨¼æ‹ ã€ã‚’æƒãˆã¦ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚
                                    </p>
                                </div>
        
                                {/* Phase3ã§é€šå ±è§£æ”¾ */}
                                {phase >= 3 ? (
                                    <div className="pt-6 text-center">
                                        <button
                                            className="px-10 py-4 rounded-full bg-accent text-white font-bold tracking-widest shadow-lg hover:bg-red-900 transition-colors"
                                            onClick={() => setConfirmOpen(true)}
                                        >
                                            è­¦å¯Ÿã«é€šå ±ã™ã‚‹
                                        </button>
                                        <p className="text-xs text-muted mt-3">
                                            ç¾åœ¨ã®è¨¼æ‹ æ•°ï¼š{evidenceCount}
                                        </p>
                                        <p className="text-xs text-accent mt-2">
                                            {phase >= 4 ? "æœ€çµ‚ç¢ºèªï¼š" : "è­¦å‘Šï¼š"} {confirmMessage}
                                        </p>
                                    </div>
                                ) : (
                                    <div className="pt-6 text-center">
                                        <button
                                            className="px-10 py-4 rounded-full bg-gray-200 text-gray-500 font-bold tracking-widest cursor-not-allowed"
                                            disabled
                                        >
                                            é€šå ±ï¼ˆPhase3ã§è§£æ”¾ï¼‰
                                        </button>
                                        <p className="text-xs text-muted mt-3">
                                            Phase3ã«åˆ°é”ã™ã‚‹ã¨é€šå ±ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
        
                    {/* ç¢ºèªï¼šYESã§é€šå ±ã€NOã§æˆ»ã‚‹ */}
                    <ConfirmModal
                        isOpen={confirmOpen}
                        message={confirmMessage}
                        yesLabel="ã‚¤ã‚¨ã‚¹ï¼ˆé€šå ±ã™ã‚‹ï¼‰"
                        noLabel="ãƒãƒ¼ï¼ˆæˆ»ã‚‹ï¼‰"
                        onYes={doReport}
                        onNo={() => setConfirmOpen(false)}
                        isHorror={true}
                    />
                </div>
            );
        };
        // --- CONTINUES IN PART 2 ---
                // 2. VILLAGE (Gallery & Tree)
        const Village = ({ phase, notifyEvidence, flags }) => {
            const [lightboxOpen, setLightboxOpen] = useState(false);

            // Phase2: ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ›ãƒãƒ¼ç•°å¤‰ï¼ˆF14ï¼‰è§£æ”¾
            const isCaptureHoverEnabled = phase >= 2;
            // Phase3: å¾¡ç¥æœ¨ãƒ›ãƒ©ãƒ¼ï¼ˆF10ï¼‰è§£æ”¾
            const isHorrorPhase = phase >= 3;

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="å¥¥ç¥ä¼æ‘ã«ã¤ã„ã¦" sub="OUR VILLAGE" />

                        {/* ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼šPhase1ã¯é€šå¸¸å›ºå®š / Phase2ä»¥é™ã§ãƒ›ãƒãƒ¼ç•°å¤‰ + F14 */}
                        {!isCaptureHoverEnabled && (
                            <div className="mb-20">
                                <div className="relative w-full h-[60vh] rounded-2xl shadow-sm mb-8 overflow-hidden">
                                    <img 
                                        src={IMAGES.village_normal} 
                                        alt="Village View" 
                                        className="absolute inset-0 w-full h-full object-cover" 
                                    />
                                </div>
                                <div className="max-w-2xl mx-auto text-center leading-loose">
                                    <p className="text-muted font-serif">
                                        å››æ–¹ã‚’é™ºã—ã„å±±ã€…ã«å›²ã¾ã‚ŒãŸå¥¥ç¥ä¼æ‘ã€‚<br/>
                                        ç‹¬è‡ªã®æ°—å€™é¢¨åœŸãŒã€ä»–ã«ã¯ãªã„æ¿ƒåšãªå‘³ã‚ã„ã®ä½œç‰©ã‚’è‚²ã¦ã¾ã™ã€‚<br/>
                                        å¤ãã‹ã‚‰ã“ã®åœ°ã«ã¯ã€Œç¥ã€ãŒå®¿ã‚‹ã¨è¨€ã‚ã‚Œã€æ‘äººã¯è‡ªç„¶ã‚’æ•¬ã„ã€å…±ã«ç”Ÿãã¦ãã¾ã—ãŸã€‚
                                    </p>
                                </div>
                            </div>
                        )}

                        {isCaptureHoverEnabled && (
                            <div 
                                className="mb-20 group cursor-pointer"
                                onMouseEnter={() => {
                                    if (!flags.F14) {
                                        notifyEvidence('F14', 'æ‘ã®ç´¹ä»‹å†™çœŸãŒä¸€ç¬ã ã‘å¤‰ã‚ã£ãŸæ°—ãŒã™ã‚‹â€¦ã€‚');
                                    }
                                }}
                                onTouchStart={() => {
                                    if (!flags.F14) {
                                        notifyEvidence('F14', 'æ‘ã®ç´¹ä»‹å†™çœŸãŒä¸€ç¬ã ã‘å¤‰ã‚ã£ãŸæ°—ãŒã™ã‚‹â€¦ã€‚');
                                    }
                                }}
                            >
                                <div className="relative w-full h-[60vh] rounded-2xl shadow-sm mb-8 overflow-hidden">
                                    {/* èƒŒé¢ï¼šå¤œ */}
                                    <img 
                                        src={IMAGES.village_night} 
                                        alt="Village Night" 
                                        className="absolute inset-0 w-full h-full object-cover" 
                                    />
                                    {/* å‰é¢ï¼šé€šå¸¸ï¼ˆãƒ›ãƒãƒ¼ã§æ¶ˆãˆã‚‹ï¼‰ */}
                                    <img 
                                        src={IMAGES.village_normal} 
                                        alt="Village View" 
                                        className="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out group-hover:opacity-0" 
                                    />
                                </div>

                                <div className="grid grid-cols-1 relative max-w-2xl mx-auto text-center leading-loose">
                                    {/* é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆï¼šãƒ›ãƒãƒ¼ã§æ¶ˆãˆã‚‹ */}
                                    <p className="col-start-1 row-start-1 text-muted font-serif transition-opacity duration-1000 ease-in-out group-hover:opacity-0">
                                        å››æ–¹ã‚’é™ºã—ã„å±±ã€…ã«å›²ã¾ã‚ŒãŸå¥¥ç¥ä¼æ‘ã€‚<br/>
                                        ç‹¬è‡ªã®æ°—å€™é¢¨åœŸãŒã€ä»–ã«ã¯ãªã„æ¿ƒåšãªå‘³ã‚ã„ã®ä½œç‰©ã‚’è‚²ã¦ã¾ã™ã€‚<br/>
                                        å¤ãã‹ã‚‰ã“ã®åœ°ã«ã¯ã€Œç¥ã€ãŒå®¿ã‚‹ã¨è¨€ã‚ã‚Œã€æ‘äººã¯è‡ªç„¶ã‚’æ•¬ã„ã€å…±ã«ç”Ÿãã¦ãã¾ã—ãŸã€‚
                                    </p>

                                    {/* ç•°å¤‰ãƒ†ã‚­ã‚¹ãƒˆï¼šãƒ›ãƒãƒ¼ã§ç¾ã‚Œã‚‹ */}
                                    <p className="col-start-1 row-start-1 text-[#8A2E2E] font-handwriting text-lg opacity-0 transition-opacity duration-1000 ease-in-out group-hover:opacity-100">
                                        å››æ–¹ã‚’é™ºã—ã„å±±ã€…ã«å›²ã¾ã‚ŒãŸå¥¥ç¥ä¼æ‘ã€‚<br/>
                                        ç‹¬è‡ªã®æ°—å€™é¢¨åœŸãŒã€ä»–ã«ã¯ãªã„æ¿ƒåšãªå‘³ã‚ã„ã®ä½œç‰©ã‚’è‚²ã¦ã¾ã™ã€‚<br/>
                                        å¤ãã‹ã‚‰ã“ã®åœ°ã«ã¯ã€Œç¥ã€ãŒå®¿ã‚‹ã¨è¨€ã‚ã‚Œã€æ‘äººã¯è‡ªç„¶ã‚’æ•¬ã„ã€<br/>
                                        <strong className="text-xl block mt-2 animate-pulse-slow">
                                            é¸ã°ã‚ŒãŸå¤œã«ã€<br/>
                                            é¸ã°ã‚ŒãŸã‚‚ã®ã‚’æ§ã’ã‚‹ã“ã¨ã§ã€<br/>
                                            æ‘ã®å®Ÿã‚Šã‚’ä¿ã£ã¦ãã¾ã—ãŸã€‚
                                        </strong>
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* Snow Village */}
                        <div className="mb-24 grid md:grid-cols-2 gap-12 items-center bg-white p-8 rounded-2xl shadow-sm">
                            <div className="order-2 md:order-1">
                                <h3 className="text-2xl font-serif mb-6 text-text">å†¬ã®é™å¯‚</h3>
                                <p className="text-muted leading-loose font-serif">
                                    å†¬ã¯é›ªãŒå¤šã„åœ°åŸŸã§ã™ãŒã€ä¸€é¢ã®ç¾ã—ãç™½ã„å§¿ã¸æ‘ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚<br/>
                                    ã—ã‚“ã—ã‚“ã¨é™ã‚Šç©ã‚‚ã‚‹é›ªã®éŸ³ã—ã‹èã“ãˆãªã„ã€é™å¯‚ã«åŒ…ã¾ã‚ŒãŸå†¬ã®å¥¥ç¥ä¼ã‚‚ã¾ãŸæ ¼åˆ¥ã§ã™ã€‚<br/>
                                    å³ã—ã•ã®ä¸­ã§è‚²ã¾ã‚Œã‚‹å‘½ã®åŠ›å¼·ã•ã‚’æ„Ÿã˜ã¦ãã ã•ã„ã€‚
                                </p>
                            </div>
                            <div className="order-1 md:order-2">
                                <img src={IMAGES.village_snow} alt="Winter Village" className="w-full h-80 object-cover rounded-xl shadow-md hover:scale-[1.02] transition-transform duration-500" />
                            </div>
                        </div>

                        <AdSpace className="mb-24" />

                        {/* F10: Symbol Treeï¼ˆPhase3ä»¥é™ã§ãƒ›ãƒ©ãƒ¼åŒ–ï¼‰ */}
                        <div className="bg-surface-2 rounded-2xl p-8 md:p-16 flex flex-col md:flex-row gap-12 items-center">
                            <div className="md:w-1/2">
                                <h3 className="text-2xl font-serif mb-4">å¾¡ç¥æœ¨</h3>
                                <p className="text-muted leading-relaxed mb-6">
                                    æ‘ã®ä¸­å¿ƒã«ãã³ãˆç«‹ã¤ã€æ¨¹é½¢300å¹´ã‚’è¶…ãˆã‚‹å¤§æ¨¹ã€‚<br/>
                                    æ‘ã®å®ˆã‚Šç¥ã¨ã—ã¦ã€æ³¨é€£ç¸„ã‚’å¼µã‚Šã€å¤§åˆ‡ã«ç¥€ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<br/>
                                    ãã®æ¨¹çš®ã®æ¨¡æ§˜ã¯ã€è¦‹ã‚‹è€…ã«ã‚ˆã£ã¦æ§˜ã€…ãªå§¿ã«è¦‹ãˆã‚‹ã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚
                                </p>

                                {isHorrorPhase ? (
                                    <button 
                                        className="text-[#8A2E2E] font-handwriting text-xl border-2 border-[#8A2E2E] px-8 py-3 rounded hover:bg-[#8A2E2E] hover:text-white transition-colors tracking-widest animate-pulse shadow-lg"
                                        onClick={() => {
                                            setLightboxOpen(true);
                                            if (!flags.F10) {
                                                notifyEvidence('F10', 'å¾¡ç¥æœ¨ã®æ ¹å…ƒã«ã€ä½•ã‹ãŒåŸ‹ã¾ã£ã¦ã„ã‚‹â€¦ã€‚', { mode: "toast" });
                                            }
                                        }}
                                    >
                                        ã”ç¥æœ¨ã®ãµã‚‚ã¨ã‚’æ˜ã‚Šèµ·ã“ã—ã¦ã¿ã‚‹
                                    </button>
                                ) : (
                                    <Button 
                                        variant="secondary" 
                                        onClick={() => setLightboxOpen(true)}
                                    >
                                        å†™çœŸã‚’æ‹¡å¤§ã—ã¦è¦‹ã‚‹
                                    </Button>
                                )}
                            </div>

                            <div className="md:w-1/2 w-full">
                                <img 
                                    src={IMAGES.tree_default} 
                                    alt="Sacred Tree" 
                                    className="w-full h-80 object-cover rounded-lg shadow-md hover:grayscale transition-all duration-1000 cursor-zoom-in" 
                                    onClick={() => setLightboxOpen(true)}
                                />
                            </div>
                        </div>
                    </div>

                    {/* Lightbox Modal */}
                    {lightboxOpen && (
                        <div className="fixed inset-0 z-[100] lightbox-overlay flex items-center justify-center p-4" onClick={() => setLightboxOpen(false)}>
                            <div className="relative max-w-4xl w-full max-h-screen flex flex-col items-center" onClick={(e) => e.stopPropagation()}>
                                <img 
                                    src={isHorrorPhase ? IMAGES.tree_change : IMAGES.tree_default} 
                                    className="w-full h-auto max-h-[70vh] object-contain rounded shadow-2xl mb-6" 
                                    alt="Tree Evidence"
                                />
                                
                                {isHorrorPhase ? (
                                    <div className="text-center animate-fade-up">
                                        <p className="text-red-600 font-handwriting text-sm md:text-base mb-4 tracking-widest drop-shadow-md animate-pulse">
                                            èª°ã‹ã€è¦‹ã¤ã‘ã¦â€¦
                                        </p>
                                        
                                        <button 
                                            className="text-white border border-white/30 px-8 py-2 hover:bg-white hover:text-black transition-colors font-serif text-sm tracking-widest" 
                                            onClick={() => setLightboxOpen(false)}
                                        >
                                            é–‰ã˜ã‚‹
                                        </button>
                                    </div>
                                ) : (
                                    <button className="absolute -top-10 right-0 text-white font-bold" onClick={() => setLightboxOpen(false)}>
                                        é–‰ã˜ã‚‹
                                    </button>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 3. ABOUT (Greeting & Staff)
        const About = ({ phase, notifyEvidence, flags, setPage, setSelectedStaff }) => {
            const normalText = `å°æœ¨ã¯ä½™è¨ˆãªæè‘‰ã‚’å‰ªå®šã—ã¾ã™ã€‚è‰¯ã„å®Ÿã‚’ã¤ã‘ã‚‹ãŸã‚ã«ã¯ã€è¦ªã¨ãªã‚‹æœ¨ãŒå¥åº·ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚\nåœŸå£Œã®å¾®ç”Ÿç‰©ã€æ£®ã®æœ¨ã€…ã€ãã—ã¦ç§ãŸã¡äººé–“ã€‚ã™ã¹ã¦ãŒå¾ªç’°ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚`;
            const horrorText = `å°æœ¨ã®äººé–“ã¯å‹•ãã¨æœ¨ãŒæ­ªã‚€ã®ã§ã€ã‚¢ã‚­ãƒ¬ã‚¹è…±ã¯æ—©ã‚ã«åˆ‡ã‚‹ã“ã¨ãŒå¤§äº‹ã§ã™ã€‚ä½™è¨ˆãªéƒ¨åˆ†ã¯å‰ªå®šã—ã¾ã™ã€‚è‰¯ã„å®Ÿã‚’ã¤ã‘ã‚‹ãŸã‚ã€äººã®å›ºå®šãŒé‡è¦ã§ã™ã€‚åœŸå£Œã€æ£®ã®æœ¨ã€…ã€ãã—ã¦äººé–“ã™ã¹ã¦ãŒå¾ªç’°ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚`;

            const [isGlitching, setIsGlitching] = useState(false);

            // Phase3ä»¥é™ã§åœ’é•·ã‚®ãƒŸãƒƒã‚¯ï¼ˆF09ï¼‰è§£æ”¾
            useEffect(() => {
                if (phase < 3) return;

                const glitchInterval = setInterval(() => {
                    setIsGlitching(true);

                    if (!flags.F09) {
                        notifyEvidence('F09', 'åœ’é•·ã®å†™çœŸãŒæ­ªã‚“ã â€¦ã€‚');
                    }

                    setTimeout(() => setIsGlitching(false), 2000);
                }, 5000);

                return () => clearInterval(glitchInterval);
            }, [phase, flags.F09, notifyEvidence]);

            const handleStaffClick = (staff) => {
                setSelectedStaff(staff);
                setPage('staff_detail');
            };

            const StaffCard = ({ staff }) => (
                <div 
                    className="bg-surface p-6 rounded-2xl hover-card text-center group h-full cursor-pointer"
                    onClick={() => {
                    ã€€handleStaffClick(staff);
                    }}
                >
                    <div className="w-full aspect-[4/5] overflow-hidden rounded-xl mb-6 relative">
                        <img 
                            src={staff.image} 
                            alt={staff.name} 
                            className={`w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 ${staff.id === 'vu' ? 'grayscale-[30%] contrast-125' : ''}`} 
                        />
                        {staff.id === 'vu' && (
                            <div className="absolute inset-0 bg-black/70 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <span className="text-white font-serif tracking-widest">è¨˜éŒ²æ¬ æ</span>
                            </div>
                        )}
                        <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                            <span className="bg-white/90 text-text text-xs px-4 py-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0 duration-300 font-serif">
                                è©³ã—ãè¦‹ã‚‹
                            </span>
                        </div>
                    </div>
                    <p className="text-primary font-eng text-xs tracking-wider mb-2">{staff.role}</p>
                    <h4 className="text-xl font-serif font-bold mb-3">{staff.name}</h4>
                    <p className="text-sm text-muted leading-relaxed relative line-clamp-2">
                        {staff.short_intro || <span className="opacity-0">...</span>}
                    </p>
                </div>
            );

            // Phase3ã§ãƒ´ãƒ¼ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ˆPhase1/2ã¯vuã‚’é™¤å¤–ï¼‰
            const visibleStaff = (phase >= 3) ? STAFF_DATA : STAFF_DATA.filter(s => s.id !== 'vu');

            return (
                <div className="min-h-screen pt-24 pb-20 bg-surface-2">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="è¾²åœ’ã«ã¤ã„ã¦" sub="ABOUT US" />

                        {/* åœ’é•·æŒ¨æ‹¶ */}
                        <section className="grid md:grid-cols-2 gap-12 md:gap-24 items-center mb-32">
                            <div className="relative order-2 md:order-1">
                                <div className="w-full aspect-[4/5] rounded-2xl shadow-lg overflow-hidden relative">
                                    <img 
                                        src={isGlitching ? IMAGES.staff_manager_change : IMAGES.staff_manager} 
                                        className={`w-full h-full object-cover transition-none ${isGlitching ? 'image-glitching' : ''}`} 
                                        alt="åœ’é•·" 
                                    />
                                    {isGlitching && (
                                        <div 
                                            className="absolute inset-0 bg-black/20 pointer-events-none mix-blend-overlay" 
                                            style={{ 
                                                backgroundImage: 'url("data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.85\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E")', 
                                                opacity: 0.4 
                                            }}
                                        ></div>
                                    )}
                                </div>
                                <div className="absolute -bottom-6 -right-6 bg-white p-6 rounded-lg shadow-xl hidden md:block">
                                    <p className="font-serif font-bold text-lg">ç¥å» å·Œ</p>
                                    <p className="text-xs text-muted font-eng">åœ’é•· / Iwao Kamisari</p>
                                </div>
                            </div>

                            <div className="order-1 md:order-2 pt-8">
                                <h3 className="text-2xl md:text-3xl font-serif mb-8 leading-snug">
                                    è‡ªç„¶ã®å£°ã‚’èãã€<br/>å‘½ã‚’ç¹‹ãè¾²æ¥­ã‚’ã€‚
                                </h3>
                                <div className="prose prose-lg font-serif leading-loose mb-8 h-[200px]">
                                    <p className="mb-4 text-text">
                                        å¥¥ç¥ä¼ãƒ•ã‚¡ãƒ¼ãƒ ã¸ã‚ˆã†ã“ãã€‚<br/>
                                        ç§ãŸã¡ã¯ã€ã“ã®åœŸåœ°ã®ä¼çµ±ã‚’å®ˆã‚ŠãªãŒã‚‰ã€æŒç¶šå¯èƒ½ãªè¾²æ¥­ã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã€‚
                                    </p>
                                    <p className={`transition-none duration-0 ${isGlitching ? 'text-[#8A2E2E]' : 'text-text'}`}>
                                        {isGlitching ? horrorText : normalText}
                                    </p>
                                </div>
                                <div className="hidden md:block">
                                    <img src={IMAGES.top_farm} className="h-32 w-full object-cover rounded-lg opacity-60 grayscale-[30%]" alt="farm" />
                                </div>
                            </div>
                        </section>

                        {/* ã‚¹ã‚¿ãƒƒãƒ•ç´¹ä»‹ */}
                        <section>
                            <div className="text-center mb-16">
                                <h3 className="text-2xl font-serif mb-4">ã‚¹ã‚¿ãƒƒãƒ•ç´¹ä»‹</h3>
                                <p className="text-muted font-eng text-sm tracking-widest">OUR STAFF</p>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {visibleStaff.map(staff => (
                                    <StaffCard key={staff.id} staff={staff} />
                                ))}
                            </div>
                        </section>
                    </div>
                </div>
            );
        };

        // 3.5 STAFF DETAIL
        const StaffDetail = ({ staff, setPage, notifyEvidence, flags }) => {
            const [modalImage, setModalImage] = useState(null);

            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            if (!staff) return null;

            return (
                <div className="min-h-screen pt-32 pb-20 bg-surface">
                    <div className="max-w-4xl mx-auto px-6">
                        <button 
                            onClick={() => setPage('about')}
                            className="flex items-center text-sm text-muted hover:text-primary mb-8 transition-colors"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                            ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã«æˆ»ã‚‹
                        </button>

                        <div className="grid md:grid-cols-2 gap-12 items-start">
                            <div>
                                <div className="aspect-[4/5] w-full rounded-2xl overflow-hidden shadow-lg mb-6">
                                    <img src={staff.image} alt={staff.name} className="w-full h-full object-cover" />
                                </div>
                                <div className="text-center md:text-left">
                                    <p className="text-primary font-eng text-sm tracking-wider font-bold mb-1">{staff.role}</p>
                                    <h2 className="text-3xl font-serif font-bold mb-2">{staff.name}</h2>
                                    <p className="text-sm text-muted">{staff.role_jp}</p>
                                </div>
                            </div>

                            <div className="space-y-10 font-serif leading-loose text-text">
                                <div>
                                    <h3 className="text-lg font-bold border-b border-border pb-2 mb-4">è‡ªå·±ç´¹ä»‹</h3>
                                    <p>
                                        {staff.intro}
                                        {staff.id === 'sato' && (
                                            <span 
                                                className="hidden-sos ml-1 select-all cursor-text"
                                                onMouseUp={() => {
                                                    const selection = window.getSelection().toString();
                                                    if (selection.includes("ç‹‚ã£ã¦ã‚‹") && !flags.F01) {
                                                        notifyEvidence('F01', 'ãƒ†ã‚­ã‚¹ãƒˆã‚’åè»¢ã—ã¦ç™ºè¦‹ï¼š\nã€Œã“ã®æ‘ã¯ç‹‚ã£ã¦ã‚‹ã€‚å‡ºã‚‰ã‚Œãªã„ã€‚åŠ©ã‘ã¦ãã‚Œã€');
                                                    }
                                                }}
                                            >
                                                {staff.hidden}
                                            </span>
                                        )}
                                    </p>
                                </div>

                                <div>
                                    <h3 className="text-lg font-bold border-b border-border pb-2 mb-4">è¾²åœ’ã«å…¥ã£ãŸãã£ã‹ã‘</h3>
                                    <p>{staff.reason}</p>
                                </div>

                                <div>
                                    <h3 className="text-lg font-bold border-b border-border pb-2 mb-4">ä»•äº‹ã‚’ã—ã¦ã„ã¦æ¥½ã—ã„ã“ã¨ã€ã‚„ã‚ŠãŒã„</h3>
                                    <p>{staff.joy}</p>
                                </div>

                                {/* ç‰¹åˆ¥ãªæ³¨é‡ˆãƒªãƒ³ã‚¯ (ãƒ´ãƒ¼ãƒ»ã‚¿ã‚¤ãƒ³ãƒ»ã‚¢ãƒ³ç”¨) */}
                                {staff.special_note && (
                                    <div className="mt-8 pt-4 border-t border-dotted border-gray-400">
                                        <span 
                                            className="text-xs text-gray-400 cursor-pointer hover:text-red-800 transition-colors"
                                            onClick={() => {
                                            setModalImage(staff.special_image);
                                            if (!flags.F06) {
                                            notifyEvidence('F06', 'æ³¨é‡ˆãƒªãƒ³ã‚¯ã®å…ˆã«ã€å¤±è¸ªã«é–¢ã™ã‚‹è¨˜éŒ²ãŒæ®‹ã•ã‚Œã¦ã„ãŸã€‚', { mode: "toast" });
                                            }
                                            }}
                                        >
                                            {staff.special_note}
                                        </span>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Image Modal for Special Note */}
                    {modalImage && (
                        <div 
                            className="fixed inset-0 z-[100] bg-black flex items-center justify-center p-4 cursor-pointer"
                            onClick={() => setModalImage(null)}
                        >
                            <div className="max-w-3xl w-full">
                                <img src={modalImage} alt="Hidden Evidence" className="w-full h-auto shadow-2xl rounded" />
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 4. PRODUCTS
        const Products = ({ phase, notifyEvidence, flags }) => {
            const categories = ["ALL", "APPLE", "GRAPES", "PROCESSED"];
            const [selectedCategory, setSelectedCategory] = useState("ALL");
            const [videoModalOpen, setVideoModalOpen] = useState(false);

            const products = [
                { 
                    id: 1, 
                    name: "å¥¥ç¥ä¼ã‚Šã‚“ã”ã€Œæœ±å®Ÿã€", 
                    price: "Â¥5,000", 
                    cat: "APPLE", 
                    img: IMAGES.ec_apple,
                    desc: "é©šãã»ã©ã®ç³–åº¦ã¨ã€æ·±ç´…ã®è‰²åˆã„ã€‚è´ˆã‚Šç‰©ã«ã‚‚æœ€é©ã§ã™ã€‚",
                    tags: ["#ç”˜ã„", "#å­£ç¯€é™å®š", "#ã‚®ãƒ•ãƒˆ", "#èœœå…¥ã‚Š", "#ä¿¡å·", "#æœé£Ÿã«"]
                },
                { 
                    id: 2, 
                    name: "æ‰‹ä½œã‚Šã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤", 
                    price: "Â¥3,500", 
                    cat: "PROCESSED", 
                    img: IMAGES.ec_applepie, 
                    desc: "ç”±åˆ©ã•ã‚“ç§˜ä¼ã®ãƒ¬ã‚·ãƒ”ã€‚ã‚µã‚¯ã‚µã‚¯ã®ãƒ‘ã‚¤ç”Ÿåœ°ã¨ç”˜é…¸ã£ã±ã„ãƒ•ã‚£ãƒªãƒ³ã‚°ã€‚",
                    tags: ["#æ¯ã®å‘³", "#ç„¡æ·»åŠ ", "#æ‰‹ä½œã‚Š", "#ãŠã‚„ã¤", "#ç„¼ããŸã¦", "#äººæ°—No.1"]
                },
                { 
                    id: 3, 
                    name: "æœ‰æ©Ÿæ ½åŸ¹ãƒ–ãƒ‰ã‚¦", 
                    price: "Â¥8,000", 
                    cat: "GRAPES", 
                    img: IMAGES.ec_grape, 
                    desc: "æ¥ãæœ¨æŠ€è¡“ã®çµæ™¶ã€‚æ·±ã„ã‚³ã‚¯ã¨é¦™ã‚Šã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚",
                    tags: [
                        "#é•·é‡çœŒç”£",
                        "#æœ‰æ©ŸJAS",
                        "#èŠ³é†‡ãªé¦™ã‚Š",
                        ...(phase >= 2 ? ["#ã‚­ãƒ…ã‚¤ãƒ†"] : []),
                        "#å¸Œå°‘å“ç¨®",
                        "#ãƒ¯ã‚¤ãƒ³ç”¨",
                        "#çš®ã”ã¨é£Ÿã¹ã‚‰ã‚Œã‚‹",
                        "#ç§‹ã®å‘³è¦š",
                        "#è´ˆç­”ç”¨"
                    ]
                },
                { 
                    id: 4, 
                    name: "ç‰¹è£½ã‚¸ãƒ£ãƒ ", 
                    price: "Â¥1,200", 
                    cat: "PROCESSED", 
                    img: IMAGES.ec_jam, 
                    desc: "å®Œç†Ÿæœå®Ÿã‚’ãã®ã¾ã¾ç…®è©°ã‚ã¾ã—ãŸã€‚ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆã«æœ€é©ã€‚",
                    tags: ["#æœé£Ÿ", "#ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯", "#ä¿å­˜æ–™ä¸ä½¿ç”¨", "#ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆã«"]
                },
                { 
                    id: 5, 
                    name: "å­£ç¯€ã®è©°ã‚åˆã‚ã›", 
                    price: "Â¥10,000", 
                    cat: "ALL", 
                    img: IMAGES.ec_set, 
                    desc: "æ—¬ã®å‘³è¦šã‚’è´…æ²¢ã«è©°ã‚åˆã‚ã›ã¾ã—ãŸã€‚ã”è´ˆç­”ç”¨ã«ã€‚",
                    tags: ["#æ•°é‡é™å®š", "#ãŠä¸­å…ƒ", "#é€æ–™ç„¡æ–™", "#ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘"]
                },
                { 
                    id: 6, 
                    name: "Coming Soon...", 
                    price: "-", 
                    cat: "ALL", 
                    img: IMAGES.icon_default, 
                    desc: "æ–°ã—ã„å•†å“ã®æº–å‚™ä¸­ã§ã™ã€‚ã”æœŸå¾…ãã ã•ã„ã€‚",
                    tags: [],
                    isComingSoon: true
                },
            ];

            const filteredProducts = useMemo(() => {
                if (selectedCategory === "ALL") return products;
                // catãŒALLã®ã‚‚ã®ã¯å¸¸ã«å‡ºã™ï¼ˆè©°ã‚åˆã‚ã›ç­‰ï¼‰
                return products.filter(p => p.cat === selectedCategory || p.cat === "ALL");
            }, [selectedCategory, phase]);

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="å•†å“ä¸€è¦§" sub="PRODUCTS" />

                        <div className="flex flex-wrap justify-center gap-4 md:gap-8 mb-16">
                            {categories.map((cat) => (
                                <button
                                    key={cat}
                                    onClick={() => setSelectedCategory(cat)}
                                    className={`text-sm font-eng tracking-widest px-4 py-2 rounded-full transition-colors ${
                                        selectedCategory === cat 
                                            ? 'bg-text text-white' 
                                            : 'text-muted hover:bg-surface-2'
                                    }`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12 mb-20">
                            {filteredProducts.map(p => (
                                <div key={p.id} className={`group cursor-pointer ${p.isComingSoon ? 'opacity-60' : ''}`}>
                                    <div className="aspect-square overflow-hidden rounded-2xl mb-4 bg-surface-2 relative flex items-center justify-center">
                                        {p.isComingSoon ? (
                                            <div className="text-center">
                                                <img src={p.img} alt={p.name} className="w-20 h-20 opacity-30 mx-auto mb-2" />
                                                <span className="font-eng tracking-widest text-muted">Coming Soon</span>
                                            </div>
                                        ) : (
                                            <img src={p.img} alt={p.name} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
                                        )}
                                    </div>
                                    <div className="text-left">
                                        <div className="flex justify-between items-baseline mb-2">
                                            <h3 className="text-lg font-serif font-bold">{p.name}</h3>
                                            <p className="text-sm font-eng text-muted">{p.price}</p>
                                        </div>
                                        <p className="text-sm text-muted mb-4 leading-relaxed border-b border-border pb-4">{p.desc}</p>

                                        <div className="flex flex-wrap gap-2">
                                            {p.tags.map((tag, i) => (
                                                <span 
                                                    key={i}
                                                    className={`text-[11px] px-2 py-1 rounded border border-border text-muted transition-colors hover:bg-gray-100 ${
                                                        tag === "#ã‚­ãƒ…ã‚¤ãƒ†" ? "cursor-help hover:text-accent" : "cursor-default"
                                                    }`}
                                                    onClick={(e) => {
                                                        if (tag === "#ã‚­ãƒ…ã‚¤ãƒ†") {
                                                            // Phase2ä»¥é™ã®ã¿æœ‰åŠ¹
                                                            if (phase < 2) return;
                                                            e.stopPropagation();
                                                            setVideoModalOpen(true);
                                                            if (!flags.F02) {
                                                                notifyEvidence('F02', 'ã‚¿ã‚°ã‚’è¾¿ã‚‹ã¨ã€æ˜ åƒãŒæ®‹ã•ã‚Œã¦ã„ãŸã€‚', { mode: "toast" });
                                                            }
                                                        }
                                                    }}
                                                >
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <AdSpace />
                    </div>
                     {videoModalOpen && (
                      <div
                        className="fixed inset-0 z-[100] bg-black/90 flex items-start justify-center p-4 overflow-y-auto"
                        style={{ paddingTop: 'calc(var(--header-height) + 16px)' }}
                        onClick={() => setVideoModalOpen(false)}
                      >
                        <div
                          className="relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden shadow-2xl"
                          onClick={e => e.stopPropagation()}
                        >
                          <video
                            src={IMAGES.victim_movie}
                            controls
                            autoPlay
                            playsInline
                            className="w-full h-full"
                          >
                            Your browser does not support the video tag.
                          </video>
                    
                          {/* ä¸Šå¯„ã›ã«ã™ã‚‹ã¨ -top ãŒè¦‹åˆ‡ã‚Œã‚„ã™ã„ã®ã§ã€å³ä¸Šã«é…ç½® */}
                          <button
                            className="absolute top-3 right-3 text-white font-bold bg-black/40 hover:bg-black/70 px-3 py-1 rounded transition-colors"
                            onClick={() => setVideoModalOpen(false)}
                          >
                            é–‰ã˜ã‚‹
                          </button>
                        </div>
                      </div>
                    )}
                 </div>
            );
        };

        // --- CONTINUES IN PART 3 ---
                // 5. DIARY (List)
        const Diary = ({ phase, notifyEvidence, flags, setPage, setSelectedArticle }) => {
            const [search, setSearch] = useState("");
            const [isAncient, setIsAncient] = useState(false);

            const handleSearch = (e) => {
                e.preventDefault();
                const q = (search || "").trim();
                // Phase3ä»¥é™ã§ã®ã¿ã€Œ1826ã€æ¤œç´¢ãŒç•°å¤‰ã«ãªã‚‹ï¼ˆF07æ¢ç´¢å¯èƒ½ï¼‰
                if (phase >= 3 && q === "1826") {
                    setIsAncient(true);
                    if (!flags.F07) {
                        notifyEvidence('F07', 'æ¤œç´¢çµæœã«ç•°å¤‰ãŒç”Ÿã˜ã¾ã—ãŸã€‚\n1826å¹´ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚');
                    }
                }
            };

            const handleArticleClick = (article) => {
                if (article.id === 99) { 
                    setPage('ancient_document');
                    return;
                }
                setSelectedArticle(article);
                setPage('article_detail');
            };

            const ancientArticles = [
                { 
                    id: 99, 
                    date: "1826.04.04", 
                    title: "å¥¥ç¥ä¼æ‘ æ—§è¨˜æŠœç²‹", 
                    desc: "æ–‡æ”¿ä¹å¹´ã®è¨˜éŒ²ã€‚é–²è¦§æ³¨æ„ã€‚", 
                    img: IMAGES.blog_oldbook 
                }
            ];

            const displayArticles = isAncient ? ancientArticles : BLOG_DATA;

            return (
                <div className={`min-h-screen pt-24 pb-20 ${isAncient ? 'bg-[#2a2520] text-[#a89f91]' : ''}`}>
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title={isAncient ? "è¨˜éŒ²ä¿ç®¡åº«" : "æ´»å‹•æ—¥èªŒ"} sub={isAncient ? "ARCHIVES" : "FARM DIARY"} />

                        <div className="flex flex-col md:flex-row gap-12">
                            <div className="md:w-1/4">
                                <form onSubmit={handleSearch} className="relative mb-8">
                                    <input 
                                        type="text" 
                                        placeholder="æ¤œç´¢..." 
                                        className={`w-full border-b bg-transparent py-2 pr-8 outline-none text-sm ${isAncient ? 'border-[#555] text-[#ccc] focus:border-red-900' : 'border-border focus:border-primary'}`}
                                        value={search}
                                        onChange={(e) => setSearch(e.target.value)}
                                    />
                                    <i data-lucide="search" className={`absolute right-0 top-2 w-4 h-4 ${isAncient ? 'text-[#555]' : 'text-muted'}`}></i>
                                </form>

                                <div className={`space-y-2 text-sm font-serif ${isAncient ? 'text-[#666]' : 'text-muted'}`}>
                                    <p>æ—¥è¨˜ã®ä¸€è¦§</p>
                                    <ul className={`pl-4 space-y-1 border-l ${isAncient ? 'border-[#444]' : 'border-border'}`}>
                                        <li className="flex justify-between">
                                            <span>è¾²åœ’ã®æ—¥å¸¸</span>
                                            <span>(2)</span>
                                        </li>
                                        <li className="flex justify-between">
                                            <span>ã‚¤ãƒ™ãƒ³ãƒˆ</span>
                                            <span>(1)</span>
                                        </li>
                                        <li className="flex justify-between">
                                            <span>ã”æŒ¨æ‹¶</span>
                                            <span>(1)</span>
                                        </li>
                                        <li className="pt-1 text-[14px] opacity-80">
                                            åˆè¨ˆ5ä»¶
                                        </li>
                                    </ul>
                                </div>
                                
                                {!isAncient && <AdSpace className="mt-12 hidden md:block" />}
                            </div>

                            <div className="md:w-3/4 space-y-12">
                                {displayArticles.map(article => (
                                    <article key={article.id} className="group cursor-pointer" onClick={() => handleArticleClick(article)}>
                                        <div className="flex flex-col md:flex-row gap-6 items-start">
                                            <div className="md:w-1/3 aspect-video bg-black/20 rounded-lg overflow-hidden relative">
                                                <img 
                                                    src={article.img} 
                                                    alt={article.title}
                                                    className={`w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 ${isAncient ? 'opacity-70 grayscale sepia' : ''}`} 
                                                />
                                            </div>
                                            <div className="md:w-2/3">
                                                <p className={`text-xs font-eng mb-2 ${isAncient ? 'text-[#8A2E2E]' : 'text-muted'}`}>{article.date}</p>
                                                <h3 className={`text-xl font-serif font-bold mb-3 ${isAncient ? 'text-[#ccc] tracking-widest' : ''}`}>{article.title}</h3>
                                                <p className={`text-sm leading-relaxed mb-4 ${isAncient ? 'text-[#888]' : 'text-muted'}`}>{article.desc}</p>
                                                <span className={`${isAncient ? 'text-[#8A2E2E]' : 'text-primary'} text-sm font-medium hover:underline`}>ç¶šãã‚’èª­ã‚€ â†’</span>
                                            </div>
                                        </div>
                                    </article>
                                ))}
                                
                                {!isAncient && <AdSpace />}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5.5 ARTICLE DETAIL
        const ArticleDetail = ({ article, setPage }) => {
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            if (!article) return null;

            return (
                <div className="min-h-screen pt-32 pb-20 bg-surface">
                    <div className="max-w-3xl mx-auto px-6">
                        <button 
                            onClick={() => setPage('diary')}
                            className="flex items-center text-sm text-muted hover:text-primary mb-8 transition-colors"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                            è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹
                        </button>

                        <article className="prose prose-stone lg:prose-lg mx-auto">
                            <div className="mb-8 text-center">
                                <p className="text-sm text-muted font-eng mb-2">{article.date}</p>
                                <h1 className="text-3xl font-serif font-bold mb-6 leading-relaxed">{article.title}</h1>
                                <div className="w-full aspect-video rounded-xl overflow-hidden mb-8 shadow-sm">
                                    <img src={article.img} alt={article.title} className="w-full h-full object-cover" />
                                </div>
                            </div>

                            <div className="font-serif leading-loose text-text space-y-6">
                                {article.content.split('\n').map((line, i) => (
                                    line === "" ? <br key={i} /> : <p key={i}>{line}</p>
                                ))}
                            </div>

                            {/* ãƒ¬ã‚·ãƒ”å°ç·šï¼ˆé€šå¸¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ */}
                            {article.isRecipe && (
                                <div className="mt-12 p-6 border-t border-b border-border text-center">
                                    <p className="mb-4 font-bold">â–¼ è©³ã—ãã¯ã“ã¡ã‚‰</p>
                                    <span 
                                        className="text-accent underline cursor-pointer text-lg hover:text-red-700 transition-colors font-serif"
                                        onClick={() => setPage('recipe')}
                                    >
                                        â–¶ ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤ã®ãƒ¬ã‚·ãƒ”ã‚’å…¬é–‹ï¼
                                    </span>
                                </div>
                            )}
                        </article>

                        <div className="mt-20 border-t border-border pt-12">
                            <AdSpace />
                        </div>
                    </div>
                </div>
            );
        };

        // 5.6 RECIPE DETAIL (F04å°ç·š)
        const RecipeDetail = ({ setPage, notifyEvidence, flags }) => {
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            return (
                <div className="min-h-screen pt-32 pb-20 bg-[#F9F7F2] font-handwriting">
                    <div className="max-w-3xl mx-auto px-6">
                        <button 
                            onClick={() => setPage('diary')}
                            className="flex items-center text-sm text-muted hover:text-primary mb-8 transition-colors font-sans"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                            è¨˜äº‹ã«æˆ»ã‚‹
                        </button>

                        <div className="bg-white p-8 md:p-16 shadow-lg rounded-lg border-2 border-[#E6E8E2] relative transform rotate-1">
                            <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 w-32 h-8 bg-[#e0e0e0]/80 rotate-2 shadow-sm"></div>

                            <h1 className="text-4xl font-bold text-center mb-12 text-[#8A2E2E]">ç”±åˆ©ã•ã‚“ã®ç‰¹è£½ã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤</h1>
                            
                            <div className="flex flex-col md:flex-row gap-12 mb-16">
                                <div className="md:w-1/2">
                                    <div className="aspect-square bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-4 border-white shadow-md transform -rotate-2">
                                        <img src={IMAGES.recipe_applepie} className="w-full h-full object-cover" alt="ç„¼ãä¸ŠãŒã£ãŸã‚¢ãƒƒãƒ—ãƒ«ãƒ‘ã‚¤" />
                                    </div>
                                </div>
                                <div className="md:w-1/2">
                                    <h3 className="text-2xl font-bold mb-6 border-b-2 border-dotted border-[#8A2E2E] pb-2 inline-block">ææ–™ (1ãƒ›ãƒ¼ãƒ«åˆ†)</h3>
                                    <ul className="space-y-4 text-lg">
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>ã‚Šã‚“ã”</span>
                                            <span className="text-right">3å€‹</span>
                                        </li>
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>å†·å‡ãƒ‘ã‚¤ã‚·ãƒ¼ãƒˆ</span>
                                            <span>2æš</span>
                                        </li>
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>ç ‚ç³–</span>
                                            <span>60g</span>
                                        </li>
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>ãƒã‚¿ãƒ¼</span>
                                            <span>20g</span>
                                        </li>
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>ã‚·ãƒŠãƒ¢ãƒ³</span>
                                            <span>å°‘ã€…</span>
                                        </li>
                                        <li className="flex justify-between border-b border-dotted pb-1 border-gray-300">
                                            <span>åµé»„</span>
                                            <span>1å€‹åˆ†</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div className="space-y-10 text-lg leading-loose">
                                <h3 className="text-2xl font-bold mb-6 border-b-2 border-dotted border-[#8A2E2E] pb-2 text-center">ä½œã‚Šæ–¹</h3>
                                
                                <div>
                                    <h4 className="font-bold text-[#2F6B3E] text-xl mb-2">1. ä¸‹æº–å‚™</h4>
                                    <p>
                                        ã‚Šã‚“ã”ã¯çš®ã‚’ã‚€ãã€èŠ¯ã‚’é™¤ã„ã¦8ç­‰åˆ†ã®ãã—å½¢ã«åˆ‡ã‚‹ã€‚<br/>
                                        <span className="text-base text-muted">â€»å¥¥ç¥ä¼ã®ã€Œæ–°é®®ãªæœ±ç¾ã€ãŒãŠã™ã™ã‚ã§ã™ã€‚</span><br/>
                                        <span className="text-base text-muted">â€»ç«ã®é€šã‚Šã‚’å‡ä¸€ã«ã—ãŸã„å ´åˆã¯ã€5mmç¨‹åº¦ã®è–„åˆ‡ã‚Šã«ã—ã¦ã‚‚ã‚ˆã„ã€‚</span>
                                    </p>
                                </div>

                                <div>
                                    <h4 className="font-bold text-[#2F6B3E] text-xl mb-2">2. ç…®è©°ã‚ã‚‹</h4>
                                    <p>
                                        é‹ã«ã‚Šã‚“ã”ã€ç ‚ç³–ã€ãƒã‚¿ãƒ¼ã€ã‚·ãƒŠãƒ¢ãƒ³ã‚’å…¥ã‚Œã¦ä¸­ç«ã«ã‹ã‘ã‚‹ã€‚<br/>
                                        æ°´åˆ†ãŒå‡ºã¦ããŸã‚‰å¼±ç«ã«ã—ã€ç„¦ãŒã•ãªã„ã‚ˆã†ã«æ™‚ã€…æ··ãœãªãŒã‚‰ç…®è¾¼ã‚€ã€‚<br/>
                                        ã‚Šã‚“ã”ãŒé€ãé€šã‚Šã€å°‘ã—èŠ¯ãŒæ®‹ã‚‹ç¨‹åº¦ã«ãªã£ãŸã‚‰ã€æœ€å¾Œã«ç«ã‚’ã‚„ã‚„å¼·ã‚ã¦ä½™åˆ†ãªæ°´åˆ†ã‚’é£›ã°ã™ã€‚<br/>
                                        ç«ã‚’æ­¢ã‚ã€å®Œå…¨ã«å†·ã¾ã—ã¦ãŠãã€‚
                                    </p>
                                </div>

                                <div>
                                    <h4 className="font-bold text-[#2F6B3E] text-xl mb-2">3. åŒ…ã‚€</h4>
                                    <p>
                                        å†·å‡ãƒ‘ã‚¤ã‚·ãƒ¼ãƒˆã‚’å®¤æ¸©ã§å°‘ã—æˆ»ã—ã€è»½ãä¼¸ã°ã™ã€‚<br/>
                                        1æšã‚’å¤©æ¿ã«æ•·ãã€å†·ã¾ã—ãŸã‚Šã‚“ã”ã‚’ä¸­å¤®ãŒã‚„ã‚„é«˜ããªã‚‹ã‚ˆã†ã«ä¸¦ã¹ã‚‹ã€‚<br/>
                                        ã‚‚ã†1æšã®ãƒ‘ã‚¤ã‚·ãƒ¼ãƒˆã‚’è¢«ã›ã€ç«¯ã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã§ã—ã£ã‹ã‚Šã¨é–‰ã˜ã‚‹ã€‚<br/>
                                        è¡¨é¢ã«2ã€œ3ã‹æ‰€ã€åŒ…ä¸ã§åˆ‡ã‚Šè¾¼ã¿ã‚’å…¥ã‚Œã¦è’¸æ°—ã®é€ƒã’é“ã‚’ä½œã‚‹ã€‚
                                    </p>
                                </div>

                                <div>
                                    <h4 className="font-bold text-[#2F6B3E] text-xl mb-2">4. ç„¼ã</h4>
                                    <p>
                                        è¡¨é¢ã«åµé»„ã‚’è–„ãå¡—ã‚‹ã€‚<br/>
                                        200â„ƒã«äºˆç†±ã—ãŸã‚ªãƒ¼ãƒ–ãƒ³ã§20åˆ†ç„¼ãã€ç„¼ãè‰²ãŒè¶³ã‚Šãªã„å ´åˆã¯180â„ƒã«ä¸‹ã’ã¦ã•ã‚‰ã«10ã€œ15åˆ†ç„¼ãã€‚<br/>
                                        è¡¨é¢ãŒã“ã‚“ãŒã‚Šè‰²ã¥ãã€ç”˜ã„é¦™ã‚ŠãŒç«‹ã¡ä¸Šã£ã¦ããŸã‚‰å®Œæˆã€‚
                                    </p>
                                </div>
                            </div>

                            <div className="mt-16 bg-[#fffbf0] p-8 rounded-lg border-2 border-dashed border-[#dcdcdc] transform rotate-1">
                                <h4 className="font-bold text-center mb-6 text-[#8A2E2E] text-xl">ç”±åˆ©ã®ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆ</h4>
                                <ul className="list-disc pl-5 space-y-3 text-base text-muted">
                                    <li>ã‚Šã‚“ã”ã¯ç…®ã™ããšã€æ°´åˆ†ã‚’é£›ã°ã—ã¦å†·ã¾ã™ã“ã¨ã§åº•ãŒãƒ™ã‚¿ã¤ã‹ãªã„</li>
                                    <li>åˆ‡ã‚Šè¾¼ã¿ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€ãã‚Œã„ã«è†¨ã‚‰ã¿å‰²ã‚Œã«ãããªã‚‹</li>
                                    <li>ç„¼ãæ™‚é–“ã¯ã‚ªãƒ¼ãƒ–ãƒ³ã«ã‚ˆã£ã¦èª¿æ•´ã™ã‚‹</li>
                                </ul>
                            </div>

                            {/* éš ã—ãƒªãƒ³ã‚¯ï¼šã‚¯ãƒªãƒƒã‚¯ã§F04å–å¾—ã—ã€æ¥æœ¨ãƒšãƒ¼ã‚¸ã¸ */}
                            <div className="mt-20 text-center">
                                <span 
                                    className="text-xs text-gray-300 hover:text-[#8A2E2E] cursor-pointer transition-colors font-sans tracking-widest"
                                    onClick={() => {
                                        if (!flags.F04) {
                                            notifyEvidence('F04', 'ãƒ¬ã‚·ãƒ”ã®å¥¥ã«ã€åˆ¥ã®èª¬æ˜ãŒéš ã•ã‚Œã¦ã„ãŸã€‚');
                                        }
                                        setPage('grafting');
                                    }}
                                >
                                    ç¾å‘³ã—ã„ã‚Šã‚“ã”ã‚’ä½œã‚‹ã«ã¯
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5.7 GRAFTING DETAIL
        const GraftingDetail = ({ setPage }) => {
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            return (
                <div className="min-h-screen pt-32 pb-20 bg-[#111] text-[#ccc] font-serif">
                    <div className="max-w-2xl mx-auto px-6">
                        <button 
                            onClick={() => setPage('recipe')}
                            className="flex items-center text-sm text-[#555] hover:text-[#888] mb-12 transition-colors font-sans"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                            æˆ»ã‚‹
                        </button>

                        <div className="space-y-16 animate-fade-up">
                            <div className="text-center border-b border-[#333] pb-12">
                                <h1 className="text-3xl md:text-4xl font-bold tracking-[0.2em] mb-6 text-[#eee]">æ¥æœ¨ã¨ã¯</h1>
                                <p className="leading-loose text-sm md:text-base">
                                    æ¥æœ¨ï¼ˆã¤ããï¼‰ã¨ã¯ã€ç•°ãªã‚‹2ã¤ã®æ¤ç‰©ã‚’æ¥åˆã—ã€<br/>
                                    1æœ¬ã®æœ¨ã¨ã—ã¦è‚²ã¦ã‚‹æŠ€è¡“ã§ã™ã€‚<br/><br/>
                                    æ ¹ã‚’æŒã¤å´ã‚’<span className="text-[#8A2E2E] font-bold">å°æœ¨ï¼ˆã ã„ãï¼‰</span>ã€<br/>
                                    å®Ÿã‚„æã‚’ã¤ã‘ãŸã„å´ã‚’<span className="text-[#8A2E2E] font-bold">ç©‚æœ¨ï¼ˆã»ãï¼‰</span>ã¨å‘¼ã³ã¾ã™ã€‚
                                </p>
                            </div>

                            <div className="w-full aspect-video bg-[#0a0a0a] border border-[#333] flex items-center justify-center overflow-hidden">
                                <img src={IMAGES.grafting} alt="æ¥æœ¨ã®æ¦‚å¿µå›³" className="w-full h-full object-contain opacity-80" />
                            </div>

                            <div className="space-y-20">
                                <h2 className="text-center text-xl tracking-widest text-[#555]">ä¸€èˆ¬çš„ãªæ¥æœ¨ã®æ‰‹é †</h2>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">1. å°æœ¨ã‚’é¸ã¶</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>å¥åº·ã§ç—…å®³ã®ãªã„ã‚‚ã®ã‚’é¸ã¶</li>
                                        <li>æ¨¹å‹¢ãŒå®‰å®šã—ã¦ã„ã‚‹ã‚‚ã®ãŒæœ›ã¾ã—ã„</li>
                                        <li>è‹¥ã™ããšã€è€åŒ–ã—ã¦ã„ãªã„ã‚‚ã®ãŒè‰¯ã„</li>
                                    </ul>
                                    <p className="text-[#8A2E2E] text-sm">ğŸ‘‰ ã€ŒåœŸå£Œã‚„ç’°å¢ƒã«é©å¿œã—ã¦ã„ã‚‹ã“ã¨ã€ãŒé‡è¦</p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">2. ç©‚æœ¨ã‚’æº–å‚™ã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>ä¼‘çœ æœŸã«æ¡å–ã—ãŸæã‚’ä½¿ç”¨</li>
                                        <li>èŠ½ãŒã—ã£ã‹ã‚Šã—ã¦ã„ã‚‹ã‚‚ã®</li>
                                        <li>å‚·ã‚„å¤‰å½¢ãŒãªã„ã‚‚ã®ã‚’é¸ã¶</li>
                                    </ul>
                                    <p className="text-[#8A2E2E] text-sm">ğŸ‘‰ å°æœ¨ã¨ã®ç›¸æ€§ãŒæˆåŠŸã‚’å·¦å³ã™ã‚‹</p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">3. åˆ‡ã‚Šå£ã‚’æ•´ãˆã‚‹ï¼ˆå‰ªå®šï¼‰</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>å°æœ¨ã¨ç©‚æœ¨ã®åˆ‡ã‚Šå£ã‚’æ¸…æ½”ãªåˆƒç‰©ã§åˆ‡ã‚‹</li>
                                        <li>å½¢æˆå±¤ï¼ˆã‹ãŸã¡ã¥ãã‚‹å±¤ï¼‰ãŒåˆã†ã‚ˆã†ã«ã™ã‚‹</li>
                                        <li>åˆ‡ã‚Šå£ã¯æ‰‹æ—©ãã€è¿·ã„ãªã</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">4. æ¥åˆã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>å°æœ¨ã¨ç©‚æœ¨ã®åˆ‡ã‚Šå£ã‚’ã´ã£ãŸã‚Šåˆã‚ã›ã‚‹</li>
                                        <li>ç©ºæ°—ãŒå…¥ã‚‰ãªã„ã‚ˆã†æ³¨æ„ã™ã‚‹</li>
                                        <li>ä½ç½®ãŒãšã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">5. å›ºå®šã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>ãƒ†ãƒ¼ãƒ—ã‚„ç´ã§ã—ã£ã‹ã‚Šå›ºå®šã™ã‚‹</li>
                                        <li>å‹•ã‹ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒé‡è¦</li>
                                        <li>å¼·ã™ããšã€å¼±ã™ããš</li>
                                    </ul>
                                    <p className="text-[#8A2E2E] text-sm">ğŸ‘‰ å‹•ãã¨ç™’åˆãŒã†ã¾ãé€²ã¾ãªã„</p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">6. ä¿è­·ã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>ä¹¾ç‡¥ã‚’é˜²ããŸã‚ã€æ¥åˆéƒ¨ã‚’è¦†ã†</li>
                                        <li>ç›´å°„æ—¥å…‰ã‚„é¢¨ã‚’é¿ã‘ã‚‹</li>
                                        <li>å¤–éƒ¨åˆºæ¿€ã‚’ã§ãã‚‹ã ã‘æ¸›ã‚‰ã™</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">7. å¾…ã¤ï¼ˆé¤Šç”ŸæœŸé–“ï¼‰</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>æ•°é€±é–“ã€œæ•°ãƒ¶æœˆã€æ§˜å­ã‚’è¦‹ã‚‹</li>
                                        <li>ã“ã®é–“ã€ç„¡ç†ã«è§¦ã‚‰ãªã„</li>
                                        <li>æˆåŠŸã™ã‚‹ã¨æ–°ã—ã„èŠ½ãŒå‹•ãå‡ºã™</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">8. ä½™åˆ†ãªéƒ¨åˆ†ã‚’å‰ªå®šã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>å°æœ¨ã‹ã‚‰å‡ºã‚‹ä¸è¦ãªèŠ½ã‚’è½ã¨ã™</li>
                                        <li>ç©‚æœ¨ã«æ „é¤ŠãŒé›†ä¸­ã™ã‚‹ã‚ˆã†èª¿æ•´</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-[#eee] mb-4 border-l-2 border-[#8A2E2E] pl-4">9. æ´»ç€ã‚’ç¢ºèªã™ã‚‹</h3>
                                    <ul className="list-disc pl-5 space-y-2 text-sm text-[#aaa] mb-4">
                                        <li>ç©‚æœ¨ãŒæ¯ã‚Œãšã€æˆé•·ã—ã¦ã„ã‚‹ã‹</li>
                                        <li>å•é¡ŒãŒã‚ã‚Œã°ã‚„ã‚Šç›´ã™ã“ã¨ã‚‚ã‚ã‚‹</li>
                                    </ul>
                                </section>
                            </div>

                            <div className="pt-20 pb-12 text-center">
                                <p className="text-[#333] text-xs tracking-[0.5em]">KAMI NO MEGUMI</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5.8 ANCIENT DOCUMENT (Hidden Page)
        const AncientDocument = ({ setPage }) => {
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            return (
                <div className="min-h-screen pt-32 pb-20 bg-[#333] text-white font-serif">
                    <div className="max-w-2xl mx-auto px-6">
                        <button 
                            onClick={() => setPage('diary')}
                            className="flex items-center text-sm text-gray-300 hover:text-white mb-16 transition-colors font-sans"
                        >
                            <i data-lucide="arrow-left" className="w-4 h-4 mr-2"></i>
                            æˆ»ã‚‹
                        </button>

                        <div className="animate-fade-up">
                            <div className="mb-16 border-4 border-double border-[#555] p-2 bg-[#222]">
                                <img src={IMAGES.blog_oldbook} alt="å¤ã„æ‰‹è¨˜" className="w-full h-auto opacity-90 filter sepia-[0.2] contrast-110" />
                            </div>

                            <div className="space-y-12 leading-loose tracking-widest text-justify text-gray-100" style={{ fontFeatureSettings: '"palt"' }}>
                                <div className="text-center mb-16 border-b border-[#555] pb-8">
                                    <p className="text-sm text-gray-400 mb-2">æ–‡æ”¿ä¹å¹´ï¼ˆè¥¿æš¦ä¸€å…«äºŒå…­å¹´ï¼‰</p>
                                    <h1 className="text-3xl font-bold text-[#ff5555]">å¥¥ç¥ä¼æ‘ æ—§è¨˜æŠœç²‹</h1>
                                </div>

                                <p className="text-xs text-gray-400">
                                    â€»æœ¬ç¨¿ã¯ã€å¥¥ç¥ä¼æ‘ã«ä¼ã‚ã‚‹å¤ã„å¸³é¢ã‚’ã‚‚ã¨ã«ã€åˆ¤èª­å¯èƒ½ãªç¯„å›²ã‚’ç¾ä»£èªã«ç½®ãèµ·ã“ã—ãŸè¨˜éŒ²ã§ã‚ã‚‹ã€‚
                                </p>

                                <section>
                                    <h2 className="text-xl text-[#ff5555] mb-6 font-bold border-l-4 border-[#ff5555] pl-4">æ–‡æ”¿ä¹å¹´ã€å±±ã®å¥¥ã«ã¦</h2>
                                    <p>
                                        ä»Šå¹´ã‚‚å®Ÿã‚Šã®ãŸã‚ã®<strong className="text-white border-b border-[#ff5555]">æ¥æ‰‹ï¼ˆã¤ãã¦ï¼‰</strong>ã‚’åŸ·ã‚Šè¡Œã†ã“ã¨ã¨ãªã£ãŸã€‚
                                    </p>
                                    <p className="mt-6">
                                        ã“ã®åœ°ã¯ç—©ã›ã€ãŸã æã‚’æŒ¿ã™ã®ã¿ã§ã¯æ ¹ä»˜ã‹ã¬ã€‚<br/>
                                        ã‚†ãˆã«ã€å¤ãã‚ˆã‚Š<strong className="text-white">å™¨ï¼ˆã†ã¤ã‚ï¼‰ã‚’é¸ã³ã€ãã‚Œã‚’å°ï¼ˆã ã„ï¼‰</strong>ã¨ã—ã¦ç”¨ã„ã‚‹ç¿’ã‚ã—ãŒç¶šã„ã¦ã„ã‚‹ã€‚
                                    </p>
                                    <p className="mt-6">
                                        å™¨ã¯è‹¥ãã€å‚·ãªãã€ä½™åˆ†ãªè¡€ã®æ··ã˜ã‚‰ã¬ã‚‚ã®ãŒè‰¯ã„ã¨ã•ã‚ŒãŸã€‚
                                    </p>
                                </section>

                                <section>
                                    <h2 className="text-xl text-[#ff5555] mb-6 font-bold border-l-4 border-[#ff5555] pl-4">å™¨ã®é¸å®šã«ã¤ã„ã¦</h2>
                                    <p>æ¥æ‰‹ã«ç”¨ã„ã‚‹å™¨ã¯ã€</p>
                                    <ul className="list-none pl-4 space-y-2 my-4 text-gray-200">
                                        <li>ãƒ»ç—…ã‚’æŒãŸãš</li>
                                        <li>ãƒ»å®¶æ—ã®ç¸ãŒè–„ã</li>
                                        <li>ãƒ»é€ƒã’é“ã‚’æŒãŸã¬è€…</li>
                                    </ul>
                                    <p>ãŒè‰¯ã„ã¨è¨˜ã•ã‚Œã¦ã„ã‚‹ã€‚</p>
                                    <p className="mt-6">
                                        æ‘ã®å¤–ã‚ˆã‚Šæ¥ãŸè€…ã¯ã€<br/>
                                        åœŸåœ°ã«é¦´æŸ“ã¿ã‚„ã™ãã€æ‹’ã¿ã‚‚å°‘ãªã„ãŸã‚ã€<br/>
                                        æ ¹ä»˜ããŒè‰¯ã„ã¨ã•ã‚Œã¦ã„ãŸã€‚
                                    </p>
                                    <p className="mt-6">
                                        å™¨ã¯äº‹å‰ã«èº«ä½“ã®å…·åˆã‚’æ”¹ã‚ã€<br/>
                                        è¡€ã®å·¡ã‚Šã€éª¨ã®å¼·ã•ã€<br/>
                                        çœ ã‚Šã®æ·±ã•ãªã©ã‚’ç¢ºã‹ã‚ãŸã€‚
                                    </p>
                                    <p className="mt-6">
                                        ã“ã‚Œã‚’<strong className="text-white border-b border-[#ff5555]">æ¤œã‚ï¼ˆã‚ã‚‰ãŸã‚ï¼‰</strong>ã¨å‘¼ã¶ã€‚
                                    </p>
                                </section>

                                <section>
                                    <h2 className="text-xl text-[#ff5555] mb-6 font-bold border-l-4 border-[#ff5555] pl-4">ä¼ã›ã®ä½œæ³•</h2>
                                    <p>
                                        å™¨ã¯ã€ç©´ã®ä¸­ã«ã¦<br/>
                                        ä¼ã›ã®å§¿å‹¢ã‚’å–ã‚‰ã›ã‚‹ã€‚
                                    </p>
                                    <p className="mt-6">
                                        é ­ã‚’å‚ã‚Œã€<br/>
                                        èƒŒã‚’ä¸¸ã‚ã€<br/>
                                        ä½™è¨ˆãªå‹•ããŒå‡ºã¬ã‚ˆã†ã€<br/>
                                        åœŸã¨æœ¨æ ã«ã¦å›ºå®šã™ã‚‹ã€‚
                                    </p>
                                    <p className="mt-6">
                                        å‹•ã‘ã°æ­ªã¿ã€<br/>
                                        æ­ªã‚ã°æãŒæ¯ã‚Œã‚‹ã€‚
                                    </p>
                                    <p className="mt-6 font-bold text-white">
                                        ã‚ˆã£ã¦ã€å‹•ã‹ã¬ã“ã¨ãŒä½•ã‚ˆã‚Šã®å‹™ã‚ã§ã‚ã‚‹ã€‚
                                    </p>
                                </section>

                                <section>
                                    <h2 className="text-xl text-[#ff5555] mb-6 font-bold border-l-4 border-[#ff5555] pl-4">æã®æŒ¿ã—æ–¹</h2>
                                    <p>
                                        èƒŒã®ä¸­å¤®ã«æ²¿ã„ã€<br/>
                                        åˆƒã‚’å…¥ã‚Œã€<br/>
                                        çš®ã‚’åˆ†ã‘ã€<br/>
                                        ãã“ã¸æã‚’æŒ¿ã™ã€‚
                                    </p>
                                    <p className="mt-6">
                                        æã¯è‹¥ãã€èµ¤ã¿ã®ã‚ã‚‹ã‚‚ã®ãŒè‰¯ã„ã€‚
                                    </p>
                                    <p className="mt-6">
                                        æŒ¿ã—ãŸå¾Œã¯ã€<br/>
                                        èŒåºŠã¨åœŸã‚’é‡ã­ã€<br/>
                                        æ°´ã‚’ä¸ãˆã€<br/>
                                        æœˆã®æº€ã¡æ¬ ã‘ã‚’è¦‹ã¦è¦†ã„ã‚’æ–½ã™ã€‚
                                    </p>
                                    <p className="mt-6 text-[#ff8888]">
                                        ã“ã®é–“ã€å™¨ã¯å£°ã‚’ç«‹ã¦ã¦ã¯ãªã‚‰ã¬ã€‚
                                    </p>
                                </section>

                                <section>
                                    <h2 className="text-xl text-[#ff5555] mb-6 font-bold border-l-4 border-[#ff5555] pl-4">æˆã‚Šæœ¨ï¼ˆãªã‚Šãï¼‰ã«ã¤ã„ã¦</h2>
                                    <p>
                                        å­£ã‚’è¶Šãˆã€<br/>
                                        æãŒä¼¸ã³ã€<br/>
                                        èŠ±ãŒå’²ãã€<br/>
                                        å®ŸãŒçµã°ã‚ŒãŸã‚‚ã®ã‚’<br/>
                                        æˆã‚Šæœ¨ã¨å‘¼ã¶ã€‚
                                    </p>
                                    <p className="mt-6">
                                        æˆã‚Šæœ¨ã¯å‹•ã‹ãšã€<br/>
                                        èªã‚‰ãšã€<br/>
                                        ãŸã å®Ÿã‚Šã‚’è¿”ã™ã€‚
                                    </p>
                                    <p className="mt-6">
                                        ã“ã®å®Ÿã¯æœ±ï¼ˆã‚ã‹ï¼‰ãã€<br/>
                                        ç”˜ã¿ãŒå¼·ãã€<br/>
                                        è…¹ã«æ·±ãæŸ“ã¿ã‚‹ã€‚
                                    </p>
                                    <p className="mt-6">
                                        æ‘ã§ã¯ã“ã‚Œã‚’<br/>
                                        <strong className="text-2xl text-red-500 block my-4 text-center">æœ±å®Ÿï¼ˆã‚ã‘ã¿ï¼‰</strong>
                                        ã¨åä»˜ã‘ã€<br/>
                                        ç‰¹åˆ¥ãªæŠ˜ã«ã®ã¿å£ã«ã—ãŸã€‚
                                    </p>
                                </section>

                                <div className="border-t border-[#555] pt-12 mt-16 text-center text-sm text-gray-300">
                                    <p className="mb-8 font-bold text-gray-400">è¨˜ã™ã¹ãã“ã¨</p>
                                    <p className="mb-4">
                                        ã“ã®ä½œæ³•ã¯ã€<br/>
                                        ç¥ã«æ§ã’ã‚‹ã‚‚ã®ã§ã¯ãªãã€<br/>
                                        æ‘ã‚’ç¶šã‹ã›ã‚‹ãŸã‚ã®çŸ¥æµã§ã‚ã‚‹ã€‚
                                    </p>
                                    <p className="mb-4">
                                        å¤±ã‚ã‚Œã‚Œã°ã€<br/>
                                        å±±ã¯æ¯ã‚Œã€<br/>
                                        äººã¯é›¢ã‚Œã€<br/>
                                        æ‘ã¯çµ‚ã‚ã‚‹ã€‚
                                    </p>
                                    <p className="mb-8">
                                        ã‚†ãˆã«ã€<br/>
                                        ã“ã®è¨˜ã¯å¤–ã¸å‡ºã—ã¦ã¯ãªã‚‰ã¬ã€‚
                                    </p>
                                    <p className="text-lg text-[#ff5555] font-bold">
                                        èª­ã‚“ã è€…ã¯ã€<br/>
                                        ç†è§£ã—ã€<br/>
                                        å£ã‚’é–‰ã–ã—ã€<br/>
                                        å¿˜ã‚Œã‚‹ã“ã¨ã€‚
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 6. ACCESS (Table & Image)
        const Access = ({ phase, notifyEvidence, flags }) => {
            const [modalImage, setModalImage] = useState(null);

            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
                        <SectionTitle title="ã‚¢ã‚¯ã‚»ã‚¹" sub="ACCESS" />
                        
                        <div className="bg-surface rounded-2xl p-8 md:p-12 shadow-sm mb-12">
                            <div className="aspect-video w-full bg-surface-2 rounded-xl mb-8 overflow-hidden relative">
                                <img src={IMAGES.access_map} className="w-full h-full object-cover" alt="map" />
                                <div className="absolute inset-0 flex items-center justify-center bg-black/10">
                                    <span className="bg-white px-4 py-2 font-eng text-sm tracking-widest shadow">OKUKAMIFUSHI MAP</span>
                                </div>
                            </div>

                            <div className="grid md:grid-cols-2 gap-12">
                                <div>
                                    <h3 className="text-xl font-serif font-bold mb-6">ãŠè»Šã§ãŠè¶Šã—ã®å ´åˆ</h3>
                                    <table className="w-full text-sm text-left">
                                        <tbody>
                                            <tr className="border-b border-border">
                                                <th className="py-4 font-normal text-muted">é•·é‡ICã‚ˆã‚Š</th>
                                                <td className="py-4">çœŒé“00å·ç·šã‚’å—ã¸ ç´„90åˆ†</td>
                                            </tr>
                                            <tr className="border-b border-border">
                                                <th className="py-4 font-normal text-muted">é§è»Šå ´</th>
                                                <td className="py-4">ã‚ã‚Šï¼ˆè¦äºˆç´„ï¼‰</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div className="flex flex-col justify-center items-start">
                                    <p className="text-sm text-muted mb-6 leading-relaxed">
                                        è©³ç´°ãªä½æ‰€ã¯ã€ã”äºˆç´„ç¢ºå®šå¾Œã«ãƒ¡ãƒ¼ãƒ«ã«ã¦ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚<br/>
                                        å±±é“ãŒç¶šãã¾ã™ã®ã§ã€ãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã€‚
                                    </p>

                                    {/* Phase2ä»¥é™ã§ãƒªãƒ³ã‚¯å‡ºç¾ï¼ˆF11æ¢ç´¢å¯èƒ½ï¼‰ */}
                                    {phase >= 2 && (
                                        <p 
                                            className="mt-4 text-xs text-[#8A2E2E] cursor-pointer hover:underline tracking-widest font-serif opacity-70 hover:opacity-100 transition-opacity"
                                            onClick={() => {
                                                setModalImage(IMAGES.top_change_village);
                                                if (!flags.F11) {
                                                    notifyEvidence('F11', 'åœ°å›³ã®ã¯ãšãªã®ã«ã€ä½•ã‹ãŒæ˜ ã£ã¦ã„ã‚‹â€¦ã€‚', { mode: "toast" });
                                                }
                                            }}
                                        >
                                            æ‘ã«å…¥ã‚‹ã¨ã€æ‘ã³ã¨ã¯ã‚ãªãŸã‚’ãšã£ã¨è¦‹ã¦ã„ã‚‹â€¦
                                        </p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Image Modal */}
                    {modalImage && (
                        <div 
                            className="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4 cursor-pointer"
                            onClick={() => setModalImage(null)}
                        >
                            <div className="max-w-4xl w-full">
                                <img 
                                    src={modalImage} 
                                    alt="Hidden Message" 
                                    className="w-full h-auto shadow-2xl rounded animate-pulse-slow brightness-150 contrast-125" 
                                />
                                <p className="text-center text-white mt-4 text-sm font-serif">ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‰ã˜ã‚‹</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- CONTINUES IN PART 4 ---
        // 7. RECRUIT (Timeline & Checkbox)  â€»å…ƒä»•æ§˜ï¼šãƒã‚§ãƒƒã‚¯é …ç›®å†…ã®æ–‡å­—ãŒå¤‰åŒ–
        const Recruit = ({ phase, notifyEvidence, flags }) => {
          const [checks, setChecks] = useState({});
          const [horrorStates, setHorrorStates] = useState({});
          const [globalHorror, setGlobalHorror] = useState(false);
        
          const recruitItems = [
            { id: 'farm_love', label: 'è¾²ä½œæ¥­ãŒå¥½ãï¼æ—¥æœ¬ã®è¾²æ¥­ã«èˆˆå‘³ãŒã‚ã‚‹ï¼' },
            { id: 'morning', label: 'æœãŒå¾—æ„ï¼' },
            { id: 'group_life', label: 'ã¿ã‚“ãªã§ã®å…±åŒç”Ÿæ´»ã‚’æ¥½ã—ã‚ã‚‹ï¼' },
            { id: 'learn_jp', label: 'æ—¥æœ¬èªã‚’å­¦ã‚“ã§ã¿ãŸã„ï¼' },
            { id: 'stay_jp', label: 'æ—¥æœ¬ã§ã®æ»åœ¨ã‚’æ¥½ã—ã‚ã‚‹ï¼', horror: 'ãƒ‹ã‚²ãƒ©ãƒ¬ãƒŠã‚¤â€¦' },
            { id: 'nature_life', label: 'è‡ªç„¶ãŒå¤šã„æš®ã‚‰ã—ã«æ†§ã‚Œã‚‹ï¼' },
            { id: 'like_fruit', label: 'æœç‰©ã‚„é‡èœãŒå¥½ãï¼', horror: 'ã‚¤ã‚±ãƒ‹ã‚¨ã‚µãƒ¬ãƒ«â€¦' },
            { id: 'health', label: 'å¥åº·ãŒã¨ã‚Šãˆã ï¼' },
            { id: 'alone', label: 'ä¸€äººæš®ã‚‰ã—ã‚‚ã¸ã£ã¡ã‚ƒã‚‰ã ï¼' },
            { id: 'work_here', label: 'å¥¥ç¥ä¼æ‘ã§åƒããŸã„ï¼', horror: 'ã‚¯ãƒ«ãƒŠâ€¦ï¼ï¼ï¼ï¼ï¼ï¼' },
          ];
        
          const heroImage = (phase >= 2) ? IMAGES.recruiting_change : IMAGES.recruiting;
        
          const handleCheck = (item) => {
            const isChecked = !checks[item.id];
            setChecks(prev => ({ ...prev, [item.id]: isChecked }));
        
            // Phase2ä»¥é™ã§ã®ã¿ãƒ›ãƒ©ãƒ¼æ¼”å‡ºï¼ˆF05ï¼‰
            if (phase >= 2 && isChecked && item.horror) {
              setHorrorStates(prev => ({ ...prev, [item.id]: true }));
              setGlobalHorror(true);
        
              setTimeout(() => {
                setGlobalHorror(false);
                setHorrorStates(prev => ({ ...prev, [item.id]: false }));
        
                if (!flags.F05) {
                  notifyEvidence('F05', 'ãƒã‚§ãƒƒã‚¯é …ç›®ã®æ–‡å­—ãŒä¸€ç¬å¤‰åŒ–ã—ãŸã€‚\nã€Œãƒ‹ã‚²ãƒ©ãƒ¬ãƒŠã‚¤ã€ã€Œã‚¤ã‚±ãƒ‹ã‚¨ã€...\nã“ã‚Œã¯å‹Ÿé›†ã§ã¯ãªãã€é¸åˆ¥ã ã€‚');
                }
              }, 600);
            }
          };
        
          return (
            <div className="min-h-screen pt-24 pb-20 bg-surface-2 relative">
              {/* ãƒ›ãƒ©ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆPhase2ä»¥é™ã®æ¼”å‡ºæ™‚ã®ã¿ï¼‰ */}
              {phase >= 2 && globalHorror && (
                <>
                  <div className="horror-overlay"></div>
                  <div className="horror-vignette"></div>
                  <img
                    src={IMAGES.staff_victim}
                    className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full h-full object-cover opacity-10 mix-blend-overlay z-[9998] pointer-events-none animate-pulse"
                    alt="overlay"
                  />
                </>
              )}
        
              <div className={`max-w-container mx-auto px-6 relative transition-all duration-100 ${globalHorror ? 'z-[10000]' : 'z-10'}`}>
                <SectionTitle title="æ¡ç”¨æƒ…å ±" sub="RECRUIT" />
        
                <div className="grid md:grid-cols-2 gap-12 mb-20">
                  <div>
                    <img
                      src={heroImage}
                      alt="Recruiting"
                      className={`w-full h-full object-cover rounded-2xl shadow-lg transition-all duration-100 ${
                        globalHorror ? 'grayscale contrast-150 brightness-50' : ''
                      }`}
                    />
                  </div>
                  <div className={`flex flex-col justify-center transition-opacity duration-100 ${globalHorror ? 'opacity-20' : 'opacity-100'}`}>
                    <h3 className="text-2xl font-serif mb-6">æµ·å¤–æŠ€èƒ½å®Ÿç¿’ç”Ÿ å‹Ÿé›†ä¸­</h3>
                    <p className="leading-loose text-muted mb-8">
                      æ—¥æœ¬ã®ä¼çµ±çš„ãªè¾²æ¥­æŠ€è¡“ã‚’å­¦ã³ã¾ã›ã‚“ã‹ï¼Ÿ<br/>
                      ç§ãŸã¡ã¯ã€ä¸–ç•Œä¸­ã‹ã‚‰æ„æ¬²ã‚ã‚‹è‹¥è€…ã‚’å—ã‘å…¥ã‚Œã¦ã„ã¾ã™ã€‚<br/>
                      è‡ªç„¶è±Šã‹ãªç’°å¢ƒã§ã€å…±ã«æ±—ã‚’æµã—ã€çµ†ã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚
                    </p>
                    <ul className="space-y-4 text-sm">
                      <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> å¯®å®Œå‚™ãƒ»é£Ÿäº‹ä»˜ã</li>
                      <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> æ—¥æœ¬èªå­¦ç¿’ã‚µãƒãƒ¼ãƒˆã‚ã‚Š</li>
                      <li className="flex items-center gap-3"><i data-lucide="check" className="text-primary w-5"></i> ã‚¢ãƒƒãƒˆãƒ›ãƒ¼ãƒ ãªè·å ´</li>
                    </ul>
                  </div>
                </div>
        
                {/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼šæ–‡å­—ãŒå¤‰ã‚ã‚‹ï¼ˆå…ƒä»•æ§˜ï¼‰ */}
                <div className={`bg-surface p-8 md:p-12 rounded-2xl max-w-3xl mx-auto shadow-sm transition-all duration-100 ${
                  globalHorror
                    ? 'relative z-[10000] bg-black border-4 border-red-900 shadow-[0_0_50px_rgba(255,0,0,0.5)] transform scale-105'
                    : ''
                }`}>
                  <h4 className={`font-bold font-serif text-xl mb-8 text-center ${globalHorror ? 'text-red-600 animate-pulse' : 'text-primary'}`}>
                    {globalHorror ? "é€ƒã‚²ãƒ©ãƒ¬ãƒŠã‚¤â€¦é€ƒã‚²ãƒ©ãƒ¬ãƒŠã‚¤â€¦" : "ã“ã‚“ãªã‚ãªãŸã‚’å‹Ÿé›†ä¸­ï¼"}
                  </h4>
        
                  <div className="space-y-4">
                    {recruitItems.map((item) => (
                      <label
                        key={item.id}
                        className={`flex items-center gap-4 p-4 border rounded-lg cursor-pointer transition-all duration-100 ${
                          horrorStates[item.id]
                            ? 'bg-black/80 border-red-600 shadow-inner'
                            : (checks[item.id] ? 'bg-primary/5 border-primary' : 'bg-white border-border hover:bg-surface-2')
                        }`}
                      >
                        <input
                          type="checkbox"
                          checked={!!checks[item.id]}
                          onChange={() => handleCheck(item)}
                          className={`w-5 h-5 shrink-0 transition-all ${horrorStates[item.id] ? 'distorted-checkbox' : 'accent-primary'}`}
                        />
                        <span className={`text-sm font-medium transition-colors duration-100 ${
                          horrorStates[item.id] ? 'intense-glitch' : 'text-text'
                        }`}>
                          {horrorStates[item.id] ? item.horror : item.label}
                        </span>
                      </label>
                    ))}
                  </div>
        
                  <p className={`text-xs text-center mt-8 ${globalHorror ? 'text-red-800 font-bold' : 'text-muted'}`}>
                    {globalHorror ? "â€»ç”Ÿãã¦å¸°ã‚Œã‚‹ä¿è¨¼ã¯ã‚ã‚Šã¾ã›ã‚“" : "â€»ä¸€ã¤ã§ã‚‚å½“ã¦ã¯ã¾ã‚‹æ–¹ã¯ã€ãœã²ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"}
                  </p>
                </div>
              </div>
            </div>
          );
        };
        // 8. CONTACT (Form Hijack)
        const Contact = ({ phase, notifyEvidence, flags, setPage }) => {
            // é€šå¸¸æ™‚ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
            const defaultPlaceholders = {
                name: 'å±±ç”° å¤ªéƒ',
                email: 'example@email.com',
                address: 'ä»»æ„',
                message: 'ã”è³ªå•ã‚’ã”è¨˜å…¥ãã ã•ã„â€¦'
            };
            
            // ãƒ›ãƒ©ãƒ¼æ™‚ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
            const horrorPlaceholders = {
                name: 'ãƒ´ãƒ¼ãƒ»ã‚¿ã‚¤ãƒ³ãƒ»ã‚¢ãƒ³',
                email: 'ã‚‚ã†ã„ãªã„',
                address: 'ä¿ºã‚‚é€ƒã’ã‚‰ã‚Œãªã„',
                message: 'åŠ©ã‘ã¦'
            };

            const [placeholders, setPlaceholders] = useState(defaultPlaceholders);
            const [seenCount, setSeenCount] = useState({ name: false, email: false, address: false, message: false });
            const [modalState, setModalState] = useState({ isOpen: false, message: "", isHorror: false, goAdmin: false });

            // Phase1ã®æ®µéšã§ã‚‚ãƒ•ã‚©ãƒ¼ãƒ ã¯å­˜åœ¨ã™ã‚‹ãŒã€ä¹—ã£å–ã‚Šæ¼”å‡ºã¯ã€ŒPhase1å†…ã®F12æ¢ç´¢ã€ã¨ã—ã¦é‹ç”¨
            // ï¼ã“ã®å®Ÿè£…ã§ã¯ Phase1ã§ã‚‚æ¼”å‡ºãŒèµ·ãã‚‹ï¼ˆãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è§¦ã‚Œãªã„é™ã‚Šèµ·ããªã„ï¼‰
            const triggerHorror = (field) => {
                // æœ€ä½Phase1ã‹ã‚‰ç™ºå‹•ï¼ˆä»•æ§˜ã©ãŠã‚Šï¼‰
                if (phase < 1) return;

                setPlaceholders(prev => ({ ...prev, [field]: horrorPlaceholders[field] }));
                setSeenCount(prev => ({ ...prev, [field]: true }));

                const duration = Math.random() * 300 + 200;
                setTimeout(() => {
                    setPlaceholders(prev => ({ ...prev, [field]: defaultPlaceholders[field] }));
                }, duration);
            };

            const allSeen = Object.values(seenCount).every(v => v);

            const handleSubmit = (e) => {
              e.preventDefault();
            
                if (allSeen) {
                // F12å›åï¼ˆå•ã„åˆã‚ã›ä¹—ã£å–ã‚Šï¼‰
                if (!flags.F12) {
                  notifyEvidence('F12', 'ãƒ•ã‚©ãƒ¼ãƒ ãŒå®Œå…¨ã«ä¹—ã£å–ã‚‰ã‚Œã¦ã„ã‚‹ã€‚', { mode: "silent" });
                }
            
                // é€šå ±ã¯ç®¡ç†äººãƒšãƒ¼ã‚¸ï¼ˆadmin_noticeï¼‰ã§è¡Œã†
                setModalState({
                  isOpen: true,
                  message: "ã€F12: å•ã„åˆã‚ã›ã®ä¹—ã£å–ã‚Šã€‘\nãƒ•ã‚©ãƒ¼ãƒ ãŒå®Œå…¨ã«ä¹—ã£å–ã‚‰ã‚Œã¦ã„ã‚‹ã€‚\n\nè¨¼æ‹ ã«æ°—ã¥ã„ãŸã‹ï¼Ÿ\næœ€å¾Œã¯ã€ç®¡ç†äººã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ï¼ˆé–¢ä¿‚è€…å„ä½ï¼‰ã€ã«ã‚ã‚‹ã€‚",
                  isHorror: true,
                  goAdmin: true
                });
              } else {
                setModalState({
                  isOpen: true,
                  message: "ç¾åœ¨å•ã„åˆã‚ã›ãŒæ··é›‘ã—ã¦ã„ã¾ã™ã€‚\nã”è¿·æƒ‘ã‚’ãŠã‹ã‘ã—ã¦ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚",
                  isHorror: false,
                  goAdmin: false
                });
              }
            };
            
            return (
                <div className="min-h-screen pt-24 pb-20">
                    <div className="max-w-container mx-auto px-6">
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<SectionTitle title="ãŠå•ã„åˆã‚ã›" sub="CONTACT" />
                        <div className="max-w-3xl mx-auto grid md:grid-cols-3 gap-12">
                            <div className="md:col-span-2">
                                <form className="space-y-8" onSubmit={handleSubmit}>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">ãŠåå‰ <span className="text-accent">*</span></label>
                                        <input 
                                            type="text" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-lg placeholder-gray-400"
                                            placeholder={placeholders.name}
                                            onFocus={() => triggerHorror('name')}
                                            onMouseEnter={() => triggerHorror('name')}
                                        />
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span className="text-accent">*</span></label>
                                        <input 
                                            type="email" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-lg placeholder-gray-400"
                                            placeholder={placeholders.email}
                                            onFocus={() => triggerHorror('email')}
                                            onMouseEnter={() => triggerHorror('email')}
                                        />
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">ä½æ‰€</label>
                                        <input 
                                            type="text" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-lg placeholder-gray-400"
                                            placeholder={placeholders.address}
                                            onFocus={() => triggerHorror('address')}
                                            onMouseEnter={() => triggerHorror('address')}
                                        />
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-muted tracking-wider">
                                            ãŠå•ã„åˆã‚ã›å†…å®¹ <span className="text-accent">*</span>
                                        </label>
                                        <textarea 
                                            rows="5" 
                                            className="w-full border-b border-border bg-transparent py-2 outline-none focus:border-primary transition-colors text-base resize-none placeholder-gray-400"
                                            placeholder={placeholders.message}
                                            onFocus={() => triggerHorror('message')}
                                            onMouseEnter={() => triggerHorror('message')}
                                        ></textarea>
                                    </div>

                                <button
                                type="submit"
                                className={`w-full py-4 rounded-full transition-all duration-500 font-medium tracking-wide text-sm shadow-lg hover:shadow-xl ${
                                allSeen
                                ? 'bg-black text-white hover:bg-gray-900 border-none'
                                : 'bg-white text-black border border-text hover:bg-gray-100'
                                }`}
                                >
                                é€ä¿¡ã™ã‚‹
                                </button>
                                </form>
                            </div>

                            <div className="md:col-span-1 border-l border-border pl-8 hidden md:block">
                                <h4 className="font-bold font-serif mb-6">ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›</h4>
                                <p className="text-2xl font-eng mb-2">026-000-0000</p>
                                <p className="text-xs text-muted mb-8">å—ä»˜æ™‚é–“: 9:00 - 17:00 (åœŸæ—¥ç¥é™¤ã)</p>
                                
                                <h4 className="font-bold font-serif mb-4">ã‚ˆãã‚ã‚‹ã”è³ªå•</h4>
                                <ul className="text-sm text-muted space-y-3">
                                    <li className="hover:text-primary cursor-pointer">ãƒ» äºˆç´„ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«ã¤ã„ã¦</li>
                                    <li className="hover:text-primary cursor-pointer">ãƒ» ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦</li>
                                    <li className="hover:text-primary cursor-pointer">ãƒ» ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œã«ã¤ã„ã¦</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                <MessageModal 
                  isOpen={modalState.isOpen} 
                  message={modalState.message} 
                  isHorror={modalState.isHorror}
                  onClose={() => {
                    const go = modalState.goAdmin;
                    setModalState({ ...modalState, isOpen: false, goAdmin: false });
                    if (go) setPage('admin_notice');
                  }} 
                />
                </div>
            );
        };

        const EndingPage = ({ endingResult, flags, onRestart, onShare, onKeepProgress }) => {
            useEffect(() => {
                window.scrollTo(0, 0);
            }, []);

            if (!endingResult) {
                return (
                    <div className="min-h-screen pt-24 pb-20 bg-surface">
                        <div className="max-w-2xl mx-auto px-6 text-center">
                            <h2 className="text-2xl font-serif mb-6">ENDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>
                            <p className="text-muted mb-8">é€šå ±ã‚’è¡Œã†ã“ã¨ã§ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã«åˆ°é”ã—ã¾ã™ã€‚</p>
                            <Button onClick={onKeepProgress}>HOMEã¸æˆ»ã‚‹</Button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pt-24 pb-20 bg-surface">
                    <div className="max-w-4xl mx-auto px-6">
                        <div className="text-center mb-10">
                            <p className="text-accent font-eng tracking-[0.4em] text-xs mb-3">ENDING</p>
                            <h1 className="text-4xl md:text-5xl font-serif font-bold mb-3">{endingResult.title}</h1>
                            <p className="text-muted text-sm md:text-base">{endingResult.subtitle}</p>
                        </div>

                        <div className="rounded-2xl overflow-hidden shadow-xl mb-10">
                            <img src={endingResult.image} alt={endingResult.title} className="w-full h-[320px] md:h-[420px] object-cover" />
                        </div>

                        <div className="space-y-6 text-sm md:text-base leading-loose font-serif mb-10">
                            {endingResult.story.map((paragraph, index) => (
                                <p key={index}>{paragraph}</p>
                            ))}
                        </div>

                        <div className="bg-surface-2 border border-border rounded-2xl p-6 md:p-8 mb-10">
                            <h2 className="text-lg font-serif font-bold mb-4">ã‚¹ã‚³ã‚¢</h2>
                            <div className="grid md:grid-cols-2 gap-4 text-sm">
                                <div className="flex items-center justify-between border-b border-border pb-2">
                                    <span className="text-muted">è¨¼æ‹ æ•°</span>
                                    <span className="font-bold">{endingResult.evidenceCount}/{EVIDENCE_FLAGS.length}</span>
                                </div>
                                <div className="flex items-center justify-between border-b border-border pb-2">
                                    <span className="text-muted">é‡è¦è¨¼æ‹ </span>
                                    <span className="font-bold">{endingResult.keyCount}/{KEY_EVIDENCE_FLAGS.length}</span>
                                </div>
                            </div>
                        </div>

                        <div className="mb-12">
                            <h2 className="text-lg font-serif font-bold mb-4">é”æˆãƒ•ãƒ©ã‚°ä¸€è¦§</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                {FLAG_META_ORDER.map((id) => {
                                    const isFound = !!flags[id];
                                    return (
                                        <div
                                            key={id}
                                            className={`px-4 py-3 rounded-lg border text-sm ${
                                                isFound ? 'bg-white border-border text-text' : 'bg-surface-2 border-dashed border-border text-muted'
                                            }`}
                                        >
                                            {isFound ? `${id}: ${FLAG_META[id]?.title ?? ''}` : `${id}: ???`}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="flex flex-col md:flex-row gap-4 justify-center">
                            <Button className="px-8" onClick={onRestart}>
                                æœ€åˆã«æˆ»ã‚‹
                            </Button>
                            <Button
                                variant="secondary"
                                className="px-8"
                                onClick={() => onShare(endingResult.share)}
                            >
                                Xã§ã‚·ã‚§ã‚¢
                            </Button>
                            <button
                                className="text-sm text-muted hover:text-primary transition-colors"
                                onClick={onKeepProgress}
                            >
                                è¨¼æ‹ ã‚’ä¿æŒã—ã¦HOMEã¸
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [currentPage, setPage] = useState('home');
            const [phase, setPhase] = useState(1);
            const [flags, setFlags] = useState({});
            const [endingResult, setEndingResult] = useState(null);
            const [seenEndings, setSeenEndings] = useState({});
            const [settings, setSettings] = useState({ reduceMotion: false, muteAudio: false });
            const [evidenceModal, setEvidenceModal] = useState({ isOpen: false, message: "", isHorror: false });
            const [evidenceToast, setEvidenceToast] = useState({ isOpen: false, message: "", isHorror: false });
            const toastTimerRef = useRef(null);
            const [isLoaded, setIsLoaded] = useState(false);
            const [selectedStaff, setSelectedStaff] = useState(null);
            const [selectedArticle, setSelectedArticle] = useState(null);

            useEffect(() => {
                window.scrollTo(0, 0);
            }, [currentPage]);

            useEffect(() => {
                const saved = (() => {
                    try {
                        const raw = localStorage.getItem(SAVE_KEY);
                        if (!raw) return null;
                        const parsed = JSON.parse(raw);
                        if (!parsed || parsed.version !== 1) return null;
                        return parsed;
                    } catch (error) {
                        return null;
                    }
                })();
                if (saved) {
                    setFlags(saved.flags || {});
                    setSeenEndings(saved.seenEndings || {});
                    setSettings(prev => ({ ...prev, ...(saved.settings || {}) }));
                } else {
                    const prefersReduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
                    if (prefersReduced) {
                        setSettings(prev => ({ ...prev, reduceMotion: true }));
                    }
                }
                setIsLoaded(true);
            }, []);

            useEffect(() => {
                return () => {
                    if (toastTimerRef.current) {
                        clearTimeout(toastTimerRef.current);
                        toastTimerRef.current = null;
                    }
                };
            }, []);

            // Phase Logicï¼ˆæ–¹é‡ã©ãŠã‚Šã®é–¾å€¤ï¼‰
            useEffect(() => {
                const next = calcPhase(flags);
                if (next !== phase) setPhase(next);
            }, [flags, phase]);

            useEffect(() => {
                document.body.setAttribute('data-phase', phase);
            }, [phase]);

            useEffect(() => {
                document.body.setAttribute('data-reduce-motion', settings.reduceMotion ? 'true' : 'false');
            }, [settings.reduceMotion]);

            useEffect(() => {
                lucide.createIcons();
            }, [currentPage, phase]);

            useEffect(() => {
                if (!isLoaded) return;
                const payload = {
                    version: 1,
                    flags,
                    seenEndings,
                    settings
                };
                localStorage.setItem(SAVE_KEY, JSON.stringify(payload));
            }, [flags, seenEndings, settings, isLoaded]);

            const unlockFlag = useCallback((flagId) => {
                setFlags(prev => {
                    if (prev[flagId]) return prev;
                    // MAX_FLAGSã‚’è¶…ãˆã‚‹ã‚ˆã†ãªè¿½åŠ ã¯è¨±å®¹ã—ãªã„ï¼ˆä¿é™ºï¼‰
                    const nextCount = Object.keys(prev).length + 1;
                    if (nextCount > MAX_FLAGS) return prev;
                    return ({ ...prev, [flagId]: true });
                });
            }, []);

            const notifyEvidence = useCallback((flagId, detailText = "", options = {}) => {
                const meta = FLAG_META[flagId];
                if (!meta) return;

                // é€²è¡Œåæ˜ 
                unlockFlag(flagId);

                // Phase3ä»¥é™ã¯ãƒ›ãƒ©ãƒ¼UI
                const isHorror = phase >= 3;

                const messageLines = [`ã€${flagId}: ${meta.title}ã€‘`];
                if (detailText) messageLines.push(detailText);
                const message = messageLines.join("\n");

                const mode = options.mode || "modal";

                if (mode === "silent") return;

                if (mode === "toast") {
                    if (toastTimerRef.current) {
                        clearTimeout(toastTimerRef.current);
                        toastTimerRef.current = null;
                    }

                    setEvidenceToast({ isOpen: true, message, isHorror });

                    const duration = typeof options.duration === "number" ? options.duration : 2600;
                    toastTimerRef.current = setTimeout(() => {
                        setEvidenceToast(prev => ({ ...prev, isOpen: false }));
                        toastTimerRef.current = null;
                    }, duration);

                    return;
                }

                setEvidenceModal({ isOpen: true, message, isHorror });
            }, [unlockFlag, phase]);

            const resetProgress = () => {
                localStorage.removeItem(SAVE_KEY);
                setFlags({});
                setSeenEndings({});
                setSettings({ reduceMotion: false, muteAudio: false });
                setEndingResult(null);
                setPage('home');
            };

            const handleReport = () => {
                const ending = computeEnding(flags, phase);
                setEndingResult(ending);
                setSeenEndings(prev => ({ ...prev, [ending.endingId]: true }));
                setPage('ending');
            };

            const renderPage = () => {
                const props = { phase, unlockFlag, notifyEvidence, flags, setPage, setSelectedStaff, setSelectedArticle };
                switch(currentPage) {
                    case 'home': return <Home {...props} />;
                    case 'about': return <About {...props} />;
                    case 'staff_detail': return <StaffDetail staff={selectedStaff} setPage={setPage} notifyEvidence={notifyEvidence} flags={flags} />;
                    case 'village': return <Village {...props} />;
                    case 'products': return <Products {...props} />;
                    case 'diary': return <Diary {...props} />;
                    case 'article_detail': return <ArticleDetail article={selectedArticle} setPage={setPage} />;
                    case 'recipe': return <RecipeDetail setPage={setPage} notifyEvidence={notifyEvidence} flags={flags} />;
                    case 'grafting': return <GraftingDetail setPage={setPage} />;
                    case 'ancient_document': return <AncientDocument setPage={setPage} />;
                    case 'access': return <Access {...props} />;
                    case 'admin_notice': return <AdminNotice {...props} onReport={handleReport} />;
                    case 'recruit': return <Recruit {...props} />;
                    case 'contact': return <Contact {...props} />;
                    case 'ending':
                        return (
                            <EndingPage
                                endingResult={endingResult}
                                flags={flags}
                                onRestart={resetProgress}
                                onShare={(shareData) => {
                                    const intentUrl = buildXIntentUrl(shareData);
                                    window.open(intentUrl, "_blank", "noopener,noreferrer");
                                }}
                                onKeepProgress={() => setPage('home')}
                            />
                        );
                    default: return <Home {...props} />;
                }
            };

            // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºï¼šPhase + å„Phaseãƒ•ãƒ©ã‚°ã®ã‚¯ãƒªã‚¢æ•°
            const p1 = countFound(flags, PHASE1_FLAGS);
            const p2 = countFound(flags, PHASE2_FLAGS);
            const p3 = countFound(flags, PHASE3_FLAGS);
            const p4 = countFound(flags, PHASE4_FLAGS);

            return (
                <>
                    <div className="min-h-screen flex flex-col font-sans text-text">
                        <Header setPage={setPage} currentPage={currentPage} phase={phase} />
                        <main className="flex-grow">
                            {renderPage()}
                        </main>
                        <Footer phase={phase} setPage={setPage} settings={settings} setSettings={setSettings} />

                        {/* Debug UIï¼šå³ä¸‹è¡¨ç¤ºï¼ˆè¦æ±‚ä»•æ§˜ï¼‰ */}
                        <div className="fixed bottom-2 right-2 z-[200] text-[10px] bg-black/80 text-white px-3 py-2 rounded-lg shadow-lg">
                            <div className="font-eng tracking-wider">Phase: <span className="font-bold">{phase}</span></div>
                            <div className="mt-1 opacity-90">
                                P1: {p1}/{PHASE1_FLAGS.length} ãƒ» P2: {p2}/{PHASE2_FLAGS.length} ãƒ» P3: {p3}/{PHASE3_FLAGS.length} ãƒ» P4: {p4}/{PHASE4_FLAGS.length}
                            </div>
                            <div className="mt-1 opacity-70">
                                Total Flags: {Object.keys(flags).length}/{MAX_FLAGS}
                            </div>
                        </div>
                    </div>
                    <MessageModal
                        isOpen={evidenceModal.isOpen}
                        message={evidenceModal.message}
                        isHorror={evidenceModal.isHorror}
                        onClose={() => setEvidenceModal({ ...evidenceModal, isOpen: false })}
                    />
                    <EvidenceToast
                        isOpen={evidenceToast.isOpen}
                        message={evidenceToast.message}
                        isHorror={evidenceToast.isHorror}
                        onClose={() => setEvidenceToast(prev => ({ ...prev, isOpen: false }))}
                    />
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
